<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üíß ‰ªôÊ¥ûÂ∞èÂ§©Êâç | ÈóñÈóúÂ§ßÂÜíÈö™ üåü</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Comic+Neue:wght@700&family=Fredoka+One&display=swap" rel="stylesheet">
    <style>
        /* Âü∫Á§éÊ®£Âºè */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Comic Neue', cursive;
            background: linear-gradient(135deg, #1a2980 0%, #26d0ce 100%);
            min-height: 100vh;
            overflow-x: hidden;
            position: relative;
            color: white;
        }
        
        /* ÊòüÁ©∫ËÉåÊôØ */
        .star-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -2;
            pointer-events: none;
            background: 
                radial-gradient(ellipse at 20% 80%, rgba(255, 255, 255, 0.1) 0%, transparent 50%),
                radial-gradient(ellipse at 80% 20%, rgba(255, 255, 255, 0.1) 0%, transparent 50%);
        }
        
        .star {
            position: absolute;
            background: white;
            border-radius: 50%;
            animation: twinkle 3s infinite alternate;
        }
        
        @keyframes twinkle {
            0% { opacity: 0.3; transform: scale(1); }
            100% { opacity: 1; transform: scale(1.2); }
        }
        
        /* ‰∏ªÂÆπÂô® */
        .universe-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            position: relative;
            z-index: 1;
        }
        
        /* ÈÅäÊà≤Âç°Áâá */
        .galaxy-card {
            width: 90%;
            max-width: 900px;
            background: rgba(0, 10, 40, 0.9);
            border-radius: 50px;
            box-shadow: 
                0 25px 80px rgba(0, 0, 0, 0.6),
                0 0 100px rgba(54, 209, 220, 0.3),
                inset 0 0 50px rgba(255, 255, 255, 0.1);
            border: 8px solid;
            border-image: linear-gradient(45deg, #36D1DC, #5B86E5, #FF6B6B, #FFD700) 1;
            overflow: hidden;
            position: relative;
            animation: galaxyGlow 4s infinite alternate;
            margin-bottom: 30px;
            backdrop-filter: blur(10px);
        }
        
        @keyframes galaxyGlow {
            0% { box-shadow: 0 25px 80px rgba(0, 0, 0, 0.6), 0 0 100px rgba(54, 209, 220, 0.3); }
            100% { box-shadow: 0 25px 100px rgba(0, 0, 0, 0.7), 0 0 150px rgba(54, 209, 220, 0.5); }
        }
        
        /* ÈÅäÊà≤Ê®ôÈ†≠ */
        .game-header {
            background: linear-gradient(135deg, #0f3460, #1a1a2e);
            color: white;
            padding: 30px;
            text-align: center;
            border-bottom: 6px solid #FFD700;
            position: relative;
            overflow: hidden;
        }
        
        .game-header::before {
            content: "";
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent, rgba(255, 215, 0, 0.1), transparent);
            animation: headerShine 6s infinite linear;
        }
        
        @keyframes headerShine {
            0% { transform: rotate(45deg) translateX(-100%); }
            100% { transform: rotate(45deg) translateX(100%); }
        }
        
        .game-title {
            font-family: 'Fredoka One', cursive;
            font-size: 3.5rem;
            text-shadow: 
                3px 3px 0 rgba(0, 0, 0, 0.3),
                0 0 20px rgba(54, 209, 220, 0.8);
            margin-bottom: 15px;
            background: linear-gradient(45deg, #36D1DC, #FFD700, #FF6B6B);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: titleSparkle 2s infinite alternate;
        }
        
        @keyframes titleSparkle {
            0% { filter: hue-rotate(0deg); }
            100% { filter: hue-rotate(45deg); }
        }
        
        .game-subtitle {
            font-size: 1.8rem;
            opacity: 0.9;
            color: #36D1DC;
            text-shadow: 2px 2px 0 rgba(0, 0, 0, 0.3);
            animation: subtitleFloat 3s infinite ease-in-out;
        }
        
        @keyframes subtitleFloat {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
        }
        
        /* Áé©ÂÆ∂Ë®ªÂÜäÂΩàÁ™ó */
        .player-register-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 3000;
            animation: modalFadeIn 0.5s ease-out;
        }

        @keyframes modalFadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .register-content {
            background: linear-gradient(135deg, #0f3460, #1a1a2e);
            padding: 50px;
            border-radius: 40px;
            border: 8px solid #FFD700;
            text-align: center;
            max-width: 500px;
            width: 90%;
            box-shadow: 0 30px 80px rgba(0, 0, 0, 0.8);
            animation: registerPop 0.8s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            position: relative;
            overflow: hidden;
        }

        @keyframes registerPop {
            0% { transform: scale(0); }
            80% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        .register-title {
            font-size: 2.8rem;
            color: #FFD700;
            margin-bottom: 20px;
            font-family: 'Fredoka One', cursive;
            text-shadow: 3px 3px 0 rgba(0, 0, 0, 0.3);
        }

        .register-subtitle {
            font-size: 1.5rem;
            color: #a1c4fd;
            margin-bottom: 30px;
        }

        .register-input {
            width: 100%;
            padding: 20px 25px;
            border: 4px solid #36D1DC;
            border-radius: 25px;
            font-size: 1.8rem;
            font-family: 'Fredoka One', cursive;
            text-align: center;
            background: rgba(0, 30, 80, 0.7);
            color: white;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(54, 209, 220, 0.3);
            transition: all 0.3s;
        }

        .register-input:focus {
            outline: none;
            border-color: #FFD700;
            box-shadow: 0 10px 40px rgba(255, 215, 0, 0.5);
            transform: scale(1.05);
        }

        .register-btn {
            padding: 20px 50px;
            background: linear-gradient(135deg, #4CAF50, #2E7D32);
            color: white;
            border: none;
            border-radius: 35px;
            font-size: 1.8rem;
            font-weight: bold;
            cursor: pointer;
            font-family: 'Fredoka One', cursive;
            transition: all 0.3s;
            box-shadow: 0 20px 50px rgba(76, 175, 80, 0.5);
        }

        .register-btn:hover {
            transform: scale(1.1);
            background: linear-gradient(135deg, #2E7D32, #4CAF50);
        }
        
        /* ÊéíË°åÊ¶úÁ≥ªÁµ± */
        .leaderboard-system {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 20, 60, 0.95);
            border-radius: 25px;
            padding: 15px 30px;
            color: white;
            font-size: 1.3rem;
            font-weight: bold;
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.6);
            z-index: 100;
            display: flex;
            align-items: center;
            gap: 20px;
            border: 3px solid #FFD700;
            backdrop-filter: blur(10px);
            cursor: pointer;
            transition: all 0.3s;
            max-width: 90%;
            animation: leaderboardFloat 4s infinite ease-in-out;
        }

        @keyframes leaderboardFloat {
            0%, 100% { transform: translateX(-50%) translateY(0); }
            50% { transform: translateX(-50%) translateY(-8px); }
        }

        .leaderboard-system:hover {
            transform: translateX(-50%) scale(1.05);
        }

        .leaderboard-icon {
            font-size: 2rem;
            animation: trophySpin 5s infinite linear;
        }

        @keyframes trophySpin {
            0% { transform: rotateY(0deg); }
            100% { transform: rotateY(360deg); }
        }

        .leaderboard-content {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .leaderboard-player {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .player-rank {
            background: #FFD700;
            color: #333;
            width: 35px;
            height: 35px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1.2rem;
        }

        .player-name {
            font-size: 1.4rem;
            color: #36D1DC;
        }

        .player-score {
            font-size: 1.4rem;
            color: #FFD700;
            font-weight: bold;
        }

        /* ÊéíË°åÊ¶úÂΩàÁ™ó */
        .leaderboard-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 2500;
        }

        .leaderboard-content-modal {
            background: linear-gradient(135deg, #0f3460, #1a1a2e);
            padding: 40px;
            border-radius: 40px;
            border: 8px solid #FFD700;
            text-align: center;
            max-width: 800px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 30px 80px rgba(0, 0, 0, 0.8);
            position: relative;
        }

        .leaderboard-title {
            font-size: 3rem;
            color: #FFD700;
            margin-bottom: 30px;
            font-family: 'Fredoka One', cursive;
            text-shadow: 3px 3px 0 rgba(0, 0, 0, 0.3);
        }

        .leaderboard-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 30px;
        }

        .leaderboard-table th {
            background: rgba(54, 209, 220, 0.3);
            color: #FFD700;
            padding: 15px;
            font-size: 1.6rem;
            border-bottom: 4px solid #36D1DC;
        }

        .leaderboard-table td {
            padding: 15px;
            font-size: 1.4rem;
            border-bottom: 2px solid rgba(255, 255, 255, 0.1);
        }

        .leaderboard-table tr:nth-child(even) {
            background: rgba(255, 255, 255, 0.05);
        }

        .leaderboard-table tr:hover {
            background: rgba(54, 209, 220, 0.2);
        }

        .rank-1 .rank-cell { background: linear-gradient(135deg, #FFD700, #FF9800); }
        .rank-2 .rank-cell { background: linear-gradient(135deg, #C0C0C0, #E0E0E0); }
        .rank-3 .rank-cell { background: linear-gradient(135deg, #CD7F32, #B87333); }

        .rank-cell {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: #333;
            font-size: 1.6rem;
        }

        .close-leaderboard {
            position: absolute;
            top: 20px;
            right: 20px;
            background: none;
            border: none;
            color: #FF6B6B;
            font-size: 2.5rem;
            cursor: pointer;
            transition: all 0.3s;
        }

        .close-leaderboard:hover {
            transform: scale(1.2);
            color: #FFD700;
        }
        
        /* ÈóúÂç°Á≥ªÁµ± */
        .level-system {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(0, 20, 60, 0.9);
            border-radius: 25px;
            padding: 15px 25px;
            color: white;
            font-size: 1.4rem;
            font-weight: bold;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            z-index: 100;
            display: flex;
            align-items: center;
            gap: 15px;
            border: 3px solid #FFD700;
            animation: levelFloat 5s infinite ease-in-out;
            backdrop-filter: blur(10px);
        }
        
        @keyframes levelFloat {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-8px); }
        }
        
        .level-icon {
            font-size: 2rem;
            animation: levelIconSpin 10s infinite linear;
        }
        
        @keyframes levelIconSpin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* ÈóúÂç°ÈÄ≤Â∫¶Ê¢ù */
        .level-progress {
            width: 150px;
            height: 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            overflow: hidden;
            position: relative;
        }
        
        .level-progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #4CAF50, #8BC34A);
            width: 0%;
            transition: width 1s ease;
            position: relative;
            overflow: hidden;
        }
        
        .level-progress-bar::after {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            animation: progressShine 2s infinite;
        }
        
        @keyframes progressShine {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }
        
        /* ÈÅäÊà≤ÈÅ∏ÊìáÁï´Èù¢ */
        .level-selection {
            display: none;
            flex-direction: column;
            gap: 40px;
            align-items: center;
            justify-content: center;
            min-height: 600px;
            padding: 40px;
            animation: levelSelectFade 0.8s ease-out;
        }
        
        @keyframes levelSelectFade {
            from { opacity: 0; transform: scale(0.9); }
            to { opacity: 1; transform: scale(1); }
        }
        
        .level-intro {
            text-align: center;
            margin-bottom: 40px;
        }
        
        .level-intro h2 {
            font-size: 2.8rem;
            color: #FFD700;
            margin-bottom: 20px;
            font-family: 'Fredoka One', cursive;
            text-shadow: 3px 3px 0 rgba(0, 0, 0, 0.3);
        }
        
        .level-intro p {
            font-size: 1.6rem;
            color: #a1c4fd;
            max-width: 700px;
            line-height: 1.6;
            margin: 0 auto;
        }
        
        /* ÈóúÂç°ÊåâÈàï */
        .level-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 30px;
            width: 100%;
            max-width: 800px;
        }
        
        .level-btn {
            padding: 30px 20px;
            background: rgba(0, 30, 80, 0.7);
            border-radius: 25px;
            border: 5px solid;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 15px;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            position: relative;
            overflow: hidden;
            font-family: 'Fredoka One', cursive;
            font-size: 1.8rem;
            color: white;
            text-shadow: 2px 2px 0 rgba(0, 0, 0, 0.3);
            animation: levelBtnFloat 3s infinite ease-in-out;
        }
        
        .level-btn:nth-child(1) { animation-delay: 0s; border-color: #36D1DC; }
        .level-btn:nth-child(2) { animation-delay: 0.5s; border-color: #4CAF50; }
        .level-btn:nth-child(3) { animation-delay: 1s; border-color: #FF9800; }
        .level-btn:nth-child(4) { animation-delay: 1.5s; border-color: #9C27B0; }
        
        @keyframes levelBtnFloat {
            0%, 100% { transform: translateY(0) rotate(0deg); }
            25% { transform: translateY(-15px) rotate(3deg); }
            75% { transform: translateY(-15px) rotate(-3deg); }
        }
        
        .level-btn:hover {
            transform: scale(1.15) rotate(5deg);
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.6);
            z-index: 10;
        }
        
        .level-btn::before {
            content: "";
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent, rgba(255,255,255,0.2), transparent);
            transform: rotate(45deg);
            animation: btnShine 4s infinite linear;
        }
        
        @keyframes btnShine {
            0% { transform: rotate(45deg) translateX(-100%); }
            100% { transform: rotate(45deg) translateX(100%); }
        }
        
        .level-icon-large {
            font-size: 3.5rem;
            animation: levelIconBounce 2s infinite ease-in-out;
        }
        
        @keyframes levelIconBounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-15px); }
        }
        
        .level-difficulty {
            font-size: 1.2rem;
            padding: 5px 15px;
            border-radius: 20px;
            background: rgba(255, 255, 255, 0.2);
            color: #FFD700;
            font-weight: bold;
        }
        
        .level-reward {
            display: flex;
            align-items: center;
            gap: 8px;
            color: #FFD700;
            font-size: 1.3rem;
        }
        
        /* ÈÅäÊà≤ÂÖßÂÆπÂçÄ */
        .game-content {
            padding: 40px;
            display: none;
            animation: contentAppear 0.6s ease-out;
        }
        
        @keyframes contentAppear {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* ÈÅäÊà≤ÂçÄÊ®ôÈ°å */
        .game-area-title {
            text-align: center;
            margin-bottom: 40px;
            position: relative;
        }
        
        .game-area-title h2 {
            font-size: 2.8rem;
            color: #FFD700;
            font-family: 'Fredoka One', cursive;
            text-shadow: 3px 3px 0 rgba(0, 0, 0, 0.3);
            margin-bottom: 15px;
            animation: gameTitleGlow 2s infinite alternate;
        }
        
        @keyframes gameTitleGlow {
            0% { text-shadow: 3px 3px 0 rgba(0, 0, 0, 0.3), 0 0 10px #FFD700; }
            100% { text-shadow: 3px 3px 0 rgba(0, 0, 0, 0.3), 0 0 20px #FFD700; }
        }
        
        .game-area-title p {
            font-size: 1.5rem;
            color: #a1c4fd;
            max-width: 700px;
            margin: 0 auto;
        }
        
        /* ÈóúÂç°‰ªªÂãôÊèêÁ§∫ */
        .mission-info {
            background: rgba(0, 40, 100, 0.7);
            border-radius: 25px;
            padding: 25px;
            margin-bottom: 40px;
            border: 4px solid #36D1DC;
            box-shadow: 0 10px 30px rgba(54, 209, 220, 0.3);
            animation: missionPulse 3s infinite alternate;
        }
        
        @keyframes missionPulse {
            0% { box-shadow: 0 10px 30px rgba(54, 209, 220, 0.3); }
            100% { box-shadow: 0 10px 40px rgba(54, 209, 220, 0.6); }
        }
        
        .mission-title {
            color: #FFD700;
            font-size: 1.8rem;
            margin-bottom: 15px;
            font-family: 'Fredoka One', cursive;
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .mission-desc {
            font-size: 1.4rem;
            color: #a1c4fd;
            line-height: 1.6;
        }
        
        .mission-requirements {
            display: flex;
            gap: 20px;
            margin-top: 20px;
            flex-wrap: wrap;
        }
        
        .requirement {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            font-size: 1.2rem;
        }
        
        .requirement.completed {
            background: rgba(76, 175, 80, 0.3);
            color: #8BC34A;
        }
        
        /* Êé•Ê∞¥ÈÅäÊà≤ÂçÄ */
        .water-game-area {
            display: none;
        }
        
        .water-challenge {
            display: flex;
            gap: 40px;
            align-items: center;
            justify-content: center;
            flex-wrap: wrap;
            margin-bottom: 40px;
        }
        
        .water-container-complex {
            position: relative;
            width: 350px;
            height: 450px;
            background: linear-gradient(135deg, #0d1b2a, #1b263b);
            border-radius: 30px;
            border: 10px solid #36D1DC;
            overflow: hidden;
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.5);
            animation: waterContainerFloat 5s infinite ease-in-out;
        }
        
        @keyframes waterContainerFloat {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-20px); }
        }
        
        .water-faucet-complex {
            width: 100px;
            height: 60px;
            background: linear-gradient(to bottom, #415a77, #778da9);
            position: absolute;
            top: 40px;
            left: 50%;
            transform: translateX(-50%);
            border-radius: 20px 20px 0 0;
            animation: faucetComplexDrip 2s infinite;
        }
        
        @keyframes faucetComplexDrip {
            0%, 100% { transform: translateX(-50%) scale(1); }
            50% { transform: translateX(-50%) scale(1.1); }
        }
        
        .water-faucet-complex::before {
            content: "";
            position: absolute;
            bottom: -20px;
            left: 50%;
            transform: translateX(-50%);
            width: 30px;
            height: 20px;
            background: #36D1DC;
            border-radius: 50%;
            animation: faucetKnobTurn 4s infinite linear;
        }
        
        @keyframes faucetKnobTurn {
            0% { transform: translateX(-50%) rotate(0deg); }
            100% { transform: translateX(-50%) rotate(360deg); }
        }
        
        .water-stream-animation {
            position: absolute;
            top: 100px;
            left: 50%;
            transform: translateX(-50%);
            width: 15px;
            height: 0;
            background: linear-gradient(to bottom, #36D1DC, #5B86E5);
            border-radius: 0 0 10px 10px;
            transition: height 0.5s;
            box-shadow: 0 0 20px rgba(54, 209, 220, 0.7);
        }
        
        .water-cup-complex {
            width: 200px;
            height: 250px;
            background: rgba(255, 255, 255, 0.1);
            border: 8px solid #FF9800;
            border-radius: 25px 25px 60px 60px;
            position: absolute;
            bottom: 50px;
            left: 50%;
            transform: translateX(-50%);
            overflow: hidden;
            box-shadow: 0 15px 40px rgba(255, 152, 0, 0.4);
        }
        
        .water-level-complex {
            width: 100%;
            height: 0%;
            background: linear-gradient(to top, #36D1DC, #5B86E5);
            position: absolute;
            bottom: 0;
            transition: height 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
            border-radius: 0 0 50px 50px;
        }
        
        .water-measurements {
            position: absolute;
            right: -50px;
            height: 100%;
            width: 50px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }
        
        .measurement {
            width: 30px;
            border-top: 4px solid rgba(255, 255, 255, 0.7);
            text-align: right;
            padding-right: 10px;
            font-weight: bold;
            color: white;
            font-size: 1.1rem;
            text-shadow: 2px 2px 0 rgba(0, 0, 0, 0.3);
        }
        
        .water-stats {
            background: rgba(0, 30, 80, 0.7);
            border-radius: 25px;
            padding: 30px;
            min-width: 300px;
            border: 5px solid #4CAF50;
            box-shadow: 0 15px 40px rgba(76, 175, 80, 0.3);
        }
        
        .water-stat-item {
            margin-bottom: 25px;
        }
        
        .water-stat-title {
            color: #36D1DC;
            font-size: 1.4rem;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .water-stat-value {
            font-size: 2.5rem;
            font-weight: bold;
            color: #FFD700;
            text-shadow: 2px 2px 0 rgba(0, 0, 0, 0.3);
        }
        
        .water-timer {
            font-size: 3.5rem;
            font-weight: bold;
            color: #FF5722;
            text-align: center;
            margin: 30px 0;
            font-family: 'Fredoka One', cursive;
            text-shadow: 3px 3px 0 rgba(0, 0, 0, 0.3);
            animation: timerPulse 1s infinite alternate;
        }
        
        @keyframes timerPulse {
            0% { opacity: 1; transform: scale(1); }
            100% { opacity: 0.8; transform: scale(1.05); }
        }
        
        .water-controls {
            display: flex;
            gap: 25px;
            justify-content: center;
            margin: 40px 0;
            flex-wrap: wrap;
        }
        
        .water-btn {
            padding: 20px 45px;
            border: none;
            border-radius: 30px;
            font-size: 1.6rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            font-family: 'Fredoka One', cursive;
            display: flex;
            align-items: center;
            gap: 15px;
            position: relative;
            overflow: hidden;
            animation: waterBtnPulse 2s infinite;
        }
        
        @keyframes waterBtnPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        .water-btn::before {
            content: "";
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent, rgba(255,255,255,0.3), transparent);
            transform: rotate(45deg);
            animation: waterBtnShine 3s infinite;
        }
        
        @keyframes waterBtnShine {
            0% { transform: rotate(45deg) translateX(-100%); }
            100% { transform: rotate(45deg) translateX(100%); }
        }
        
        .btn-start-water {
            background: linear-gradient(135deg, #4CAF50, #2E7D32);
            color: white;
            box-shadow: 0 15px 40px rgba(76, 175, 80, 0.4);
        }
        
        .btn-stop-water {
            background: linear-gradient(135deg, #FF5722, #D32F2F);
            color: white;
            box-shadow: 0 15px 40px rgba(255, 87, 34, 0.4);
        }
        
        .btn-restart-water {
            background: linear-gradient(135deg, #2196F3, #0D47A1);
            color: white;
            box-shadow: 0 15px 40px rgba(33, 150, 243, 0.4);
        }
        
        .water-feedback {
            background: linear-gradient(135deg, rgba(0, 40, 100, 0.9), rgba(54, 209, 220, 0.3));
            border-radius: 25px;
            padding: 30px;
            margin: 30px auto;
            max-width: 700px;
            border: 5px solid;
            text-align: center;
            font-size: 1.8rem;
            font-weight: bold;
            display: none;
            animation: feedbackFloat 3s infinite ease-in-out;
        }
        
        @keyframes feedbackFloat {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        
        .feedback-success {
            border-color: #4CAF50;
            color: #8BC34A;
            box-shadow: 0 15px 40px rgba(76, 175, 80, 0.5);
        }
        
        .feedback-warning {
            border-color: #FF9800;
            color: #FFB74D;
            box-shadow: 0 15px 40px rgba(255, 152, 0, 0.5);
        }
        
        .feedback-error {
            border-color: #F44336;
            color: #EF9A9A;
            box-shadow: 0 15px 40px rgba(244, 67, 54, 0.5);
        }
        
        /* Áü•Ë≠òÊåëÊà∞ÂçÄ */
        .quiz-game-area {
            display: none;
        }
        
        .quiz-challenge {
            max-width: 800px;
            margin: 0 auto;
        }
        
        .quiz-progress {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 40px;
            background: rgba(0, 30, 80, 0.7);
            border-radius: 25px;
            padding: 20px;
            border: 4px solid #9C27B0;
        }
        
        .quiz-question-number {
            font-size: 1.8rem;
            color: #FFD700;
            font-weight: bold;
        }
        
        .quiz-progress-bar {
            flex: 1;
            height: 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            overflow: hidden;
        }
        
        .quiz-progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #9C27B0, #E91E63);
            width: 0%;
            transition: width 0.5s ease;
            position: relative;
        }
        
        .quiz-question-card {
            background: rgba(0, 40, 100, 0.7);
            border-radius: 30px;
            padding: 40px;
            margin-bottom: 40px;
            border: 5px solid #36D1DC;
            box-shadow: 0 20px 50px rgba(54, 209, 220, 0.3);
            animation: quizCardFloat 4s infinite ease-in-out;
        }
        
        @keyframes quizCardFloat {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-15px); }
        }
        
        .quiz-question-text {
            font-size: 2rem;
            color: #FFD700;
            margin-bottom: 40px;
            line-height: 1.4;
            text-align: center;
            font-family: 'Fredoka One', cursive;
        }
        
        .quiz-options-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 25px;
            margin-bottom: 40px;
        }
        
        @media (max-width: 768px) {
            .quiz-options-grid {
                grid-template-columns: 1fr;
            }
        }
        
        .quiz-option-btn {
            padding: 25px;
            background: rgba(0, 20, 60, 0.8);
            border-radius: 20px;
            border: 4px solid #5B86E5;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 20px;
            font-size: 1.4rem;
            color: white;
            animation: optionAppear 0.5s ease-out;
            animation-fill-mode: both;
        }
        
        .quiz-option-btn:nth-child(1) { animation-delay: 0.1s; }
        .quiz-option-btn:nth-child(2) { animation-delay: 0.2s; }
        .quiz-option-btn:nth-child(3) { animation-delay: 0.3s; }
        .quiz-option-btn:nth-child(4) { animation-delay: 0.4s; }
        
        @keyframes optionAppear {
            from { opacity: 0; transform: translateX(-30px); }
            to { opacity: 1; transform: translateX(0); }
        }
        
        .quiz-option-btn:hover {
            transform: scale(1.05);
            border-color: #FFD700;
            box-shadow: 0 10px 30px rgba(255, 215, 0, 0.3);
        }
        
        .quiz-option-btn.selected {
            background: rgba(54, 209, 220, 0.3);
            border-color: #36D1DC;
        }
        
        .quiz-option-btn.correct {
            background: rgba(76, 175, 80, 0.3);
            border-color: #4CAF50;
            animation: correctBlink 1s;
        }
        
        @keyframes correctBlink {
            0%, 100% { background: rgba(76, 175, 80, 0.3); }
            50% { background: rgba(76, 175, 80, 0.6); }
        }
        
        .quiz-option-btn.incorrect {
            background: rgba(244, 67, 54, 0.3);
            border-color: #F44336;
            animation: incorrectShake 0.5s;
        }
        
        @keyframes incorrectShake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }
        
        .option-label {
            width: 50px;
            height: 50px;
            background: #FFD700;
            color: #333;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8rem;
            font-weight: bold;
            font-family: 'Fredoka One', cursive;
        }
        
        .quiz-feedback-card {
            background: rgba(0, 40, 100, 0.9);
            border-radius: 25px;
            padding: 35px;
            margin: 30px 0;
            border: 5px solid #FF9800;
            display: none;
            animation: feedbackCardPop 0.5s ease-out;
        }
        
        @keyframes feedbackCardPop {
            from { transform: scale(0); }
            to { transform: scale(1); }
        }
        
        .quiz-feedback-title {
            color: #FF9800;
            font-size: 2rem;
            margin-bottom: 20px;
            font-family: 'Fredoka One', cursive;
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .quiz-feedback-text {
            font-size: 1.5rem;
            color: #a1c4fd;
            line-height: 1.6;
            margin-bottom: 25px;
        }
        
        .quiz-esg-tags {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        .quiz-esg-tag {
            padding: 10px 25px;
            border-radius: 25px;
            color: white;
            font-weight: bold;
            font-size: 1.3rem;
            display: flex;
            align-items: center;
            gap: 10px;
            animation: tagBounce 1.5s infinite alternate;
        }
        
        @keyframes tagBounce {
            0% { transform: translateY(0); }
            100% { transform: translateY(-8px); }
        }
        
        .tag-environment {
            background: linear-gradient(135deg, #4CAF50, #2E7D32);
        }
        
        .tag-social {
            background: linear-gradient(135deg, #FF9800, #EF6C00);
        }
        
        .tag-governance {
            background: linear-gradient(135deg, #2196F3, #0D47A1);
        }
        
        .quiz-controls {
            display: flex;
            justify-content: center;
            gap: 25px;
            margin-top: 40px;
        }
        
        .quiz-btn {
            padding: 20px 45px;
            border: none;
            border-radius: 30px;
            font-size: 1.6rem;
            font-weight: bold;
            cursor: pointer;
            font-family: 'Fredoka One', cursive;
            display: flex;
            align-items: center;
            gap: 15px;
            transition: all 0.3s;
            background: linear-gradient(135deg, #9C27B0, #E91E63);
            color: white;
            box-shadow: 0 15px 40px rgba(156, 39, 176, 0.4);
            animation: quizBtnPulse 2s infinite;
        }
        
        @keyframes quizBtnPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        /* Êé¢Á¥¢ÊåëÊà∞ÂçÄ */
        .explore-game-area {
            display: none;
        }
        
        /* ÂãïÁï´Á≤íÂ≠ê */
        .magic-particles {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 0;
        }
        
        .magic-particle {
            position: absolute;
            border-radius: 50%;
            animation: magicFloat 10s infinite linear;
            opacity: 0.7;
        }
        
        @keyframes magicFloat {
            0% { transform: translateY(100vh) rotate(0deg); }
            100% { transform: translateY(-100px) rotate(360deg); }
        }
        
        /* ÁÖôÁÅ´ÂãïÁï´ */
        .fireworks-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 2001;
            display: none;
        }

        .firework {
            position: absolute;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            animation: fireworkExplode 1s forwards;
        }

        @keyframes fireworkExplode {
            0% {
                transform: translateY(100vh) scale(1);
                opacity: 1;
            }
            50% {
                transform: translateY(calc(50vh - 50px)) scale(1);
                opacity: 1;
            }
            100% {
                transform: translateY(calc(50vh - 50px)) scale(0);
                opacity: 0;
            }
        }

        .firework-particle {
            position: absolute;
            width: 4px;
            height: 4px;
            border-radius: 50%;
            animation: fireworkParticle 1.5s forwards;
        }

        @keyframes fireworkParticle {
            0% {
                transform: translate(0, 0) scale(1);
                opacity: 1;
            }
            100% {
                transform: translate(var(--tx), var(--ty)) scale(0);
                opacity: 0;
            }
        }
        
        /* ÂàÜÊï∏È°ØÁ§∫ÂãïÁï´ */
        .score-display {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 8rem;
            font-weight: bold;
            color: #FFD700;
            text-shadow: 0 0 30px #FFD700;
            z-index: 2002;
            display: none;
            animation: scorePop 1s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            font-family: 'Fredoka One', cursive;
        }

        @keyframes scorePop {
            0% { transform: translate(-50%, -50%) scale(0); opacity: 0; }
            70% { transform: translate(-50%, -50%) scale(1.3); opacity: 1; }
            100% { transform: translate(-50%, -50%) scale(1); opacity: 1; }
        }

        /* ËøîÂõûÊåâÈàï */
        .magic-back-btn {
            position: fixed;
            top: 20px;
            left: 20px;
            padding: 18px 35px;
            background: linear-gradient(135deg, #FF5722, #D32F2F);
            color: white;
            border: none;
            border-radius: 30px;
            font-size: 1.5rem;
            font-weight: bold;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 15px;
            z-index: 100;
            box-shadow: 0 15px 40px rgba(255, 87, 34, 0.5);
            transition: all 0.3s;
            display: none;
            animation: backBtnSlide 0.6s ease-out;
            backdrop-filter: blur(10px);
            border: 3px solid #FFD700;
        }
        
        @keyframes backBtnSlide {
            from { transform: translateX(-100px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        .magic-back-btn:hover {
            transform: scale(1.1) rotate(-3deg);
        }
        
        /* ÊÖ∂Á•ùÂãïÁï´ */
        .victory-celebration {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            animation: victoryFadeIn 0.5s ease-out;
        }
        
        @keyframes victoryFadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .victory-content {
            background: linear-gradient(135deg, #0f3460, #1a1a2e);
            padding: 60px;
            border-radius: 50px;
            border: 10px solid #FFD700;
            text-align: center;
            max-width: 700px;
            width: 90%;
            box-shadow: 0 30px 80px rgba(0, 0, 0, 0.8);
            animation: victoryPop 0.8s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            position: relative;
            overflow: hidden;
        }
        
        @keyframes victoryPop {
            0% { transform: scale(0); }
            80% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
        
        .victory-content::before {
            content: "";
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent, rgba(255, 215, 0, 0.2), transparent);
            animation: victoryShine 3s infinite linear;
        }
        
        @keyframes victoryShine {
            0% { transform: rotate(45deg) translateX(-100%); }
            100% { transform: rotate(45deg) translateX(100%); }
        }
        
        .victory-icon {
            font-size: 6rem;
            margin-bottom: 30px;
            animation: victoryIconFloat 2s infinite ease-in-out;
            display: block;
        }
        
        @keyframes victoryIconFloat {
            0%, 100% { transform: translateY(0) rotate(0deg); }
            25% { transform: translateY(-30px) rotate(10deg); }
            75% { transform: translateY(-30px) rotate(-10deg); }
        }
        
        .victory-title {
            font-size: 3.5rem;
            color: #FFD700;
            font-family: 'Fredoka One', cursive;
            margin-bottom: 20px;
            text-shadow: 3px 3px 0 rgba(0, 0, 0, 0.3);
        }
        
        .victory-message {
            font-size: 2rem;
            color: #a1c4fd;
            margin-bottom: 30px;
            line-height: 1.5;
        }
        
        .victory-rewards {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin-top: 40px;
            flex-wrap: wrap;
        }
        
        .victory-reward {
            background: rgba(255, 215, 0, 0.2);
            border-radius: 20px;
            padding: 20px 30px;
            border: 3px solid #FFD700;
            display: flex;
            align-items: center;
            gap: 15px;
            animation: rewardAppear 0.5s ease-out;
        }
        
        @keyframes rewardAppear {
            from { opacity: 0; transform: translateY(50px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .reward-icon {
            font-size: 2.5rem;
            color: #FFD700;
        }
        
        .reward-text {
            font-size: 1.8rem;
            color: white;
            font-weight: bold;
        }
        
        .victory-button {
            margin-top: 40px;
            padding: 25px 50px;
            background: linear-gradient(135deg, #4CAF50, #2E7D32);
            color: white;
            border: none;
            border-radius: 35px;
            font-size: 2rem;
            font-weight: bold;
            cursor: pointer;
            font-family: 'Fredoka One', cursive;
            transition: all 0.3s;
            box-shadow: 0 20px 50px rgba(76, 175, 80, 0.5);
        }
        
        .victory-button:hover {
            transform: scale(1.1);
        }
        
        /* ËÉΩÂäõÊï∏ÂÄº */
        .abilities-system {
            position: fixed;
            bottom: 20px;
            left: 20px;
            background: rgba(0, 20, 60, 0.9);
            border-radius: 25px;
            padding: 20px;
            color: white;
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.5);
            z-index: 100;
            border: 3px solid #FFD700;
            backdrop-filter: blur(10px);
            animation: abilitiesFloat 4s infinite ease-in-out;
        }
        
        @keyframes abilitiesFloat {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        
        .abilities-title {
            color: #FFD700;
            font-size: 1.5rem;
            margin-bottom: 15px;
            font-family: 'Fredoka One', cursive;
        }
        
        .abilities-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
        }
        
        .ability-item {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .ability-icon {
            font-size: 1.8rem;
            color: #36D1DC;
            width: 40px;
            text-align: center;
        }
        
        .ability-name {
            font-size: 1.2rem;
            color: #a1c4fd;
            width: 80px;
        }
        
        .ability-value {
            font-size: 1.4rem;
            font-weight: bold;
            color: #FFD700;
            min-width: 60px;
        }
        
        .ability-bar {
            width: 100px;
            height: 10px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 5px;
            overflow: hidden;
        }
        
        .ability-fill {
            height: 100%;
            background: linear-gradient(90deg, #36D1DC, #5B86E5);
            width: 0%;
            transition: width 1s ease;
        }
        
        /* Áé©ÂÆ∂Ë≥áË®äÈ°ØÁ§∫ */
        .player-info-system {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(0, 20, 60, 0.9);
            border-radius: 25px;
            padding: 15px 25px;
            color: white;
            font-size: 1.4rem;
            font-weight: bold;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            z-index: 100;
            display: flex;
            align-items: center;
            gap: 15px;
            border: 3px solid #FFD700;
            backdrop-filter: blur(10px);
            animation: playerInfoFloat 4s infinite ease-in-out;
            display: none;
        }

        @keyframes playerInfoFloat {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
        }

        .player-avatar {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, #36D1DC, #5B86E5);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8rem;
            color: white;
        }

        .player-name-display {
            font-size: 1.6rem;
            color: #FFD700;
        }

        .player-drops {
            display: flex;
            align-items: center;
            gap: 8px;
            color: #36D1DC;
            font-size: 1.4rem;
        }
        
        /* ÊéíÂêçÊÖ∂Á•ùÂãïÁï´ */
        .rank-celebration {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 5rem;
            color: #FFD700;
            text-shadow: 0 0 30px #FFD700;
            z-index: 3001;
            font-family: 'Fredoka One', cursive;
            text-align: center;
            animation: rankCelebrationPop 2s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            pointer-events: none;
            display: none;
        }

        @keyframes rankCelebrationPop {
            0% { transform: translate(-50%, -50%) scale(0); opacity: 0; }
            50% { transform: translate(-50%, -50%) scale(1.5); opacity: 1; }
            100% { transform: translate(-50%, -50%) scale(1); opacity: 1; }
        }
    </style>
</head>
<body>
    <!-- ÊòüÁ©∫ËÉåÊôØ -->
    <div class="star-bg" id="starBg"></div>
    
    <!-- È≠îÊ≥ïÁ≤íÂ≠ê -->
    <div class="magic-particles" id="magicParticles"></div>
    
    <!-- Áé©ÂÆ∂Ë®ªÂÜäÂΩàÁ™ó -->
    <div class="player-register-modal" id="playerRegisterModal">
        <div class="register-content">
            <div class="register-title">üéÆ Ê≠°Ëøé‰æÜÂà∞‰ªôÊ¥ûÂ∞èÂ§©ÊâçÔºÅ</div>
            <div class="register-subtitle">Ë´ãËº∏ÂÖ•ÊÇ®ÁöÑÊö±Á®±ÔºåÈñãÂßãÁØÄÊ∞¥ÂÜíÈö™ÔºÅ</div>
            <input type="text" class="register-input" id="playerNameInput" 
                   placeholder="Ëº∏ÂÖ•Êö±Á®±ÔºàÊúÄÂ§ö10Â≠óÔºâ" maxlength="10">
            <button class="register-btn" id="registerBtn">ÈñãÂßãÈÅäÊà≤ÔºÅ</button>
            <div style="margin-top: 20px; color: #a1c4fd; font-size: 1.2rem;">
                <i class="fas fa-info-circle"></i> ÊÇ®ÁöÑÊàêÁ∏æÂ∞áÂá∫ÁèæÂú®ÊéíË°åÊ¶ú‰∏äÔºÅ
            </div>
        </div>
    </div>

    <!-- ÊéíË°åÊ¶úÂΩàÁ™ó -->
    <div class="leaderboard-modal" id="leaderboardModal">
        <div class="leaderboard-content-modal">
            <button class="close-leaderboard" id="closeLeaderboard">
                <i class="fas fa-times"></i>
            </button>
            <div class="leaderboard-title">üèÜ ‰ªäÊó•ÊéíË°åÊ¶ú</div>
            <table class="leaderboard-table">
                <thead>
                    <tr>
                        <th>ÊéíÂêç</th>
                        <th>Áé©ÂÆ∂</th>
                        <th>ÈóúÂç°</th>
                        <th>ÂàÜÊï∏</th>
                        <th>ÊôÇÈñì</th>
                    </tr>
                </thead>
                <tbody id="leaderboardTableBody">
                    <!-- ÊéíË°åÊ¶úÊï∏ÊìöÊúÉÂãïÊÖãÁîüÊàê -->
                </tbody>
            </table>
            <div style="color: #a1c4fd; font-size: 1.4rem; margin-top: 20px;">
                <i class="fas fa-sync-alt"></i> ÊéíË°åÊ¶úÊØèÂ§©ÈáçÁΩÆ‰∏ÄÊ¨°
            </div>
        </div>
    </div>

    <!-- ÁÖôÁÅ´ÂãïÁï´ÂÆπÂô® -->
    <div class="fireworks-container" id="fireworksContainer"></div>

    <!-- ÂàÜÊï∏È°ØÁ§∫ -->
    <div class="score-display" id="scoreDisplay">0</div>

    <!-- ÊéíÂêçÊÖ∂Á•ùÂãïÁï´ -->
    <div class="rank-celebration" id="rankCelebration"></div>
    
    <!-- ÊÖ∂Á•ùÂãïÁï´ -->
    <div class="victory-celebration" id="victoryCelebration">
        <div class="victory-content">
            <div class="victory-icon" id="victoryIcon">üèÜ</div>
            <div class="victory-title" id="victoryTitle">ÈóúÂç°ÂÆåÊàêÔºÅ</div>
            <div class="victory-message" id="victoryMessage"></div>
            <div class="victory-rewards" id="victoryRewards"></div>
            <button class="victory-button" id="victoryButton">ÁπºÁ∫åÂÜíÈö™ÔºÅ</button>
        </div>
    </div>
    
    <!-- ÊéíË°åÊ¶úÂÖ•Âè£ -->
    <div class="leaderboard-system" id="leaderboardSystem">
        <div class="leaderboard-icon">üèÜ</div>
        <div class="leaderboard-content">
            <div class="leaderboard-player">
                <div class="player-rank">1</div>
                <div class="player-name" id="topPlayerName">ËºâÂÖ•‰∏≠...</div>
                <div class="player-score" id="topPlayerScore">0</div>
            </div>
        </div>
    </div>
    
    <!-- Áé©ÂÆ∂Ë≥áË®äÈ°ØÁ§∫ -->
    <div class="player-info-system" id="playerInfoSystem">
        <div class="player-avatar" id="playerAvatar">üë§</div>
        <div>
            <div class="player-name-display" id="playerNameDisplay">Áé©ÂÆ∂</div>
            <div class="player-drops">
                <i class="fas fa-tint"></i>
                <span id="playerDropsCount">0</span> Ê∞¥Êª¥
            </div>
        </div>
    </div>

    <!-- ËøîÂõûÊåâÈàï -->
    <button class="magic-back-btn" id="magicBackBtn">
        <i class="fas fa-arrow-left"></i> ËøîÂõûÈóúÂç°
    </button>
    
    <!-- ÈóúÂç°Á≥ªÁµ± -->
    <div class="level-system">
        <div class="level-icon">üìä</div>
        <div>ÈóúÂç° <span id="currentLevel">1</span>/4</div>
        <div class="level-progress">
            <div class="level-progress-bar" id="levelProgressBar"></div>
        </div>
    </div>
    
    <!-- ËÉΩÂäõÁ≥ªÁµ± -->
    <div class="abilities-system">
        <div class="abilities-title">Â∞èÂ§©ÊâçËÉΩÂäõÂÄº</div>
        <div class="abilities-grid">
            <div class="ability-item">
                <div class="ability-icon">üíß</div>
                <div class="ability-name">ÁØÄÊ∞¥ÊäÄÂ∑ß</div>
                <div class="ability-value" id="waterSkill">50%</div>
                <div class="ability-bar">
                    <div class="ability-fill" id="waterSkillBar" style="width: 50%"></div>
                </div>
            </div>
            <div class="ability-item">
                <div class="ability-icon">üìö</div>
                <div class="ability-name">ÁØÄÊ∞¥Áü•Ë≠ò</div>
                <div class="ability-value" id="knowledgeSkill">25%</div>
                <div class="ability-bar">
                    <div class="ability-fill" id="knowledgeSkillBar" style="width: 25%"></div>
                </div>
            </div>
            <div class="ability-item">
                <div class="ability-icon">üåü</div>
                <div class="ability-name">Áí∞‰øùÁ≤æÁ•û</div>
                <div class="ability-value" id="ecoSkill">30%</div>
                <div class="ability-bar">
                    <div class="ability-fill" id="ecoSkillBar" style="width: 30%"></div>
                </div>
            </div>
            <div class="ability-item">
                <div class="ability-icon">‚ö°</div>
                <div class="ability-name">ÊåëÊà∞ÈÄüÂ∫¶</div>
                <div class="ability-value" id="speedSkill">40%</div>
                <div class="ability-bar">
                    <div class="ability-fill" id="speedSkillBar" style="width: 40%"></div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="universe-container">
        <!-- ÈÅäÊà≤Âç°Áâá -->
        <div class="galaxy-card">
            <div class="game-header">
                <h1 class="game-title">üíß ‰ªôÊ¥ûÂ∞èÂ§©Êâç üåü</h1>
                <p class="game-subtitle">ÁØÄÊ∞¥ÈóñÈóúÂ§ßÂÜíÈö™</p>
            </div>
            
            <!-- ÈóúÂç°ÈÅ∏Êìá -->
            <div class="level-selection" id="levelSelection">
                <div class="level-intro">
                    <h2>üéÆ ÈÅ∏Êìá‰Ω†ÁöÑÊåëÊà∞ÔºÅ</h2>
                    <p>ÂæûÁ∞°ÂñÆÂà∞Âõ∞Èõ£ÔºåÊØèÂÄãÈóúÂç°ÈÉΩÊúâ‰∏çÂêåÁöÑÊåëÊà∞Á≠âËëó‰Ω†ÔºÅ</p>
                    <p style="color: #FFD700; margin-top: 15px; font-size: 1.4rem;">
                        ÂÆåÊàêÈóúÂç°ÂèØ‰ª•ÊèêÂçá‰Ω†ÁöÑÂ∞èÂ§©ÊâçËÉΩÂäõÂÄºÔºÅ
                    </p>
                </div>
                
                <div class="level-buttons">
                    <button class="level-btn" data-level="1">
                        <div class="level-icon-large">üö∞</div>
                        <div>Êñ∞ÊâãÈóúÂç°</div>
                        <div class="level-difficulty">Á∞°ÂñÆ</div>
                        <div class="level-reward">
                            <i class="fas fa-tint"></i>
                            <span>ÁçéÂãµÔºö3-5Ê∞¥Êª¥</span>
                        </div>
                    </button>
                    
                    <button class="level-btn" data-level="2">
                        <div class="level-icon-large">üìö</div>
                        <div>Áü•Ë≠òÈóúÂç°</div>
                        <div class="level-difficulty">‰∏≠Á≠â</div>
                        <div class="level-reward">
                            <i class="fas fa-tint"></i>
                            <span>ÁçéÂãµÔºö5-8Ê∞¥Êª¥</span>
                        </div>
                    </button>
                    
                    <button class="level-btn" data-level="3">
                        <div class="level-icon-large">üéØ</div>
                        <div>È´òÊâãÈóúÂç°</div>
                        <div class="level-difficulty">Âõ∞Èõ£</div>
                        <div class="level-reward">
                            <i class="fas fa-tint"></i>
                            <span>ÁçéÂãµÔºö8-12Ê∞¥Êª¥</span>
                        </div>
                    </button>
                    
                    <button class="level-btn" data-level="4">
                        <div class="level-icon-large">üèÜ</div>
                        <div>Â§ßÂ∏´ÈóúÂç°</div>
                        <div class="level-difficulty">ÊåëÊà∞</div>
                        <div class="level-reward">
                            <i class="fas fa-tint"></i>
                            <span>ÁçéÂãµÔºö12-15Ê∞¥Êª¥</span>
                        </div>
                    </button>
                </div>
            </div>
            
            <!-- ÈÅäÊà≤ÂÖßÂÆπÂçÄ -->
            <div class="game-content">
                <!-- Êé•Ê∞¥ÊåëÊà∞ÂçÄ -->
                <div class="water-game-area" id="waterGameArea">
                    <div class="game-area-title">
                        <h2>üö∞ Êé•Ê∞¥Â§ßÊåëÊà∞</h2>
                        <p>Á≤æÊ∫ñÊé•Ê∞¥ÔºåÂüπÈ§äÁØÄÊ∞¥Â•ΩÁøíÊÖ£ÔºÅ</p>
                    </div>
                    
                    <div class="mission-info" id="waterMissionInfo">
                        <div class="mission-title">
                            <i class="fas fa-bullseye"></i>
                            <span>‰ªªÂãôÁõÆÊ®ô</span>
                        </div>
                        <div class="mission-desc" id="waterMissionDesc">
                            Ë´ãÂú®ÊåáÂÆöÊôÇÈñìÂÖßÊé•Âà∞ÂâõÂ•Ω250mlÁöÑÊ∞¥ÔºÅ
                        </div>
                        <div class="mission-requirements" id="waterRequirements">
                            <!-- ‰ªªÂãôË¶ÅÊ±ÇÊúÉÂú®ÈÄôË£°ÂãïÊÖãÁîüÊàê -->
                        </div>
                    </div>
                    
                    <div class="water-challenge">
                        <div class="water-container-complex">
                            <div class="water-faucet-complex"></div>
                            <div class="water-stream-animation" id="waterStream"></div>
                            <div class="water-cup-complex">
                                <div class="water-level-complex" id="waterLevelComplex"></div>
                                <div class="water-measurements">
                                    <div class="measurement" style="top: 0%;">300ml</div>
                                    <div class="measurement" style="top: 20%;">250ml</div>
                                    <div class="measurement" style="top: 40%;">200ml</div>
                                    <div class="measurement" style="top: 60%;">150ml</div>
                                    <div class="measurement" style="top: 80%;">100ml</div>
                                    <div class="measurement" style="top: 100%;">0ml</div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="water-stats">
                            <div class="water-stat-item">
                                <div class="water-stat-title">
                                    <i class="fas fa-clock"></i>
                                    <span>Ââ©È§òÊôÇÈñì</span>
                                </div>
                                <div class="water-timer" id="waterTimer">30.0 Áßí</div>
                            </div>
                            
                            <div class="water-stat-item">
                                <div class="water-stat-title">
                                    <i class="fas fa-tint"></i>
                                    <span>Áï∂ÂâçÊ∞¥Èáè</span>
                                </div>
                                <div class="water-stat-value" id="currentWater">0 ml</div>
                            </div>
                            
                            <div class="water-stat-item">
                                <div class="water-stat-title">
                                    <i class="fas fa-crosshairs"></i>
                                    <span>ÁõÆÊ®ôÊ∞¥Èáè</span>
                                </div>
                                <div class="water-stat-value">250 ml</div>
                            </div>
                            
                            <div class="water-stat-item">
                                <div class="water-stat-title">
                                    <i class="fas fa-star"></i>
                                    <span>ÊúÄÈ´òÁ¥ÄÈåÑ</span>
                                </div>
                                <div class="water-stat-value" id="waterBestScore">0 ÂàÜ</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="water-feedback" id="waterFeedback"></div>
                    
                    <div class="water-controls">
                        <button class="water-btn btn-start-water" id="waterStartBtn">
                            <i class="fas fa-play"></i> ÈñãÂßãÊåëÊà∞
                        </button>
                        <button class="water-btn btn-stop-water" id="waterStopBtn" disabled>
                            <i class="fas fa-stop"></i> ÂÅúÊ≠¢Êé•Ê∞¥
                        </button>
                        <button class="water-btn btn-restart-water" id="waterRestartBtn">
                            <i class="fas fa-redo"></i> ÈáçÊñ∞ÊåëÊà∞
                        </button>
                    </div>
                </div>
                
                <!-- Áü•Ë≠òÊåëÊà∞ÂçÄ -->
                <div class="quiz-game-area" id="quizGameArea">
                    <div class="game-area-title">
                        <h2>üìö ÁØÄÊ∞¥Áü•Ë≠òÊåëÊà∞</h2>
                        <p>Â≠∏ÁøíÁØÄÊ∞¥Áü•Ë≠òÔºåÊàêÁÇ∫Áí∞‰øùÂ∞èÂ∞àÂÆ∂ÔºÅ</p>
                    </div>
                    
                    <div class="mission-info" id="quizMissionInfo">
                        <div class="mission-title">
                            <i class="fas fa-graduation-cap"></i>
                            <span>‰ªªÂãôÁõÆÊ®ô</span>
                        </div>
                        <div class="mission-desc" id="quizMissionDesc">
                            ÂõûÁ≠îÁØÄÊ∞¥Áü•Ë≠òÂïèÈ°åÔºåÂÆåÊàêÊåëÊà∞ÔºÅ
                        </div>
                        <div class="mission-requirements" id="quizRequirements">
                            <!-- ‰ªªÂãôË¶ÅÊ±ÇÊúÉÂú®ÈÄôË£°ÂãïÊÖãÁîüÊàê -->
                        </div>
                    </div>
                    
                    <div class="quiz-challenge">
                        <div class="quiz-progress">
                            <div class="quiz-question-number">
                                ÂïèÈ°å <span id="currentQuestionNum">1</span>/<span id="totalQuestions">4</span>
                            </div>
                            <div class="quiz-progress-bar">
                                <div class="quiz-progress-fill" id="quizProgressFill"></div>
                            </div>
                            <div style="color: #FFD700; font-weight: bold; font-size: 1.8rem;">
                                <span id="quizScore">0</span> ÂàÜ
                            </div>
                        </div>
                        
                        <div class="quiz-question-card">
                            <div class="quiz-question-text" id="quizQuestionText">
                                ÂïèÈ°åËºâÂÖ•‰∏≠...
                            </div>
                            
                            <div class="quiz-options-grid" id="quizOptionsGrid">
                                <!-- ÈÅ∏È†ÖÊúÉÂú®ÈÄôË£°ÂãïÊÖãÁîüÊàê -->
                            </div>
                            
                            <div class="quiz-feedback-card" id="quizFeedbackCard">
                                <div class="quiz-feedback-title">
                                    <i class="fas fa-lightbulb"></i>
                                    <span>Áü•Ë≠òËß£Ë™™</span>
                                </div>
                                <div class="quiz-feedback-text" id="quizFeedbackText"></div>
                                <div class="quiz-esg-tags" id="quizEsgTags"></div>
                            </div>
                        </div>
                        
                        <div class="quiz-controls">
                            <button class="quiz-btn" id="quizNextBtn">
                                ‰∏ã‰∏ÄÈ°å <i class="fas fa-arrow-right"></i>
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Êé¢Á¥¢ÊåëÊà∞ÂçÄ -->
                <div class="explore-game-area" id="exploreGameArea">
                    <div class="game-area-title">
                        <h2>üåü Êé¢Á¥¢ÊåëÊà∞</h2>
                        <p>ÈñãÁôº‰∏≠...</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ÈÅäÊà≤ÁãÄÊÖãÁÆ°ÁêÜ
        const gameState = {
            currentLevel: 1,
            
            // Áé©ÂÆ∂ÁãÄÊÖã
            player: {
                name: '',
                avatar: 'üë§',
                registered: false,
                currentScore: 0
            },
            
            // ÊéíË°åÊ¶úÊï∏Êìö
            leaderboard: [],
            
            levels: {
                1: {
                    name: "Êñ∞ÊâãÈóúÂç°",
                    difficulty: "Á∞°ÂñÆ",
                    type: "water",
                    targetScore: 60,
                    timeLimit: 30,
                    attempts: 3,
                    completed: false,
                    bestScore: 0,
                    reward: { min: 3, max: 5 },
                    requirements: [
                        { text: "Ë™§Â∑ÆÂ∞èÊñº50ml", type: "accuracy" },
                        { text: "ÊôÇÈñìÂÖßÂÆåÊàê", type: "time" }
                    ]
                },
                2: {
                    name: "Áü•Ë≠òÈóúÂç°",
                    difficulty: "‰∏≠Á≠â",
                    type: "quiz",
                    targetScore: 80,
                    questions: 4,
                    completed: false,
                    bestScore: 0,
                    reward: { min: 5, max: 8 },
                    requirements: [
                        { text: "Á≠îÂ∞ç3È°å‰ª•‰∏ä", type: "accuracy" },
                        { text: "‰∫ÜËß£ESGÊ¶ÇÂøµ", type: "knowledge" }
                    ]
                },
                3: {
                    name: "È´òÊâãÈóúÂç°",
                    difficulty: "Âõ∞Èõ£",
                    type: "water",
                    targetScore: 85,
                    timeLimit: 20,
                    attempts: 2,
                    completed: false,
                    bestScore: 0,
                    reward: { min: 8, max: 12 },
                    requirements: [
                        { text: "Ë™§Â∑ÆÂ∞èÊñº20ml", type: "accuracy" },
                        { text: "20ÁßíÂÖßÂÆåÊàê", type: "time" },
                        { text: "‰∏ÄÊ¨°ÊåëÊà∞ÊàêÂäü", type: "perfection" }
                    ]
                },
                4: {
                    name: "Â§ßÂ∏´ÈóúÂç°",
                    difficulty: "ÊåëÊà∞",
                    type: "mixed",
                    targetScore: 90,
                    completed: false,
                    bestScore: 0,
                    reward: { min: 12, max: 15 },
                    requirements: [
                        { text: "Á∂úÂêàÊåëÊà∞", type: "mixed" },
                        { text: "È´òÁ¥öÁØÄÊ∞¥ÊäÄÂ∑ß", type: "expert" }
                    ]
                }
            },
            
            // Áé©ÂÆ∂ËÉΩÂäõÂÄº
            abilities: {
                waterSkill: 50,
                knowledgeSkill: 25,
                ecoSkill: 30,
                speedSkill: 40,
                totalScore: 0,
                waterDrops: 100
            },
            
            // Êé•Ê∞¥ÈÅäÊà≤ÁãÄÊÖã
            waterGame: {
                isRunning: false,
                timer: 30,
                timerInterval: null,
                waterLevel: 0,
                waterInterval: null,
                currentAttempt: 0,
                levelScore: 0,
                accuracy: 0
            },
            
            // Áü•Ë≠òÈÅäÊà≤ÁãÄÊÖã
            quizGame: {
                currentQuestion: 0,
                score: 0,
                answered: false,
                questions: [
                    {
                        question: "Ê¥óÊâãÊôÇÊúÄÁØÄÊ∞¥ÁöÑÊ≠£Á¢∫Ê≠•È©üÊòØÔºü",
                        options: [
                            "Ê∞¥ÈæçÈ†≠ÂÖ®ÈñãÔºåÂ§ßÂäõÊ≤ñÊ¥ó",
                            "ÂÖàÊøïÊâãÔºåÈóúÊ∞¥ÊêìËÇ•ÁöÇÔºåÂÜçÈñãÊ∞¥Ê≤ñÊ¥ó",
                            "ËÆìÊ∞¥‰∏ÄÁõ¥ÊµÅÔºåÊÖ¢ÊÖ¢Ê¥ó‰πæÊ∑®"
                        ],
                        correct: 1,
                        explanation: "Ê≠£Á¢∫ÔºÅÂÖàÊøïÊâãÂ∞±ÈóúÊ∞¥ÔºåÊêìËÇ•ÁöÇ20ÁßíÂæåÂÜçÈñãÊ∞¥Ê≤ñÊ¥óÔºåÈÄôÊ®£ÂèØ‰ª•ÁØÄÁúÅÂ§ßÈáèÁî®Ê∞¥ÔºÅ",
                        esg: ["environment", "social"],
                        points: 25
                    },
                    {
                        question: "ESG‰∏≠ÁöÑ'S'‰ª£Ë°®‰ªÄÈ∫ºÊÑèÊÄùÔºü",
                        options: [
                            "ÁØÄÁ¥Ñ (Save)",
                            "Á§æÊúÉË≤¨‰ªª (Social)",
                            "Â≠∏Ê†° (School)"
                        ],
                        correct: 1,
                        explanation: "Ê≠£Á¢∫ÔºÅS‰ª£Ë°®Á§æÊúÉË≤¨‰ªªÔºåÂåÖÊã¨ÈóúÂøÉÁ§æÂçÄÁî®Ê∞¥ÂÖ¨Âπ≥„ÄÅÂπ´Âä©ÊúâÈúÄË¶ÅÁöÑ‰∫∫ÂêàÁêÜÁî®Ê∞¥Á≠â„ÄÇ",
                        esg: ["social"],
                        points: 25
                    },
                    {
                        question: "Âì™Á®ÆÊ¥óÊæ°ÊñπÂºèÊúÄÁØÄÊ∞¥Ôºü",
                        options: [
                            "Ê≥°Êæ°30ÂàÜÈêò‰∫´Âèó",
                            "Ê∑ãÊµ¥‰∏çË∂ÖÈÅé5ÂàÜÈêò",
                            "ÈÇäÊ¥óÊæ°ÈÇäÂî±Ê≠åÊîæÈ¨Ü"
                        ],
                        correct: 1,
                        explanation: "Ê≠£Á¢∫ÔºÅÊ∑ãÊµ¥ÊØîÊ≥°Êæ°ÁØÄÁúÅ70%‰ª•‰∏äÁöÑÊ∞¥ÔºåÊéßÂà∂ÊôÇÈñìÂú®5ÂàÜÈêòÂÖßÊòØÊúÄÂ•ΩÁöÑÁØÄÊ∞¥ÊñπÂºè„ÄÇ",
                        esg: ["environment"],
                        points: 25
                    },
                    {
                        question: "Â≠∏Ê†°ÁÇ∫‰ªÄÈ∫ºË¶ÅÂà∂ÂÆöÁî®Ê∞¥Ë¶èÁØÑÔºü",
                        options: [
                            "ÁÇ∫‰∫ÜÁúÅÊ∞¥Ë≤ª",
                            "ÂüπÈ§äÂ≠∏ÁîüÁØÄÊ∞¥ÁøíÊÖ£ÔºåÊ∞∏Á∫åÁôºÂ±ï",
                            "ËÄÅÂ∏´Ë¶èÂÆöÁöÑ"
                        ],
                        correct: 1,
                        explanation: "Ê≠£Á¢∫ÔºÅÂà∂ÂÆöË¶èÁØÑÊòØÊ≤ªÁêÜ(G)ÁöÑÈáçË¶ÅÈÉ®ÂàÜÔºåÂèØ‰ª•Á≥ªÁµ±ÊÄßÂüπÈ§äÂ≠∏ÁîüÁöÑÁØÄÊ∞¥ÁøíÊÖ£ÔºåÂØ¶ÁèæÊ∞∏Á∫åÁôºÂ±ï„ÄÇ",
                        esg: ["governance", "social"],
                        points: 25
                    }
                ]
            },
            
            // Êé¢Á¥¢ÈÅäÊà≤ÁãÄÊÖã
            exploreGame: {
                currentStage: 1
            }
        };

        // ÈÅäÊà≤ÂàùÂßãÂåñ
        function initGame() {
            console.log("üéÆ ÈÅäÊà≤ÂàùÂßãÂåñ...");
            
            // ÂâµÂª∫ÊòüÁ©∫ËÉåÊôØ
            createStars();
            
            // ÂâµÂª∫È≠îÊ≥ïÁ≤íÂ≠ê
            createMagicParticles();
            
            // Ë®≠ÁΩÆÈóúÂç°ÊåâÈàï‰∫ã‰ª∂
            document.querySelectorAll('.level-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const level = parseInt(this.getAttribute('data-level'));
                    startLevel(level);
                });
            });
            
            // Ë®≠ÁΩÆËøîÂõûÊåâÈàï
            document.getElementById('magicBackBtn').addEventListener('click', returnToLevelSelection);
            
            // Ë®≠ÁΩÆÊé•Ê∞¥ÈÅäÊà≤ÊåâÈàï
            document.getElementById('waterStartBtn').addEventListener('click', startWaterChallenge);
            document.getElementById('waterStopBtn').addEventListener('click', stopWaterChallenge);
            document.getElementById('waterRestartBtn').addEventListener('click', restartWaterChallenge);
            
            // Ë®≠ÁΩÆÁü•Ë≠òÈÅäÊà≤ÊåâÈàï
            document.getElementById('quizNextBtn').addEventListener('click', nextQuizQuestion);
            
            // Ë®≠ÁΩÆÂãùÂà©ÊåâÈàï
            document.getElementById('victoryButton').addEventListener('click', returnToLevelSelection);
            
            // Ë®≠ÁΩÆÊéíË°åÊ¶úÈªûÊìä‰∫ã‰ª∂
            document.getElementById('leaderboardSystem').addEventListener('click', showLeaderboardModal);
            document.getElementById('closeLeaderboard').addEventListener('click', hideLeaderboardModal);
            
            // Ë®≠ÁΩÆË®ªÂÜäÊåâÈàï‰∫ã‰ª∂
            document.getElementById('registerBtn').addEventListener('click', registerPlayer);
            document.getElementById('playerNameInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') registerPlayer();
            });
            
            // ÂàùÂßãÂåñÁé©ÂÆ∂Á≥ªÁµ±ÂíåÊéíË°åÊ¶ú
            initPlayerSystem();
            initLeaderboard();
            
            console.log("üéÆ ÈÅäÊà≤ÂàùÂßãÂåñÂÆåÊàêÔºÅ");
        }

        // ÂàùÂßãÂåñÁé©ÂÆ∂Á≥ªÁµ±
        function initPlayerSystem() {
            const savedPlayer = localStorage.getItem('waterGeniusPlayer');
            const savedDate = localStorage.getItem('waterGeniusDate');
            const today = new Date().toDateString();
            
            if (savedPlayer && savedDate === today) {
                gameState.player = JSON.parse(savedPlayer);
                gameState.player.registered = true;
                hidePlayerRegister();
                updatePlayerInfoDisplay();
                showLevelSelection();
            } else {
                localStorage.removeItem('waterGeniusPlayer');
                showPlayerRegister();
            }
        }

        // ÂàùÂßãÂåñÊéíË°åÊ¶ú
        function initLeaderboard() {
            const savedLeaderboard = localStorage.getItem('waterGeniusLeaderboard');
            const savedLeaderboardDate = localStorage.getItem('waterGeniusLeaderboardDate');
            const today = new Date().toDateString();
            
            if (savedLeaderboard && savedLeaderboardDate === today) {
                gameState.leaderboard = JSON.parse(savedLeaderboard);
            } else {
                gameState.leaderboard = [];
                saveLeaderboard();
            }
            
            updateLeaderboardDisplay();
        }

        // È°ØÁ§∫Áé©ÂÆ∂Ë®ªÂÜä
        function showPlayerRegister() {
            document.getElementById('playerRegisterModal').style.display = 'flex';
        }

        // Èö±ËóèÁé©ÂÆ∂Ë®ªÂÜä
        function hidePlayerRegister() {
            document.getElementById('playerRegisterModal').style.display = 'none';
        }

        // Ë®ªÂÜäÁé©ÂÆ∂
        function registerPlayer() {
            const playerName = document.getElementById('playerNameInput').value.trim();
            
            if (!playerName) {
                alert('Ë´ãËº∏ÂÖ•ÊÇ®ÁöÑÊö±Á®±ÔºÅ');
                return;
            }
            
            if (playerName.length > 10) {
                alert('Êö±Á®±‰∏çËÉΩË∂ÖÈÅé10ÂÄãÂ≠óÔºÅ');
                return;
            }
            
            gameState.player.name = playerName;
            gameState.player.avatar = getAvatarFromName(playerName);
            gameState.player.registered = true;
            gameState.player.currentScore = 0;
            
            const today = new Date().toDateString();
            localStorage.setItem('waterGeniusPlayer', JSON.stringify(gameState.player));
            localStorage.setItem('waterGeniusDate', today);
            
            hidePlayerRegister();
            updatePlayerInfoDisplay();
            showLevelSelection();
            showWelcomeMessage();
        }

        // Ê†πÊìöÂêçÁ®±ÁîüÊàêÈ†≠ÂÉè
        function getAvatarFromName(name) {
            const avatars = ['üë¶', 'üëß', 'üë®', 'üë©', 'üßí', 'üßë', 'üë±', 'üë¥', 'üëµ'];
            const charCode = name.charCodeAt(0) || 0;
            return avatars[charCode % avatars.length];
        }

        // Êõ¥Êñ∞Áé©ÂÆ∂Ë≥áË®äÈ°ØÁ§∫
        function updatePlayerInfoDisplay() {
            if (!gameState.player.registered) return;
            
            document.getElementById('playerInfoSystem').style.display = 'flex';
            document.getElementById('playerAvatar').textContent = gameState.player.avatar;
            document.getElementById('playerNameDisplay').textContent = gameState.player.name;
            document.getElementById('playerDropsCount').textContent = gameState.abilities.waterDrops;
        }

        // È°ØÁ§∫Ê≠°ËøéÊ∂àÊÅØ
        function showWelcomeMessage() {
            const welcomeMessages = [
                `Ê≠°Ëøé ${gameState.player.name}ÔºÅ‰∏ÄËµ∑‰æÜÁØÄÊ∞¥ÂêßÔºÅ`,
                `${gameState.player.name}ÔºåÊ∫ñÂÇôÂ•ΩÊàêÁÇ∫ÁØÄÊ∞¥Â∞èÂ§©Êâç‰∫ÜÂóéÔºü`,
                `Ê≠°ËøéÂä†ÂÖ•‰ªôÊ¥ûÁØÄÊ∞¥ÈöäÔºå${gameState.player.name}ÔºÅ`
            ];
            
            const message = welcomeMessages[Math.floor(Math.random() * welcomeMessages.length)];
            console.log(message);
        }

        // ÂâµÂª∫ÊòüÁ©∫
        function createStars() {
            const starBg = document.getElementById('starBg');
            for (let i = 0; i < 100; i++) {
                const star = document.createElement('div');
                star.className = 'star';
                star.style.left = `${Math.random() * 100}%`;
                star.style.top = `${Math.random() * 100}%`;
                star.style.width = `${Math.random() * 3 + 1}px`;
                star.style.height = star.style.width;
                star.style.animationDelay = `${Math.random() * 3}s`;
                starBg.appendChild(star);
            }
        }

        // ÂâµÂª∫È≠îÊ≥ïÁ≤íÂ≠ê
        function createMagicParticles() {
            const particles = document.getElementById('magicParticles');
            particles.innerHTML = '';
            
            for (let i = 0; i < 20; i++) {
                const particle = document.createElement('div');
                particle.className = 'magic-particle';
                particle.style.left = `${Math.random() * 100}%`;
                particle.style.width = `${Math.random() * 10 + 5}px`;
                particle.style.height = particle.style.width;
                particle.style.backgroundColor = getRandomColor();
                particle.style.animationDelay = `${Math.random() * 5}s`;
                particle.style.animationDuration = `${Math.random() * 5 + 10}s`;
                particles.appendChild(particle);
            }
        }

        function getRandomColor() {
            const colors = ['#36D1DC', '#5B86E5', '#FF6B6B', '#4CAF50', '#FFD700', '#FF9800'];
            return colors[Math.floor(Math.random() * colors.length)];
        }

        // È°ØÁ§∫ÈóúÂç°ÈÅ∏Êìá
        function showLevelSelection() {
            gameState.currentLevel = 1;
            
            document.getElementById('levelSelection').style.display = 'flex';
            document.querySelector('.game-content').style.display = 'none';
            document.getElementById('magicBackBtn').style.display = 'none';
            
            updateLevelDisplay();
            
            document.querySelectorAll('.level-btn').forEach((btn, index) => {
                const levelNum = index + 1;
                const level = gameState.levels[levelNum];
                
                if (levelNum === 1 || gameState.levels[levelNum - 1].completed) {
                    btn.disabled = false;
                    btn.style.opacity = '1';
                } else {
                    btn.disabled = true;
                    btn.style.opacity = '0.5';
                }
                
                if (level.completed) {
                    btn.style.borderColor = '#FFD700';
                    btn.style.boxShadow = '0 0 30px rgba(255, 215, 0, 0.5)';
                    const rewardText = btn.querySelector('.level-reward span');
                    rewardText.textContent = 'Â∑≤ÂÆåÊàêÔºÅ';
                    rewardText.style.color = '#FFD700';
                }
            });
        }

        // ÈñãÂßãÈóúÂç°
        function startLevel(levelNum) {
            if (!gameState.player.registered) {
                alert('Ë´ãÂÖàË®ªÂÜäÁé©ÂÆ∂ÔºÅ');
                showPlayerRegister();
                return;
            }
            
            gameState.currentLevel = levelNum;
            const level = gameState.levels[levelNum];
            
            document.getElementById('levelSelection').style.display = 'none';
            document.querySelector('.game-content').style.display = 'block';
            document.getElementById('magicBackBtn').style.display = 'flex';
            
            document.getElementById('waterGameArea').style.display = 'none';
            document.getElementById('quizGameArea').style.display = 'none';
            document.getElementById('exploreGameArea').style.display = 'none';
            
            if (level.type === 'water') {
                startWaterLevel(levelNum);
            } else if (level.type === 'quiz') {
                startQuizLevel(levelNum);
            } else if (level.type === 'mixed') {
                startMixedLevel(levelNum);
            }
            
            updateLevelDisplay();
            createMagicParticles();
        }

        // ÈñãÂßãÊé•Ê∞¥ÈóúÂç°
        function startWaterLevel(levelNum) {
            const level = gameState.levels[levelNum];
            
            document.getElementById('waterGameArea').style.display = 'block';
            
            document.getElementById('waterMissionDesc').textContent = 
                `Âú®${level.timeLimit}ÁßíÂÖßÊé•Âà∞ÂâõÂ•Ω250mlÁöÑÊ∞¥ÔºÅ`;
            
            const requirements = document.getElementById('waterRequirements');
            requirements.innerHTML = '';
            
            level.requirements.forEach(req => {
                const reqElement = document.createElement('div');
                reqElement.className = 'requirement';
                reqElement.innerHTML = `<i class="fas fa-circle" style="font-size: 0.8rem;"></i> ${req.text}`;
                requirements.appendChild(reqElement);
            });
            
            resetWaterGame(level);
            document.getElementById('waterTimer').textContent = `${level.timeLimit}.0 Áßí`;
            document.getElementById('waterBestScore').textContent = `${level.bestScore} ÂàÜ`;
        }

        // ÈáçÁΩÆÊé•Ê∞¥ÈÅäÊà≤
        function resetWaterGame(level) {
            const waterGame = gameState.waterGame;
            
            clearInterval(waterGame.timerInterval);
            clearInterval(waterGame.waterInterval);
            
            waterGame.isRunning = false;
            waterGame.timer = level.timeLimit;
            waterGame.waterLevel = 0;
            waterGame.currentAttempt = 0;
            waterGame.levelScore = 0;
            waterGame.accuracy = 0;
            
            document.getElementById('waterLevelComplex').style.height = '0%';
            document.getElementById('waterStream').style.height = '0';
            document.getElementById('currentWater').textContent = '0 ml';
            document.getElementById('waterStartBtn').disabled = false;
            document.getElementById('waterStopBtn').disabled = true;
            document.getElementById('waterFeedback').style.display = 'none';
        }

        // ÈñãÂßãÊé•Ê∞¥ÊåëÊà∞
        function startWaterChallenge() {
            const level = gameState.levels[gameState.currentLevel];
            const waterGame = gameState.waterGame;
            
            if (waterGame.currentAttempt >= level.attempts) {
                showWaterFeedback(`‚ùå ÊåëÊà∞Ê¨°Êï∏Áî®Áõ°ÔºÅÊúÄÈ´òÂæóÂàÜÔºö${waterGame.levelScore}ÂàÜ`, 'error');
                return;
            }
            
            waterGame.currentAttempt++;
            waterGame.isRunning = true;
            waterGame.timer = level.timeLimit;
            waterGame.waterLevel = 0;
            
            document.getElementById('waterStartBtn').disabled = true;
            document.getElementById('waterStopBtn').disabled = false;
            document.getElementById('waterLevelComplex').style.height = '0%';
            document.getElementById('waterStream').style.height = '150px';
            document.getElementById('waterFeedback').style.display = 'none';
            
            waterGame.timerInterval = setInterval(() => {
                waterGame.timer -= 0.1;
                document.getElementById('waterTimer').textContent = waterGame.timer.toFixed(1) + ' Áßí';
                
                if (waterGame.timer <= 0) {
                    stopWaterChallenge();
                }
            }, 100);
            
            waterGame.waterInterval = setInterval(() => {
                if (waterGame.isRunning) {
                    let waterSpeed = 2;
                    if (gameState.currentLevel === 3) waterSpeed = 3.5;
                    if (gameState.currentLevel === 4) waterSpeed = 5;
                    
                    const stability = gameState.abilities.waterSkill / 100;
                    const increase = waterSpeed * (0.8 + Math.random() * 0.4 * stability);
                    
                    waterGame.waterLevel += increase;
                    
                    const waterPercentage = Math.min(waterGame.waterLevel / 300 * 100, 100);
                    document.getElementById('waterLevelComplex').style.height = waterPercentage + '%';
                    document.getElementById('currentWater').textContent = `${waterGame.waterLevel.toFixed(1)} ml`;
                    
                    const error = Math.abs(waterGame.waterLevel - 250);
                    
                    if (waterGame.waterLevel < 150) {
                        showWaterFeedback("üíß Ê∞¥ÈÇÑ‰∏çÂ§†ÔºåÁπºÁ∫åÂä†Ê≤πÔºÅ", 'warning');
                    } else if (error <= 10) {
                        showWaterFeedback("üéØ ÂÆåÁæéÔºÅÊ∫ñÂÇôÂÅúÊ≠¢ÔºÅ", 'success');
                    } else if (waterGame.waterLevel > 280) {
                        showWaterFeedback("üí¶ Â§™Â§ö‰∫ÜÔºÅË∂ïÂø´ÂÅúÊ≠¢ÔºÅ", 'error');
                    }
                    
                    if (waterGame.waterLevel > 300) {
                        showWaterFeedback("‚ùå Âö¥ÈáçÊµ™Ë≤ªÔºÅÊåëÊà∞Â§±ÊïóÔºÅ", 'error');
                        setTimeout(stopWaterChallenge, 300);
                    }
                }
            }, 200);
            
            showWaterFeedback(`Á¨¨ ${waterGame.currentAttempt} Ê¨°ÊåëÊà∞ÈñãÂßãÔºÅ`, 'warning');
        }

        // ÂÅúÊ≠¢Êé•Ê∞¥ÊåëÊà∞
        function stopWaterChallenge() {
            const waterGame = gameState.waterGame;
            
            if (!waterGame.isRunning) return;
            
            waterGame.isRunning = false;
            clearInterval(waterGame.timerInterval);
            clearInterval(waterGame.waterInterval);
            
            document.getElementById('waterStartBtn').disabled = false;
            document.getElementById('waterStopBtn').disabled = true;
            document.getElementById('waterStream').style.height = '0';
            
            const level = gameState.levels[gameState.currentLevel];
            const error = Math.abs(waterGame.waterLevel - 250);
            let score = 0;
            let feedback = '';
            let feedbackType = '';
            
            if (error <= 10) {
                score = 100 - error * 3;
                feedback = `üéØ ÂÆåÁæéÔºÅÂè™Â∑Æ ${error.toFixed(1)}mlÔºÅ`;
                feedbackType = 'success';
            } else if (error <= 30) {
                score = 80 - error * 2;
                feedback = `üëç ‰∏çÈåØÔºÅÂ∑Æ ${error.toFixed(1)}ml`;
                feedbackType = 'success';
            } else if (error <= 50) {
                score = 60 - error;
                feedback = `üíß ÈÇÑÂèØ‰ª•Êõ¥Â•ΩÔºåÂ∑Æ ${error.toFixed(1)}ml`;
                feedbackType = 'warning';
            } else {
                score = Math.max(10, 50 - error / 2);
                feedback = `üí¶ Â∑Æ ${error.toFixed(1)}mlÔºåÂÜçÊé•ÂÜçÂé≤ÔºÅ`;
                feedbackType = 'error';
            }
            
            const timeBonus = Math.max(0, waterGame.timer * 2);
            score += timeBonus;
            
            const abilityBonus = score * (gameState.abilities.waterSkill / 100);
            score += abilityBonus;
            
            score = Math.min(Math.round(score), 100);
            
            if (score > waterGame.levelScore) {
                waterGame.levelScore = score;
                waterGame.accuracy = error;
            }
            
            showWaterFeedback(`${feedback}<br>ÂæóÂàÜÔºö${score}ÂàÜÔºàÊú¨Ê¨°ÊåëÊà∞Ôºâ`, feedbackType);
            
            if (waterGame.levelScore >= level.targetScore) {
                completeWaterLevel();
            }
            
            updateWaterSkill(score);
        }

        // ÂÆåÊàêÊé•Ê∞¥ÈóúÂç°
        function completeWaterLevel() {
            const levelNum = gameState.currentLevel;
            const level = gameState.levels[levelNum];
            const waterGame = gameState.waterGame;
            
            level.completed = true;
            level.bestScore = Math.max(level.bestScore, waterGame.levelScore);
            
            const reward = calculateReward(levelNum, waterGame.levelScore);
            gameState.abilities.waterDrops += reward;
            
            showFireworksAndScore(waterGame.levelScore);
            addScoreToLeaderboard(waterGame.levelScore, level.name);
            
            setTimeout(() => {
                showVictory(
                    level.name,
                    `ÊÅ≠ÂñúÂÆåÊàê${level.name}ÔºÅ<br>ÊúÄÁµÇÂæóÂàÜÔºö${waterGame.levelScore}ÂàÜ<br>Ë™§Â∑ÆÔºö${waterGame.accuracy.toFixed(1)}ml`,
                    reward
                );
            }, 2000);
            
            if (levelNum < 4) {
                gameState.levels[levelNum + 1].completed = false;
            }
            
            updatePlayerInfoDisplay();
        }

        // ÈáçÂïüÊé•Ê∞¥ÊåëÊà∞
        function restartWaterChallenge() {
            const level = gameState.levels[gameState.currentLevel];
            resetWaterGame(level);
        }

        // È°ØÁ§∫Êé•Ê∞¥ÈÅäÊà≤ÂèçÈ•ã
        function showWaterFeedback(text, type) {
            const feedback = document.getElementById('waterFeedback');
            feedback.innerHTML = text;
            feedback.className = `water-feedback feedback-${type}`;
            feedback.style.display = 'block';
        }

        // ÈñãÂßãÁü•Ë≠òÈóúÂç°
        function startQuizLevel(levelNum) {
            const level = gameState.levels[levelNum];
            
            document.getElementById('quizGameArea').style.display = 'block';
            
            gameState.quizGame.currentQuestion = 0;
            gameState.quizGame.score = 0;
            gameState.quizGame.answered = false;
            
            document.getElementById('quizMissionDesc').textContent = 
                `ÂõûÁ≠î${level.questions}È°åÁØÄÊ∞¥Áü•Ë≠òÂïèÈ°åÔºåÁõÆÊ®ôÂàÜÊï∏Ôºö${level.targetScore}ÂàÜÔºÅ`;
            
            const requirements = document.getElementById('quizRequirements');
            requirements.innerHTML = '';
            
            level.requirements.forEach(req => {
                const reqElement = document.createElement('div');
                reqElement.className = 'requirement';
                reqElement.innerHTML = `<i class="fas fa-circle" style="font-size: 0.8rem;"></i> ${req.text}`;
                requirements.appendChild(reqElement);
            });
            
            loadQuizQuestion();
        }

        // ËºâÂÖ•Áü•Ë≠òÂïèÈ°å
        function loadQuizQuestion() {
            const quiz = gameState.quizGame;
            const level = gameState.levels[gameState.currentLevel];
            const question = quiz.questions[quiz.currentQuestion];
            
            document.getElementById('currentQuestionNum').textContent = quiz.currentQuestion + 1;
            document.getElementById('totalQuestions').textContent = level.questions || 4;
            const progress = ((quiz.currentQuestion) / (level.questions || 4)) * 100;
            document.getElementById('quizProgressFill').style.width = `${progress}%`;
            
            document.getElementById('quizScore').textContent = quiz.score;
            document.getElementById('quizQuestionText').textContent = question.question;
            
            const optionsGrid = document.getElementById('quizOptionsGrid');
            optionsGrid.innerHTML = '';
            
            question.options.forEach((option, index) => {
                const optionBtn = document.createElement('div');
                optionBtn.className = 'quiz-option-btn';
                optionBtn.innerHTML = `
                    <div class="option-label">${String.fromCharCode(65 + index)}</div>
                    <div class="option-text">${option}</div>
                `;
                
                optionBtn.addEventListener('click', () => {
                    if (quiz.answered) return;
                    
                    quiz.answered = true;
                    
                    document.querySelectorAll('.quiz-option-btn').forEach(btn => {
                        btn.classList.remove('selected');
                    });
                    optionBtn.classList.add('selected');
                    
                    const isCorrect = index === question.correct;
                    
                    if (isCorrect) {
                        optionBtn.classList.add('correct');
                        quiz.score += question.points;
                        document.getElementById('quizScore').textContent = quiz.score;
                        updateKnowledgeSkill(question.points);
                    } else {
                        optionBtn.classList.add('incorrect');
                        document.querySelectorAll('.quiz-option-btn')[question.correct].classList.add('correct');
                    }
                    
                    document.getElementById('quizFeedbackText').textContent = question.explanation;
                    
                    const esgTags = document.getElementById('quizEsgTags');
                    esgTags.innerHTML = '';
                    
                    question.esg.forEach(tag => {
                        const tagElement = document.createElement('div');
                        tagElement.className = `quiz-esg-tag tag-${tag}`;
                        
                        let icon = '', text = '';
                        if (tag === 'environment') {
                            icon = 'fa-leaf';
                            text = 'ÊÑõÂú∞ÁêÉ';
                        } else if (tag === 'social') {
                            icon = 'fa-users';
                            text = 'Â•ΩÂ≠∏Áîü';
                        } else if (tag === 'governance') {
                            icon = 'fa-balance-scale';
                            text = 'ÂÆàË¶èÂâá';
                        }
                        
                        tagElement.innerHTML = `<i class="fas ${icon}"></i> ${text}`;
                        esgTags.appendChild(tagElement);
                    });
                    
                    document.getElementById('quizFeedbackCard').style.display = 'block';
                    
                    if (isCorrect) {
                        gameState.abilities.waterDrops += 2;
                    }
                });
                
                optionsGrid.appendChild(optionBtn);
            });
            
            document.getElementById('quizFeedbackCard').style.display = 'none';
            
            const nextBtn = document.getElementById('quizNextBtn');
            if (quiz.currentQuestion === (level.questions || 4) - 1) {
                nextBtn.innerHTML = 'ÂÆåÊàêÊåëÊà∞ <i class="fas fa-check"></i>';
            } else {
                nextBtn.innerHTML = '‰∏ã‰∏ÄÈ°å <i class="fas fa-arrow-right"></i>';
            }
        }

        // ‰∏ã‰∏ÄÈ°åÁü•Ë≠òÂïèÈ°å
        function nextQuizQuestion() {
            const quiz = gameState.quizGame;
            const level = gameState.levels[gameState.currentLevel];
            
            if (!quiz.answered && quiz.currentQuestion < (level.questions || 4) - 1) {
                showQuizFeedback("Ë´ãÂÖàÂõûÁ≠îÈÄô‰∏ÄÈ°åÔºÅ", 'warning');
                return;
            }
            
            quiz.answered = false;
            
            if (quiz.currentQuestion < (level.questions || 4) - 1) {
                quiz.currentQuestion++;
                loadQuizQuestion();
            } else {
                completeQuizLevel();
            }
        }

        // ÂÆåÊàêÁü•Ë≠òÈóúÂç°
        function completeQuizLevel() {
            const levelNum = gameState.currentLevel;
            const level = gameState.levels[levelNum];
            const quiz = gameState.quizGame;
            
            const finalScore = quiz.score;
            level.bestScore = Math.max(level.bestScore, finalScore);
            
            if (finalScore >= level.targetScore) {
                level.completed = true;
                
                const reward = calculateReward(levelNum, finalScore);
                gameState.abilities.waterDrops += reward;
                
                showFireworksAndScore(finalScore);
                addScoreToLeaderboard(finalScore, level.name);
                
                setTimeout(() => {
                    showVictory(
                        level.name,
                        `ÊÅ≠ÂñúÂÆåÊàê${level.name}ÔºÅ<br>ÊúÄÁµÇÂæóÂàÜÔºö${finalScore}ÂàÜ<br>Á≠îÂ∞ç ${quiz.score / 25} È°å`,
                        reward
                    );
                }, 2000);
                
                if (levelNum < 4) {
                    gameState.levels[levelNum + 1].completed = false;
                }
                
                updatePlayerInfoDisplay();
            } else {
                showQuizFeedback(`ÊåëÊà∞Â§±ÊïóÔºÅÂæóÂàÜÔºö${finalScore}ÂàÜÔºåÈúÄË¶Å ${level.targetScore}ÂàÜÊâçËÉΩÈÅéÈóú„ÄÇ`, 'error');
                setTimeout(() => {
                    startQuizLevel(levelNum);
                }, 2000);
            }
        }

        // È°ØÁ§∫Áü•Ë≠òÈÅäÊà≤ÂèçÈ•ã
        function showQuizFeedback(text, type) {
            const feedback = document.getElementById('quizFeedbackText');
            feedback.textContent = text;
            document.getElementById('quizFeedbackCard').style.display = 'block';
        }

        // ÈñãÂßãÊ∑∑ÂêàÈóúÂç°
        function startMixedLevel(levelNum) {
            if (gameState.abilities.waterSkill > gameState.abilities.knowledgeSkill) {
                startQuizLevel(levelNum);
            } else {
                startWaterLevel(levelNum);
            }
        }

        // Ë®àÁÆóÁçéÂãµ
        function calculateReward(levelNum, score) {
            const level = gameState.levels[levelNum];
            const min = level.reward.min;
            const max = level.reward.max;
            
            const multiplier = score / 100;
            let reward = min + (max - min) * multiplier;
            
            const abilityBonus = reward * (gameState.abilities.ecoSkill / 200);
            reward += abilityBonus;
            
            return Math.round(reward);
        }

        // È°ØÁ§∫ÂãùÂà©ÂãïÁï´
        function showVictory(title, message, reward) {
            const victory = gameState.levels[gameState.currentLevel].completed ? 'üèÜ' : '‚ú®';
            
            document.getElementById('victoryIcon').textContent = victory;
            document.getElementById('victoryTitle').textContent = title;
            document.getElementById('victoryMessage').innerHTML = message;
            
            const rewardsDiv = document.getElementById('victoryRewards');
            rewardsDiv.innerHTML = `
                <div class="victory-reward">
                    <div class="reward-icon">üíß</div>
                    <div class="reward-text">+${reward} Ê∞¥Êª¥</div>
                </div>
                <div class="victory-reward">
                    <div class="reward-icon">üåü</div>
                    <div class="reward-text">ËÉΩÂäõÊèêÂçáÔºÅ</div>
                </div>
            `;
            
            document.getElementById('victoryCelebration').style.display = 'flex';
            updateAbilitiesDisplay();
        }

        // È°ØÁ§∫ÁÖôÁÅ´ÂíåÂàÜÊï∏
        function showFireworksAndScore(score) {
            const scoreDisplay = document.getElementById('scoreDisplay');
            scoreDisplay.textContent = score;
            scoreDisplay.style.display = 'block';
            
            createFireworks();
            
            setTimeout(() => {
                scoreDisplay.style.display = 'none';
            }, 3000);
        }

        // ÂâµÂª∫ÁÖôÁÅ´ÂãïÁï´
        function createFireworks() {
            const container = document.getElementById('fireworksContainer');
            container.style.display = 'block';
            container.innerHTML = '';
            
            const colors = ['#FFD700', '#36D1DC', '#FF6B6B', '#4CAF50', '#FF9800', '#9C27B0'];
            
            for (let i = 0; i < 5; i++) {
                setTimeout(() => {
                    createSingleFirework(
                        Math.random() * window.innerWidth,
                        window.innerHeight,
                        colors[Math.floor(Math.random() * colors.length)]
                    );
                }, i * 300);
            }
            
            setTimeout(() => {
                container.style.display = 'none';
            }, 5000);
        }

        // ÂâµÂª∫ÂñÆÂÄãÁÖôÁÅ´
        function createSingleFirework(x, y, color) {
            const container = document.getElementById('fireworksContainer');
            
            const firework = document.createElement('div');
            firework.className = 'firework';
            firework.style.left = `${x}px`;
            firework.style.top = `${y}px`;
            firework.style.backgroundColor = color;
            container.appendChild(firework);
            
            setTimeout(() => {
                const particleCount = 30 + Math.floor(Math.random() * 20);
                for (let i = 0; i < particleCount; i++) {
                    const particle = document.createElement('div');
                    particle.className = 'firework-particle';
                    particle.style.left = `${x}px`;
                    particle.style.top = `${y - 50}px`;
                    particle.style.backgroundColor = color;
                    
                    const angle = Math.random() * Math.PI * 2;
                    const distance = 50 + Math.random() * 100;
                    const tx = Math.cos(angle) * distance;
                    const ty = Math.sin(angle) * distance;
                    
                    particle.style.setProperty('--tx', `${tx}px`);
                    particle.style.setProperty('--ty', `${ty}px`);
                    
                    container.appendChild(particle);
                }
            }, 500);
        }

        // Êõ¥Êñ∞ÊéíË°åÊ¶úÈ°ØÁ§∫
        function updateLeaderboardDisplay() {
            if (gameState.leaderboard.length > 0) {
                const topPlayer = gameState.leaderboard[0];
                document.getElementById('topPlayerName').textContent = topPlayer.name;
                document.getElementById('topPlayerScore').textContent = topPlayer.score;
            }
            
            updateLeaderboardTable();
        }

        // Êõ¥Êñ∞ÊéíË°åÊ¶úË°®Ê†º
        function updateLeaderboardTable() {
            const tbody = document.getElementById('leaderboardTableBody');
            tbody.innerHTML = '';
            
            gameState.leaderboard.slice(0, 10).forEach((player, index) => {
                const row = document.createElement('tr');
                row.className = `rank-${index + 1}`;
                
                row.innerHTML = `
                    <td>
                        <div class="rank-cell">${index + 1}</div>
                    </td>
                    <td>
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <div style="font-size: 1.8rem;">${player.avatar}</div>
                            <div>${player.name}</div>
                        </div>
                    </td>
                    <td>${player.level}</td>
                    <td style="color: #FFD700; font-weight: bold;">${player.score}</td>
                    <td>${player.time}</td>
                `;
                
                tbody.appendChild(row);
            });
        }

        // Ê∑ªÂä†ÂàÜÊï∏Âà∞ÊéíË°åÊ¶ú
        function addScoreToLeaderboard(score, levelName) {
            if (!gameState.player.registered) return;
            
            const now = new Date();
            const timeString = now.toLocaleTimeString('zh-TW', { 
                hour: '2-digit', 
                minute: '2-digit' 
            });
            
            const entry = {
                name: gameState.player.name,
                avatar: gameState.player.avatar,
                score: score,
                level: levelName,
                time: timeString,
                timestamp: now.getTime()
            };
            
            gameState.leaderboard.push(entry);
            
            gameState.leaderboard.sort((a, b) => {
                if (b.score !== a.score) {
                    return b.score - a.score;
                }
                return a.timestamp - b.timestamp;
            });
            
            gameState.leaderboard = gameState.leaderboard.slice(0, 50);
            
            saveLeaderboard();
            updateLeaderboardDisplay();
            
            const rank = gameState.leaderboard.findIndex(p => 
                p.name === gameState.player.name && 
                p.score === score
            ) + 1;
            
            if (rank <= 3) {
                showRankCelebration(rank, score);
            }
        }

        // ‰øùÂ≠òÊéíË°åÊ¶ú
        function saveLeaderboard() {
            const today = new Date().toDateString();
            localStorage.setItem('waterGeniusLeaderboard', JSON.stringify(gameState.leaderboard));
            localStorage.setItem('waterGeniusLeaderboardDate', today);
        }

        // È°ØÁ§∫ÊéíË°åÊ¶úÂΩàÁ™ó
        function showLeaderboardModal() {
            document.getElementById('leaderboardModal').style.display = 'flex';
            updateLeaderboardTable();
        }

        // Èö±ËóèÊéíË°åÊ¶úÂΩàÁ™ó
        function hideLeaderboardModal() {
            document.getElementById('leaderboardModal').style.display = 'none';
        }

        // ÊéíÂêçÊÖ∂Á•ùÂãïÁï´
        function showRankCelebration(rank, score) {
            const rankTitles = ['ü•á ÂÜ†ËªçÔºÅ', 'ü•à ‰∫ûËªçÔºÅ', 'ü•â Â≠£ËªçÔºÅ'];
            const rankColors = ['#FFD700', '#C0C0C0', '#CD7F32'];
            
            if (rank <= 3) {
                const celebration = document.getElementById('rankCelebration');
                celebration.textContent = `${rankTitles[rank - 1]}\n${score}ÂàÜ`;
                celebration.style.color = rankColors[rank - 1];
                celebration.style.textShadow = `0 0 30px ${rankColors[rank - 1]}`;
                celebration.style.display = 'block';
                
                setTimeout(() => {
                    celebration.style.display = 'none';
                }, 3000);
            }
        }

        // Êõ¥Êñ∞ËÉΩÂäõÂÄº
        function updateWaterSkill(score) {
            const improvement = score / 2000;
            gameState.abilities.waterSkill = Math.min(100, gameState.abilities.waterSkill + improvement * 100);
            updateAbilitiesDisplay();
        }

        function updateKnowledgeSkill(points) {
            const improvement = points / 100;
            gameState.abilities.knowledgeSkill = Math.min(100, gameState.abilities.knowledgeSkill + improvement * 100);
            gameState.abilities.ecoSkill = Math.min(100, gameState.abilities.ecoSkill + 5);
            updateAbilitiesDisplay();
        }

        // Êõ¥Êñ∞ËÉΩÂäõÂÄºÈ°ØÁ§∫
        function updateAbilitiesDisplay() {
            const abilities = gameState.abilities;
            
            document.getElementById('waterSkill').textContent = `${Math.round(abilities.waterSkill)}%`;
            document.getElementById('knowledgeSkill').textContent = `${Math.round(abilities.knowledgeSkill)}%`;
            document.getElementById('ecoSkill').textContent = `${Math.round(abilities.ecoSkill)}%`;
            document.getElementById('speedSkill').textContent = `${Math.round(abilities.speedSkill)}%`;
            
            document.getElementById('waterSkillBar').style.width = `${abilities.waterSkill}%`;
            document.getElementById('knowledgeSkillBar').style.width = `${abilities.knowledgeSkill}%`;
            document.getElementById('ecoSkillBar').style.width = `${abilities.ecoSkill}%`;
            document.getElementById('speedSkillBar').style.width = `${abilities.speedSkill}%`;
        }

        // Êõ¥Êñ∞ÈóúÂç°È°ØÁ§∫
        function updateLevelDisplay() {
            document.getElementById('currentLevel').textContent = gameState.currentLevel;
            
            const completedLevels = Object.values(gameState.levels).filter(level => level.completed).length;
            const progress = (completedLevels / 4) * 100;
            document.getElementById('levelProgressBar').style.width = `${progress}%`;
        }

        // ËøîÂõûÈóúÂç°ÈÅ∏Êìá
        function returnToLevelSelection() {
            document.getElementById('victoryCelebration').style.display = 'none';
            showLevelSelection();
        }

        // ÈÅäÊà≤ÂïüÂãï
        window.addEventListener('DOMContentLoaded', initGame);
        
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initGame);
        } else {
            initGame();
        }
    </script>
</body>
</html>