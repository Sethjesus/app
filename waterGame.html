<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä»™æ´åœ‹å° ESGæ°´è³‡æºå®ˆè­·è€…</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Arial', 'Microsoft JhengHei', sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #e6f7ff 0%, #f0f9ff 100%);
            color: #333;
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background-color: white;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 100, 200, 0.1);
            overflow: hidden;
            border: 5px solid #4a90e2;
        }
        
        header {
            background: linear-gradient(to right, #1e6fd9, #22a7f0);
            color: white;
            padding: 25px;
            text-align: center;
            border-bottom: 5px solid #0d4d9c;
        }
        
        h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }
        
        .game-area {
            padding: 30px;
        }
        
        .game-title {
            color: #1e6fd9;
            border-bottom: 3px solid #4a90e2;
            padding-bottom: 10px;
            margin-bottom: 25px;
            font-size: 1.8rem;
        }
        
        .water-game {
            text-align: center;
        }
        
        .player-info {
            background-color: #f0f9ff;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            max-width: 500px;
            margin-left: auto;
            margin-right: auto;
            text-align: left;
        }
        
        .player-info label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #1e6fd9;
        }
        
        .player-info input {
            width: 100%;
            padding: 12px;
            border: 2px solid #cce7ff;
            border-radius: 8px;
            font-size: 1rem;
            margin-bottom: 15px;
        }
        
        .water-container {
            width: 300px;
            height: 400px;
            margin: 20px auto;
            position: relative;
            background-color: #e1f5fe;
            border-radius: 10px;
            border: 5px solid #4a90e2;
            overflow: hidden;
        }
        
        .water-faucet {
            width: 60px;
            height: 40px;
            background-color: #aaa;
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            border-radius: 10px 10px 0 0;
        }
        
        .water-faucet::after {
            content: '';
            position: absolute;
            width: 20px;
            height: 20px;
            background-color: #4a90e2;
            border-radius: 50%;
            bottom: -10px;
            left: 50%;
            transform: translateX(-50%);
        }
        
        .water-stream {
            width: 10px;
            height: 0;
            background-color: #4a90e2;
            position: absolute;
            top: 60px;
            left: 50%;
            transform: translateX(-50%);
            transition: height 0.3s;
        }
        
        .water-cup {
            width: 180px;
            height: 200px;
            background-color: rgba(255, 255, 255, 0.8);
            border: 5px solid #FF9800;
            border-radius: 10px 10px 40px 40px;
            position: absolute;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            overflow: hidden;
        }
        
        .water-in-cup {
            width: 100%;
            height: 0%;
            background-color: rgba(33, 150, 243, 0.7);
            position: absolute;
            bottom: 0;
            transition: height 0.5s;
        }
        
        .water-level {
            position: absolute;
            right: -40px;
            height: 100%;
            width: 40px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            align-items: flex-end;
        }
        
        .level-mark {
            width: 20px;
            border-top: 2px solid #666;
            text-align: right;
            padding-right: 5px;
            font-size: 0.8rem;
            color: #333;
        }
        
        .timer {
            font-size: 2.5rem;
            font-weight: bold;
            color: #2196F3;
            margin: 20px 0;
        }
        
        .game-btn {
            background-color: #2196F3;
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 50px;
            font-size: 1.2rem;
            font-weight: bold;
            cursor: pointer;
            margin: 0 10px;
            transition: all 0.3s;
        }
        
        .game-btn:hover {
            background-color: #0D47A1;
        }
        
        .game-btn:disabled {
            background-color: #ccc;
            cursor: not-allowed;
        }
        
        .real-time-feedback {
            margin: 15px 0;
            padding: 10px 20px;
            border-radius: 10px;
            font-weight: bold;
            min-height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
        }
        
        .feedback-good {
            background-color: #E8F5E9;
            color: #2E7D32;
            border: 2px solid #4CAF50;
        }
        
        .feedback-warning {
            background-color: #FFF3E0;
            color: #EF6C00;
            border: 2px solid #FF9800;
        }
        
        .feedback-danger {
            background-color: #FFEBEE;
            color: #C62828;
            border: 2px solid #F44336;
        }
        
        .result {
            font-size: 1.5rem;
            margin: 20px 0;
            padding: 15px;
            border-radius: 10px;
            display: none;
        }
        
        .result.success {
            background-color: #E8F5E9;
            color: #2E7D32;
            border: 2px solid #4CAF50;
            display: block;
        }
        
        .result.warning {
            background-color: #FFF3E0;
            color: #EF6C00;
            border: 2px solid #FF9800;
            display: block;
        }
        
        .result.error {
            background-color: #FFEBEE;
            color: #C62828;
            border: 2px solid #F44336;
            display: block;
        }
        
        .records-container {
            margin-top: 40px;
            background-color: #f5fbff;
            border-radius: 15px;
            padding: 25px;
        }
        
        .records-title {
            color: #1e6fd9;
            margin-bottom: 20px;
            font-size: 1.5rem;
            text-align: center;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }
        
        th {
            background-color: #1e6fd9;
            color: white;
            padding: 15px;
            text-align: left;
        }
        
        td {
            padding: 15px;
            border-bottom: 1px solid #e0e0e0;
        }
        
        tr:nth-child(even) {
            background-color: #f0f9ff;
        }
        
        .rank-1 { background-color: #FFF8E1; }
        .rank-2 { background-color: #F5F5F5; }
        .rank-3 { background-color: #FFF3E0; }
        
        .water-drop {
            color: #2196F3;
            font-size: 1.5rem;
            margin-right: 5px;
        }
        
        @media (max-width: 600px) {
            .water-container {
                width: 250px;
                height: 350px;
            }
            
            .game-btn {
                padding: 10px 15px;
                margin: 5px;
                font-size: 1rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1><i class="fas fa-tint"></i> ä»™æ´åœ‹å° ESGæ°´è³‡æºå®ˆè­·è€…</h1>
            <p class="subtitle">å¥½å­¸ç”Ÿæ¥æ°´çœæ°´å¤§è¨ˆç•«äº’å‹•éŠæˆ²</p>
        </header>
        
        <div class="game-area">
            <h2 class="game-title"><i class="fas fa-faucet"></i> æ¥æ°´æŒ‘æˆ°è³½</h2>
            <p style="margin-bottom: 20px; font-size: 1.1rem; text-align: center;">
                ç›®æ¨™ï¼šåœ¨30ç§’å…§æ¥å–å‰›å¥½ä¸€æ¯æ°´ (250ml)ï¼ŒåŸ¹é¤Šç²¾æº–ç”¨æ°´çš„å¥½ç¿’æ…£ï¼
            </p>
            
            <div class="water-game">
                <div class="player-info">
                    <label for="player-name"><i class="fas fa-user"></i> è«‹è¼¸å…¥æ‚¨çš„å§“åï¼š</label>
                    <input type="text" id="player-name" placeholder="ä¾‹å¦‚ï¼šç‹å°æ˜" maxlength="10" value="éƒ­å°éŠ˜">
                    <p style="font-size: 0.9rem; color: #666;">è¼¸å…¥å§“åå¾Œï¼Œæ‚¨çš„æˆç¸¾å°‡æœƒè¨˜éŒ„åœ¨æ’è¡Œæ¦œä¸Šï¼</p>
                </div>
                
                <div class="water-container">
                    <div class="water-faucet"></div>
                    <div class="water-stream" id="water-stream"></div>
                    <div class="water-cup">
                        <div class="water-in-cup" id="water-in-cup"></div>
                        <div class="water-level">
                            <div class="level-mark" style="top: 0%;">300ml</div>
                            <div class="level-mark" style="top: 20%;">250ml</div>
                            <div class="level-mark" style="top: 40%;">200ml</div>
                            <div class="level-mark" style="top: 60%;">150ml</div>
                            <div class="level-mark" style="top: 80%;">100ml</div>
                            <div class="level-mark" style="top: 100%;">0ml</div>
                        </div>
                    </div>
                </div>
                
                <div class="timer" id="timer">30.0 ç§’</div>
                
                <!-- å³æ™‚åé¥‹å€åŸŸ -->
                <div class="real-time-feedback" id="real-time-feedback">
                    ç­‰å¾…éŠæˆ²é–‹å§‹...
                </div>
                
                <div class="game-controls">
                    <button class="game-btn" id="start-btn"><i class="fas fa-play"></i> é–‹å§‹æ¥æ°´</button>
                    <button class="game-btn" id="stop-btn" disabled><i class="fas fa-stop"></i> åœæ­¢æ¥æ°´</button>
                    <button class="game-btn" id="reset-btn"><i class="fas fa-redo"></i> é‡æ–°é–‹å§‹</button>
                </div>
                
                <div class="result" id="result"></div>
                
                <div class="records-container">
                    <h3 class="records-title"><i class="fas fa-trophy"></i> æ¥æ°´æŒ‘æˆ°è³½æ’è¡Œæ¦œ (å‰10å)</h3>
                    <div id="records-list">
                        <!-- æ’è¡Œæ¦œç´€éŒ„æœƒå‹•æ…‹é¡¯ç¤ºåœ¨é€™è£¡ -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // éŠæˆ²ç‹€æ…‹è®Šæ•¸
        let gameState = {
            timer: 30.0,
            timerInterval: null,
            waterLevel: 0,
            isRunning: false,
            waterStreamInterval: null,
            playerName: "",
            records: [],
            lastAlertLevel: 0, // è¨˜éŒ„ä¸Šæ¬¡é¡¯ç¤ºè­¦ç¤ºçš„æ°´ä½
            showAlerts: true // æ§åˆ¶æ˜¯å¦é¡¯ç¤ºè­¦ç¤º
        };

        // è­¦ç¤ºè¨Šæ¯å®šç¾©
        const alertMessages = {
            tooLittle: [
                { level: 50, message: "æ°´é‡å¤ªå°‘å›‰ï¼ç¹¼çºŒåŠ æ²¹ï¼", type: "danger" },
                { level: 100, message: "æ°´é‡é‚„ä¸å¤ å–”ï¼Œè‡³å°‘è¦200mlæ‰èƒ½æ´—æ‰‹ï¼", type: "warning" },
                { level: 150, message: "å¿«æ¥è¿‘äº†ï¼Œå†å …æŒä¸€ä¸‹ï¼", type: "warning" }
            ],
            good: [
                { level: 200, message: "å¤ªå¥½äº†ï¼é”åˆ°åŸºæœ¬æ´—æ‰‹æ°´é‡ï¼", type: "good" },
                { level: 220, message: "æ¥è¿‘å®Œç¾æ°´é‡ï¼", type: "good" },
                { level: 240, message: "éå¸¸æ¥è¿‘ç›®æ¨™250mlï¼æº–å‚™åœæ­¢ï¼", type: "good" }
            ],
            perfect: [
                { level: 245, message: "å®Œç¾ï¼æ¥è¿‘250mlï¼", type: "good" },
                { level: 250, message: "å®Œç¾æ°´é‡ï¼è¶•å¿«åœæ­¢ï¼", type: "good" }
            ],
            tooMuch: [
                { level: 260, message: "ç¨å¾®è¶…éä¸€é»äº†ï¼", type: "warning" },
                { level: 280, message: "æ°´æœ‰é»å¤šå›‰ï¼", type: "warning" },
                { level: 300, message: "åš´é‡æµªè²»ï¼å·²ç¶“è¶…é300mläº†ï¼", type: "danger" }
            ]
        };

        // é é¢è¼‰å…¥æ™‚åˆå§‹åŒ–
        window.onload = function() {
            console.log("éŠæˆ²è¼‰å…¥ä¸­...");
            
            // è¼‰å…¥ç´€éŒ„
            loadRecordsFromStorage();
            
            // è¨­å®šæŒ‰éˆ•äº‹ä»¶
            document.getElementById('start-btn').addEventListener('click', startWaterGame);
            document.getElementById('stop-btn').addEventListener('click', stopWaterGame);
            document.getElementById('reset-btn').addEventListener('click', resetWaterGame);
            
            // é¡¯ç¤ºæ’è¡Œæ¦œ
            displayRecords();
            
            // åˆå§‹åŒ–å³æ™‚åé¥‹
            updateRealTimeFeedback("ç­‰å¾…éŠæˆ²é–‹å§‹...", "good");
            
            console.log("éŠæˆ²è¼‰å…¥å®Œæˆï¼");
        };

        // æ›´æ–°å³æ™‚åé¥‹
        function updateRealTimeFeedback(message, type) {
            const feedbackElement = document.getElementById('real-time-feedback');
            feedbackElement.textContent = message;
            feedbackElement.className = "real-time-feedback";
            
            if (type === "good") {
                feedbackElement.classList.add("feedback-good");
            } else if (type === "warning") {
                feedbackElement.classList.add("feedback-warning");
            } else if (type === "danger") {
                feedbackElement.classList.add("feedback-danger");
            }
        }

        // æª¢æŸ¥ä¸¦é¡¯ç¤ºæ°´ä½è­¦ç¤º
        function checkWaterLevelAlerts(currentLevel) {
            if (!gameState.showAlerts) return;
            
            // è¨ˆç®—è·é›¢ä¸Šæ¬¡è­¦ç¤ºçš„æ°´ä½è®ŠåŒ–
            const levelChange = Math.abs(currentLevel - gameState.lastAlertLevel);
            
            // åªæœ‰æ°´ä½è®ŠåŒ–è¶…é15mlæ‰é¡¯ç¤ºæ–°çš„è­¦ç¤ºï¼ˆé¿å…å¤ªé »ç¹ï¼‰
            if (levelChange < 15 && currentLevel < 240) return;
            
            let message = "";
            let type = "good";
            
            // æª¢æŸ¥ä¸åŒéšæ®µçš„è­¦ç¤º
            if (currentLevel < 200) {
                // æ°´é‡ä¸è¶³éšæ®µçš„è­¦ç¤º
                for (const alert of alertMessages.tooLittle) {
                    if (currentLevel >= alert.level && currentLevel < alert.level + 10) {
                        message = alert.message;
                        type = alert.type;
                        break;
                    }
                }
            } else if (currentLevel >= 200 && currentLevel < 245) {
                // è‰¯å¥½æ°´é‡éšæ®µçš„è­¦ç¤º
                for (const alert of alertMessages.good) {
                    if (currentLevel >= alert.level && currentLevel < alert.level + 10) {
                        message = alert.message;
                        type = alert.type;
                        break;
                    }
                }
            } else if (currentLevel >= 245 && currentLevel <= 255) {
                // å®Œç¾æ°´é‡éšæ®µçš„è­¦ç¤º
                for (const alert of alertMessages.perfect) {
                    if (currentLevel >= alert.level && currentLevel < alert.level + 5) {
                        message = alert.message;
                        type = alert.type;
                        break;
                    }
                }
            } else if (currentLevel > 255) {
                // æ°´é‡éå¤šéšæ®µçš„è­¦ç¤º
                for (const alert of alertMessages.tooMuch) {
                    if (currentLevel >= alert.level && currentLevel < alert.level + 10) {
                        message = alert.message;
                        type = alert.type;
                        break;
                    }
                }
            }
            
            // å¦‚æœæœ‰è­¦ç¤ºè¨Šæ¯ï¼Œé¡¯ç¤ºå®ƒ
            if (message) {
                updateRealTimeFeedback(message, type);
                gameState.lastAlertLevel = currentLevel;
                
                // å¦‚æœæ°´é‡è¶…é300mlï¼Œç™¼å‡ºç‰¹åˆ¥è­¦å‘Š
                if (currentLevel >= 300) {
                    updateRealTimeFeedback("âš ï¸ åš´é‡æµªè²»ï¼å·²ç¶“è¶…é300mläº†ï¼è«‹ç«‹å³åœæ­¢ï¼", "danger");
                }
            }
        }

        // é–‹å§‹éŠæˆ²
        function startWaterGame() {
            console.log("é»æ“Šé–‹å§‹æŒ‰éˆ•");
            
            // æª¢æŸ¥æ˜¯å¦å·²è¼¸å…¥å§“å
            const playerName = document.getElementById('player-name').value.trim();
            if (!playerName) {
                alert("è«‹å…ˆè¼¸å…¥æ‚¨çš„å§“åï¼Œæ‰èƒ½é–‹å§‹éŠæˆ²ï¼");
                document.getElementById('player-name').focus();
                return;
            }
            
            gameState.playerName = playerName;
            gameState.showAlerts = true;
            gameState.lastAlertLevel = 0;
            
            if (gameState.isRunning) {
                console.log("éŠæˆ²å·²åœ¨é€²è¡Œä¸­");
                return;
            }
            
            // é‡ç½®éŠæˆ²ç‹€æ…‹
            gameState.isRunning = true;
            gameState.waterLevel = 0;
            gameState.timer = 30.0;
            
            // æ›´æ–°æŒ‰éˆ•ç‹€æ…‹
            document.getElementById('start-btn').disabled = true;
            document.getElementById('stop-btn').disabled = false;
            document.getElementById('player-name').disabled = true;
            
            // æ›´æ–°æ°´æ¯é¡¯ç¤º
            document.getElementById('water-in-cup').style.height = '0%';
            
            // é–‹å§‹æ°´æµå‹•ç•«
            document.getElementById('water-stream').style.height = '100px';
            
            // éš±è—æœ€çµ‚çµæœ
            document.getElementById('result').style.display = 'none';
            
            // é¡¯ç¤ºåˆå§‹è¨Šæ¯
            updateRealTimeFeedback("éŠæˆ²é–‹å§‹ï¼é–‹å§‹æ¥æ°´...", "good");
            
            // é–‹å§‹è¨ˆæ™‚å™¨
            gameState.timerInterval = setInterval(() => {
                gameState.timer -= 0.1;
                document.getElementById('timer').textContent = gameState.timer.toFixed(1) + ' ç§’';
                
                // æ™‚é–“åˆ°è‡ªå‹•åœæ­¢
                if (gameState.timer <= 0) {
                    console.log("æ™‚é–“åˆ°!");
                    stopWaterGame();
                }
            }, 100);
            
            // æ¨¡æ“¬æ°´æµå¢åŠ 
            gameState.waterStreamInterval = setInterval(() => {
                if (gameState.isRunning) {
                    // æ¯æ¬¡å¢åŠ 2-5mlçš„æ°´
                    const increase = 2 + Math.random() * 3;
                    gameState.waterLevel += increase;
                    
                    // æ›´æ–°æ°´æ¯é¡¯ç¤ºï¼ˆæœ€é«˜300mlï¼‰
                    const waterPercentage = Math.min(gameState.waterLevel / 300 * 100, 100);
                    document.getElementById('water-in-cup').style.height = waterPercentage + '%';
                    
                    console.log("ç›®å‰æ°´é‡:", gameState.waterLevel.toFixed(1), "ml");
                    
                    // æª¢æŸ¥ä¸¦é¡¯ç¤ºæ°´ä½è­¦ç¤º
                    checkWaterLevelAlerts(gameState.waterLevel);
                    
                    // å¦‚æœæ°´é‡è¶…é300mlï¼Œå¼·åˆ¶åœæ­¢
                    if (gameState.waterLevel >= 350) {
                        updateRealTimeFeedback("âŒ åš´é‡æµªè²»ï¼å¼·åˆ¶åœæ­¢éŠæˆ²ï¼", "danger");
                        setTimeout(() => stopWaterGame(), 500);
                    }
                }
            }, 200);
            
            console.log("éŠæˆ²é–‹å§‹æˆåŠŸ!");
        }

        // åœæ­¢éŠæˆ²
        function stopWaterGame() {
            console.log("é»æ“Šåœæ­¢æŒ‰éˆ•");
            
            if (!gameState.isRunning) {
                console.log("éŠæˆ²æœªåœ¨é€²è¡Œä¸­");
                return;
            }
            
            // åœæ­¢è¨ˆæ™‚å™¨å’Œæ°´æµ
            clearInterval(gameState.timerInterval);
            clearInterval(gameState.waterStreamInterval);
            gameState.isRunning = false;
            gameState.showAlerts = false;
            
            // æ›´æ–°æŒ‰éˆ•ç‹€æ…‹
            document.getElementById('start-btn').disabled = false;
            document.getElementById('stop-btn').disabled = true;
            document.getElementById('player-name').disabled = false;
            
            // åœæ­¢æ°´æµ
            document.getElementById('water-stream').style.height = '0';
            
            // è¨ˆç®—çµæœ
            const waterLevel = gameState.waterLevel;
            const error = Math.abs(waterLevel - 250);
            let resultClass, resultText, score, dropsEarned;
            
            // è¨ˆç®—åˆ†æ•¸å’Œé¡¯ç¤ºæœ€çµ‚çµæœ
            if (waterLevel < 200) {
                score = Math.max(10, Math.floor(waterLevel / 2));
                resultClass = 'error';
                resultText = `æ°´é‡ä¸è¶³ï¼åªæ¥äº† ${waterLevel.toFixed(1)}mlï¼Œéœ€è¦è‡³å°‘ 200ml æ‰èƒ½æ´—æ‰‹ã€‚`;
                dropsEarned = 1;
                updateRealTimeFeedback("âŒ æ°´é‡ä¸è¶³ï¼Œå†æ¥å†å²ï¼", "danger");
            } else if (waterLevel > 300) {
                score = Math.max(5, 60 - Math.floor((waterLevel - 250) / 10));
                resultClass = 'error';
                resultText = `åš´é‡æµªè²»ï¼æ¥äº† ${waterLevel.toFixed(1)}mlï¼Œè¶…éç›®æ¨™ ${(waterLevel-250).toFixed(1)}mlã€‚`;
                dropsEarned = 1;
                updateRealTimeFeedback("ğŸ’§ æµªè²»å¤ªå¤šæ°´äº†ï¼", "danger");
            } else if (error <= 10) {
                score = 100;
                resultClass = 'success';
                resultText = `å®Œç¾ï¼æ¥äº† ${waterLevel.toFixed(1)}mlï¼Œèª¤å·®åƒ… ${error.toFixed(1)}mlï¼`;
                dropsEarned = 5;
                updateRealTimeFeedback("ğŸ‰ å®Œç¾æ¥æ°´ï¼å¤ªæ£’äº†ï¼", "good");
            } else if (error <= 30) {
                score = 80 + Math.floor((30 - error) / 30 * 20);
                resultClass = 'success';
                resultText = `å¾ˆå¥½ï¼æ¥äº† ${waterLevel.toFixed(1)}mlï¼Œèª¤å·® ${error.toFixed(1)}mlã€‚`;
                dropsEarned = 3;
                updateRealTimeFeedback("ğŸ‘ è¡¨ç¾ä¸éŒ¯ï¼", "good");
            } else {
                score = 60 + Math.floor((50 - error) / 50 * 20);
                resultClass = 'warning';
                resultText = `é‚„å¯ä»¥æ›´å¥½ï¼æ¥äº† ${waterLevel.toFixed(1)}mlï¼Œèª¤å·® ${error.toFixed(1)}mlã€‚`;
                dropsEarned = 2;
                updateRealTimeFeedback("ğŸ‘Œ é‚„å¯ä»¥æ›´å¥½ï¼Œç¹¼çºŒç·´ç¿’ï¼", "warning");
            }
            
            score = Math.round(score);
            
            // é¡¯ç¤ºæœ€çµ‚çµæœ
            const resultElement = document.getElementById('result');
            resultElement.className = 'result ' + resultClass;
            resultElement.textContent = resultText + ` å¾—åˆ†ï¼š${score}åˆ†`;
            resultElement.style.display = 'block';
            
            // å„²å­˜ç´€éŒ„
            saveRecord(gameState.playerName, score, waterLevel, error);
            
            // é¡¯ç¤ºçå‹µè¨Šæ¯
            setTimeout(() => {
                alert(`${gameState.playerName} åŒå­¸ï¼Œç²å¾— ${score} åˆ†ï¼\nçå‹µ ${dropsEarned} é¡†æ°´æ»´ï¼\n${resultText}`);
            }, 500);
            
            console.log("éŠæˆ²çµæŸï¼Œåˆ†æ•¸:", score);
        }

        // é‡ç½®éŠæˆ²
        function resetWaterGame() {
            console.log("é»æ“Šé‡ç½®æŒ‰éˆ•");
            
            // åœæ­¢éŠæˆ²
            clearInterval(gameState.timerInterval);
            clearInterval(gameState.waterStreamInterval);
            gameState.isRunning = false;
            gameState.showAlerts = false;
            
            // é‡ç½®ç‹€æ…‹
            gameState.timer = 30.0;
            gameState.waterLevel = 0;
            gameState.lastAlertLevel = 0;
            
            // æ›´æ–°é¡¯ç¤º
            document.getElementById('timer').textContent = '30.0 ç§’';
            document.getElementById('water-in-cup').style.height = '0%';
            document.getElementById('water-stream').style.height = '0';
            
            // æ›´æ–°æŒ‰éˆ•ç‹€æ…‹
            document.getElementById('start-btn').disabled = false;
            document.getElementById('stop-btn').disabled = true;
            document.getElementById('player-name').disabled = false;
            
            // éš±è—çµæœ
            document.getElementById('result').style.display = 'none';
            
            // é‡ç½®å³æ™‚åé¥‹
            updateRealTimeFeedback("éŠæˆ²å·²é‡ç½®ï¼Œæº–å‚™é–‹å§‹æ–°æŒ‘æˆ°ï¼", "good");
        }

        // å„²å­˜ç´€éŒ„
        function saveRecord(playerName, score, waterLevel, error) {
            console.log("å„²å­˜ç´€éŒ„:", playerName, score);
            
            const record = {
                name: playerName,
                score: score,
                waterLevel: waterLevel,
                error: error,
                date: new Date().toLocaleString('zh-TW')
            };
            
            // åŠ å…¥æ–°ç´€éŒ„
            gameState.records.push(record);
            
            // æŒ‰åˆ†æ•¸æ’åº
            gameState.records.sort((a, b) => b.score - a.score);
            
            // åªä¿ç•™å‰10å
            if (gameState.records.length > 10) {
                gameState.records = gameState.records.slice(0, 10);
            }
            
            // å„²å­˜åˆ°æœ¬åœ°
            localStorage.setItem('waterGameRecords', JSON.stringify(gameState.records));
            
            // æ›´æ–°æ’è¡Œæ¦œ
            displayRecords();
        }

        // è¼‰å…¥ç´€éŒ„
        function loadRecordsFromStorage() {
            console.log("è¼‰å…¥ç´€éŒ„...");
            const savedRecords = localStorage.getItem('waterGameRecords');
            if (savedRecords) {
                try {
                    gameState.records = JSON.parse(savedRecords);
                    console.log("è¼‰å…¥æˆåŠŸï¼Œå…±", gameState.records.length, "ç­†ç´€éŒ„");
                } catch (e) {
                    console.error("è§£æç´€éŒ„å¤±æ•—:", e);
                    gameState.records = [];
                }
            }
        }

        // é¡¯ç¤ºæ’è¡Œæ¦œ
        function displayRecords() {
            console.log("é¡¯ç¤ºæ’è¡Œæ¦œ...");
            const recordsList = document.getElementById('records-list');
            const records = gameState.records;
            
            if (records.length === 0) {
                recordsList.innerHTML = '<div style="text-align: center; padding: 30px; color: #666; font-style: italic;">é‚„æ²’æœ‰ä»»ä½•ç´€éŒ„ï¼Œå¿«ä¾†æŒ‘æˆ°å§ï¼</div>';
                return;
            }
            
            let html = '<table>';
            html += '<thead><tr><th>æ’å</th><th>å§“å</th><th>åˆ†æ•¸</th><th>æ°´é‡</th><th>èª¤å·®</th><th>æ—¥æœŸ</th></tr></thead><tbody>';
            
            records.forEach((record, index) => {
                let rankClass = '';
                if (index === 0) rankClass = 'rank-1';
                else if (index === 1) rankClass = 'rank-2';
                else if (index === 2) rankClass = 'rank-3';
                
                // è¨ˆç®—æ˜Ÿç´š
                let stars = '';
                if (record.score >= 90) stars = 'â˜…â˜…â˜…â˜…â˜…';
                else if (record.score >= 80) stars = 'â˜…â˜…â˜…â˜…';
                else if (record.score >= 70) stars = 'â˜…â˜…â˜…';
                else if (record.score >= 60) stars = 'â˜…â˜…';
                else stars = 'â˜…';
                
                html += `
                    <tr class="${rankClass}">
                        <td>
                            <span style="display: inline-block; width: 30px; height: 30px; line-height: 30px; text-align: center; border-radius: 50%; background-color: ${
                                index === 0 ? '#FFD700' : 
                                index === 1 ? '#C0C0C0' : 
                                index === 2 ? '#CD7F32' : '#2196F3'
                            }; color: white; font-weight: bold;">
                                ${index + 1}
                            </span>
                        </td>
                        <td>
                            <strong>${record.name}</strong>
                            <br><small>${stars}</small>
                        </td>
                        <td>
                            <i class="fas fa-tint water-drop"></i>
                            <span style="color: #2196F3; font-weight: bold; font-size: 1.2rem;">${record.score}</span> åˆ†
                        </td>
                        <td>${record.waterLevel.toFixed(1)} ml</td>
                        <td>${record.error.toFixed(1)} ml</td>
                        <td>${record.date}</td>
                    </tr>
                `;
            });
            
            html += '</tbody></table>';
            recordsList.innerHTML = html;
            console.log("æ’è¡Œæ¦œæ›´æ–°å®Œæˆ");
        }
    </script>
</body>
</html>