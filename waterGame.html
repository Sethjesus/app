<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>üíß ‰ªôÊ¥ûÂ∞èÂ§©Êâç | Áí∞‰øùÂ§ß‰ΩúÊà∞ üåü</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Comic+Neue:wght@700&family=Fredoka+One&display=swap" rel="stylesheet">
    <style>
        /* Âü∫Á§éÊ®£Âºè - ÊâãÊ©üÂÑ™Âåñ */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }
        
        body {
            font-family: 'Comic Neue', cursive;
            background: linear-gradient(135deg, #1a2980 0%, #26d0ce 100%);
            min-height: 100vh;
            overflow-x: hidden;
            position: relative;
            color: white;
            touch-action: manipulation;
        }
        
        /* ÊòüÁ©∫ËÉåÊôØ - Á∞°Âåñ */
        .star-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -2;
            pointer-events: none;
            background: 
                radial-gradient(ellipse at 20% 80%, rgba(255, 255, 255, 0.1) 0%, transparent 50%),
                radial-gradient(ellipse at 80% 20%, rgba(255, 255, 255, 0.1) 0%, transparent 50%);
        }
        
        .star {
            position: absolute;
            background: white;
            border-radius: 50%;
            animation: twinkle 3s infinite alternate;
        }
        
        @keyframes twinkle {
            0% { opacity: 0.3; transform: scale(1); }
            100% { opacity: 1; transform: scale(1.2); }
        }
        
        /* ‰∏ªÂÆπÂô® */
        .universe-container {
            max-width: 100%;
            margin: 0 auto;
            padding: 10px;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            position: relative;
            z-index: 1;
        }
        
        /* ÈÅäÊà≤Âç°Áâá - ÊâãÊ©üÂ∞∫ÂØ∏ÂÑ™Âåñ */
        .galaxy-card {
            width: 100%;
            background: rgba(0, 10, 40, 0.95);
            border-radius: 25px;
            box-shadow: 
                0 10px 30px rgba(0, 0, 0, 0.6),
                0 0 30px rgba(54, 209, 220, 0.3),
                inset 0 0 20px rgba(255, 255, 255, 0.1);
            border: 4px solid;
            border-image: linear-gradient(45deg, #36D1DC, #5B86E5, #FF6B6B, #FFD700) 1;
            overflow: hidden;
            position: relative;
            margin-bottom: 15px;
            backdrop-filter: blur(5px);
        }
        
        /* ÈÅäÊà≤Ê®ôÈ†≠ - ÊâãÊ©üÂ∞∫ÂØ∏ */
        .game-header {
            background: linear-gradient(135deg, #0f3460, #1a1a2e);
            color: white;
            padding: 20px 15px;
            text-align: center;
            border-bottom: 4px solid #FFD700;
            position: relative;
            overflow: hidden;
        }
        
        .game-title {
            font-family: 'Fredoka One', cursive;
            font-size: 2rem;
            text-shadow: 
                2px 2px 0 rgba(0, 0, 0, 0.3),
                0 0 15px rgba(54, 209, 220, 0.8);
            margin-bottom: 10px;
            background: linear-gradient(45deg, #36D1DC, #FFD700, #FF6B6B);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .game-subtitle {
            font-size: 1.2rem;
            opacity: 0.9;
            color: #36D1DC;
            text-shadow: 1px 1px 0 rgba(0, 0, 0, 0.3);
        }
        
        /* Áé©ÂÆ∂Ë®ªÂÜäÂΩàÁ™ó - ÊâãÊ©üÂÑ™Âåñ */
        .player-register-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 3000;
            animation: modalFadeIn 0.5s ease-out;
            padding: 15px;
        }

        .register-content {
            background: linear-gradient(135deg, #0f3460, #1a1a2e);
            padding: 30px 20px;
            border-radius: 20px;
            border: 5px solid #FFD700;
            text-align: center;
            max-width: 100%;
            width: 100%;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.8);
            position: relative;
            overflow: hidden;
        }

        .register-title {
            font-size: 1.8rem;
            color: #FFD700;
            margin-bottom: 15px;
            font-family: 'Fredoka One', cursive;
            text-shadow: 2px 2px 0 rgba(0, 0, 0, 0.3);
        }

        .register-subtitle {
            font-size: 1.2rem;
            color: #a1c4fd;
            margin-bottom: 20px;
        }

        .register-input {
            width: 100%;
            padding: 15px;
            border: 3px solid #36D1DC;
            border-radius: 15px;
            font-size: 1.4rem;
            font-family: 'Fredoka One', cursive;
            text-align: center;
            background: rgba(0, 30, 80, 0.7);
            color: white;
            margin-bottom: 20px;
            box-shadow: 0 5px 15px rgba(54, 209, 220, 0.3);
            transition: all 0.3s;
        }

        .register-input:focus {
            outline: none;
            border-color: #FFD700;
            box-shadow: 0 5px 20px rgba(255, 215, 0, 0.5);
        }

        .register-btn {
            padding: 15px 30px;
            background: linear-gradient(135deg, #4CAF50, #2E7D32);
            color: white;
            border: none;
            border-radius: 20px;
            font-size: 1.4rem;
            font-weight: bold;
            cursor: pointer;
            font-family: 'Fredoka One', cursive;
            transition: all 0.3s;
            box-shadow: 0 10px 25px rgba(76, 175, 80, 0.5);
            width: 100%;
            margin-top: 10px;
        }

        .register-btn:active {
            transform: scale(0.98);
        }
        
        /* ÊéíË°åÊ¶úÁ≥ªÁµ± - ÊâãÊ©üÈ†ÇÈÉ®Ê¨Ñ‰Ωç */
        .leaderboard-system {
            position: fixed;
            top: 10px;
            left: 10px;
            right: 10px;
            background: rgba(0, 20, 60, 0.95);
            border-radius: 15px;
            padding: 10px 15px;
            color: white;
            font-size: 1rem;
            font-weight: bold;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.6);
            z-index: 100;
            display: flex;
            align-items: center;
            gap: 10px;
            border: 2px solid #FFD700;
            backdrop-filter: blur(5px);
            cursor: pointer;
            transition: all 0.3s;
            max-width: calc(100% - 20px);
        }

        .leaderboard-icon {
            font-size: 1.5rem;
        }

        .leaderboard-content {
            display: flex;
            align-items: center;
            gap: 10px;
            flex: 1;
            justify-content: space-between;
        }

        .leaderboard-player {
            display: flex;
            align-items: center;
            gap: 8px;
            flex: 1;
        }

        .player-rank {
            background: #FFD700;
            color: #333;
            width: 25px;
            height: 25px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 0.9rem;
            flex-shrink: 0;
        }

        .player-name {
            font-size: 1rem;
            color: #36D1DC;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            flex: 1;
        }

        .player-score {
            font-size: 1rem;
            color: #FFD700;
            font-weight: bold;
            flex-shrink: 0;
        }
        
        /* ÊéíË°åÊ¶úÂΩàÁ™ó - ÊâãÊ©üÂÑ™Âåñ */
        .leaderboard-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 2500;
            padding: 15px;
        }

        .leaderboard-content-modal {
            background: linear-gradient(135deg, #0f3460, #1a1a2e);
            padding: 20px;
            border-radius: 20px;
            border: 5px solid #FFD700;
            text-align: center;
            max-width: 100%;
            width: 100%;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.8);
            position: relative;
        }

        .leaderboard-title {
            font-size: 1.8rem;
            color: #FFD700;
            margin-bottom: 20px;
            font-family: 'Fredoka One', cursive;
            text-shadow: 2px 2px 0 rgba(0, 0, 0, 0.3);
        }

        .leaderboard-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
            font-size: 0.9rem;
        }

        .leaderboard-table th {
            background: rgba(54, 209, 220, 0.3);
            color: #FFD700;
            padding: 10px;
            font-size: 1rem;
            border-bottom: 3px solid #36D1DC;
        }

        .leaderboard-table td {
            padding: 10px;
            font-size: 0.9rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .rank-1 .rank-cell { background: linear-gradient(135deg, #FFD700, #FF9800); }
        .rank-2 .rank-cell { background: linear-gradient(135deg, #C0C0C0, #E0E0E0); }
        .rank-3 .rank-cell { background: linear-gradient(135deg, #CD7F32, #B87333); }

        .rank-cell {
            width: 35px;
            height: 35px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: #333;
            font-size: 1rem;
            margin: 0 auto;
        }

        .close-leaderboard {
            position: absolute;
            top: 10px;
            right: 10px;
            background: none;
            border: none;
            color: #FF6B6B;
            font-size: 1.8rem;
            cursor: pointer;
            transition: all 0.3s;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        /* ÈóúÂç°Á≥ªÁµ± - ÊâãÊ©üÈ†ÇÈÉ®Ê¨Ñ‰Ωç */
        .level-system {
            position: fixed;
            top: 10px;
            right: 10px;
            background: rgba(0, 20, 60, 0.9);
            border-radius: 15px;
            padding: 10px 15px;
            color: white;
            font-size: 1rem;
            font-weight: bold;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.5);
            z-index: 100;
            display: flex;
            align-items: center;
            gap: 10px;
            border: 2px solid #FFD700;
            backdrop-filter: blur(5px);
            max-width: 150px;
        }
        
        .level-icon {
            font-size: 1.5rem;
        }
        
        /* ÈóúÂç°ÈÄ≤Â∫¶Ê¢ù */
        .level-progress {
            width: 80px;
            height: 15px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            overflow: hidden;
            position: relative;
            flex-shrink: 0;
        }
        
        .level-progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #4CAF50, #8BC34A);
            width: 0%;
            transition: width 1s ease;
            position: relative;
            overflow: hidden;
        }
        
        /* ÈÅäÊà≤ÈÅ∏ÊìáÁï´Èù¢ */
        .level-selection {
            display: none;
            flex-direction: column;
            gap: 20px;
            align-items: center;
            justify-content: center;
            padding: 20px 15px;
            animation: levelSelectFade 0.8s ease-out;
        }
        
        .level-intro {
            text-align: center;
            margin-bottom: 20px;
        }
        
        .level-intro h2 {
            font-size: 1.8rem;
            color: #FFD700;
            margin-bottom: 15px;
            font-family: 'Fredoka One', cursive;
            text-shadow: 2px 2px 0 rgba(0, 0, 0, 0.3);
        }
        
        .level-intro p {
            font-size: 1.2rem;
            color: #a1c4fd;
            line-height: 1.4;
            margin: 0 auto;
        }
        
        /* ÈóúÂç°ÊåâÈàï - ÊâãÊ©üÂñÆÂàó‰ΩàÂ±Ä */
        .level-buttons {
            display: flex;
            flex-direction: column;
            gap: 15px;
            width: 100%;
            max-width: 400px;
            margin: 0 auto;
        }
        
        .level-btn {
            padding: 20px 15px;
            background: rgba(0, 30, 80, 0.7);
            border-radius: 20px;
            border: 4px solid;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 12px;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
            font-family: 'Fredoka One', cursive;
            font-size: 1.3rem;
            color: white;
            text-shadow: 1px 1px 0 rgba(0, 0, 0, 0.3);
            min-height: 120px;
            width: 100%;
        }
        
        .level-btn:active {
            transform: scale(0.98);
        }
        
        .level-icon-large {
            font-size: 2.5rem;
        }
        
        .level-difficulty {
            font-size: 0.9rem;
            padding: 3px 10px;
            border-radius: 12px;
            background: rgba(255, 255, 255, 0.2);
            color: #FFD700;
            font-weight: bold;
        }
        
        .level-reward {
            display: flex;
            align-items: center;
            gap: 5px;
            color: #FFD700;
            font-size: 1rem;
        }
        
        /* ÈÅäÊà≤ÂÖßÂÆπÂçÄ */
        .game-content {
            padding: 20px 15px;
            display: none;
            animation: contentAppear 0.6s ease-out;
        }
        
        /* ÈÅäÊà≤ÂçÄÊ®ôÈ°å */
        .game-area-title {
            text-align: center;
            margin-bottom: 20px;
            position: relative;
        }
        
        .game-area-title h2 {
            font-size: 1.8rem;
            color: #FFD700;
            font-family: 'Fredoka One', cursive;
            text-shadow: 2px 2px 0 rgba(0, 0, 0, 0.3);
            margin-bottom: 10px;
        }
        
        .game-area-title p {
            font-size: 1.2rem;
            color: #a1c4fd;
            margin: 0 auto;
        }
        
        /* ÈóúÂç°‰ªªÂãôÊèêÁ§∫ */
        .mission-info {
            background: rgba(0, 40, 100, 0.7);
            border-radius: 15px;
            padding: 15px;
            margin-bottom: 20px;
            border: 3px solid #36D1DC;
            box-shadow: 0 5px 15px rgba(54, 209, 220, 0.3);
        }
        
        .mission-title {
            color: #FFD700;
            font-size: 1.4rem;
            margin-bottom: 10px;
            font-family: 'Fredoka One', cursive;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .mission-desc {
            font-size: 1.1rem;
            color: #a1c4fd;
            line-height: 1.4;
            margin-bottom: 10px;
        }
        
        .mission-requirements {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 15px;
        }
        
        .requirement {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 6px 12px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            font-size: 0.9rem;
            white-space: nowrap;
        }
        
        /* Êé•Ê∞¥ÈÅäÊà≤ÂçÄ - ÊâãÊ©üÂÑ™Âåñ */
        .water-game-area {
            display: none;
        }
        
        .water-challenge {
            display: flex;
            flex-direction: column;
            gap: 20px;
            align-items: center;
            justify-content: center;
            margin-bottom: 20px;
        }
        
        .water-container-complex {
            position: relative;
            width: 100%;
            max-width: 300px;
            height: 350px;
            background: linear-gradient(135deg, #0d1b2a, #1b263b);
            border-radius: 20px;
            border: 6px solid #36D1DC;
            overflow: hidden;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.5);
            flex-shrink: 0;
        }
        
        .water-faucet-complex {
            width: 60px;
            height: 40px;
            background: linear-gradient(to bottom, #415a77, #778da9);
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            border-radius: 10px 10px 0 0;
        }
        
        .water-stream-animation {
            position: absolute;
            top: 60px;
            left: 50%;
            transform: translateX(-50%);
            width: 10px;
            height: 0;
            background: linear-gradient(to bottom, #36D1DC, #5B86E5);
            border-radius: 0 0 6px 6px;
            transition: height 0.3s;
            box-shadow: 0 0 10px rgba(54, 209, 220, 0.7);
        }
        
        .water-cup-complex {
            width: 150px;
            height: 180px;
            background: rgba(255, 255, 255, 0.1);
            border: 5px solid #FF9800;
            border-radius: 15px 15px 40px 40px;
            position: absolute;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(255, 152, 0, 0.4);
        }
        
        .water-level-complex {
            width: 100%;
            height: 0%;
            background: linear-gradient(to top, #36D1DC, #5B86E5);
            position: absolute;
            bottom: 0;
            transition: height 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
            border-radius: 0 0 35px 35px;
        }
        
        .water-measurements {
            position: absolute;
            right: -30px;
            height: 100%;
            width: 30px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }
        
        .measurement {
            width: 20px;
            border-top: 2px solid rgba(255, 255, 255, 0.7);
            text-align: right;
            padding-right: 5px;
            font-weight: bold;
            color: white;
            font-size: 0.8rem;
            text-shadow: 1px 1px 0 rgba(0, 0, 0, 0.3);
        }
        
        .water-stats {
            background: rgba(0, 30, 80, 0.7);
            border-radius: 15px;
            padding: 15px;
            width: 100%;
            max-width: 300px;
            border: 4px solid #4CAF50;
            box-shadow: 0 8px 20px rgba(76, 175, 80, 0.3);
            flex-shrink: 0;
        }
        
        .water-stat-item {
            margin-bottom: 15px;
        }
        
        .water-stat-title {
            color: #36D1DC;
            font-size: 1rem;
            margin-bottom: 5px;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .water-stat-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: #FFD700;
            text-shadow: 1px 1px 0 rgba(0, 0, 0, 0.3);
        }
        
        .water-timer {
            font-size: 2rem;
            font-weight: bold;
            color: #FF5722;
            text-align: center;
            margin: 15px 0;
            font-family: 'Fredoka One', cursive;
            text-shadow: 1px 1px 0 rgba(0, 0, 0, 0.3);
        }
        
        .water-controls {
            display: flex;
            flex-direction: column;
            gap: 15px;
            justify-content: center;
            margin: 20px 0;
            width: 100%;
            max-width: 300px;
        }
        
        .water-btn {
            padding: 15px 20px;
            border: none;
            border-radius: 20px;
            font-size: 1.2rem;
            font-weight: bold;
            cursor: pointer;
            font-family: 'Fredoka One', cursive;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            position: relative;
            overflow: hidden;
            z-index: 1;
            width: 100%;
        }
        
        .water-btn:active {
            transform: scale(0.98);
        }
        
        .btn-start-water {
            background: linear-gradient(135deg, #4CAF50, #2E7D32);
            color: white;
            box-shadow: 0 5px 15px rgba(76, 175, 80, 0.4);
        }
        
        .btn-stop-water {
            background: linear-gradient(135deg, #FF5722, #D32F2F);
            color: white;
            box-shadow: 0 5px 15px rgba(255, 87, 34, 0.4);
        }
        
        .btn-restart-water {
            background: linear-gradient(135deg, #2196F3, #0D47A1);
            color: white;
            box-shadow: 0 5px 15px rgba(33, 150, 243, 0.4);
        }
        
        .water-feedback {
            background: linear-gradient(135deg, rgba(0, 40, 100, 0.9), rgba(54, 209, 220, 0.3));
            border-radius: 15px;
            padding: 15px;
            margin: 15px auto;
            width: 100%;
            max-width: 300px;
            border: 4px solid;
            text-align: center;
            font-size: 1.2rem;
            font-weight: bold;
            display: none;
        }
        
        .feedback-success {
            border-color: #4CAF50;
            color: #8BC34A;
            box-shadow: 0 5px 15px rgba(76, 175, 80, 0.5);
        }
        
        .feedback-warning {
            border-color: #FF9800;
            color: #FFB74D;
            box-shadow: 0 5px 15px rgba(255, 152, 0, 0.5);
        }
        
        .feedback-error {
            border-color: #F44336;
            color: #EF9A9A;
            box-shadow: 0 5px 15px rgba(244, 67, 54, 0.5);
        }
        
        /* Áü•Ë≠òÊåëÊà∞ÂçÄ - ÊâãÊ©üÂÑ™Âåñ */
        .quiz-game-area {
            display: none;
        }
        
        .quiz-challenge {
            max-width: 100%;
            margin: 0 auto;
        }
        
        .quiz-progress {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 20px;
            background: rgba(0, 30, 80, 0.7);
            border-radius: 15px;
            padding: 12px;
            border: 3px solid #9C27B0;
            flex-wrap: wrap;
        }
        
        .quiz-question-number {
            font-size: 1.3rem;
            color: #FFD700;
            font-weight: bold;
            white-space: nowrap;
        }
        
        .quiz-progress-bar {
            flex: 1;
            height: 12px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 6px;
            overflow: hidden;
            min-width: 100px;
        }
        
        .quiz-progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #9C27B0, #E91E63);
            width: 0%;
            transition: width 0.5s ease;
            position: relative;
        }
        
        .quiz-question-card {
            background: rgba(0, 40, 100, 0.7);
            border-radius: 20px;
            padding: 20px;
            margin-bottom: 20px;
            border: 4px solid #36D1DC;
            box-shadow: 0 8px 20px rgba(54, 209, 220, 0.3);
        }
        
        .quiz-question-text {
            font-size: 1.4rem;
            color: #FFD700;
            margin-bottom: 20px;
            line-height: 1.3;
            text-align: center;
            font-family: 'Fredoka One', cursive;
        }
        
        .quiz-options-grid {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-bottom: 20px;
        }
        
        .quiz-option-btn {
            padding: 15px;
            background: rgba(0, 20, 60, 0.8);
            border-radius: 15px;
            border: 3px solid #5B86E5;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 1.1rem;
            color: white;
            min-height: 60px;
        }
        
        .quiz-option-btn:active {
            transform: scale(0.98);
        }
        
        .quiz-option-btn.selected {
            background: rgba(54, 209, 220, 0.3);
            border-color: #36D1DC;
        }
        
        .quiz-option-btn.correct {
            background: rgba(76, 175, 80, 0.3);
            border-color: #4CAF50;
        }
        
        .quiz-option-btn.incorrect {
            background: rgba(244, 67, 54, 0.3);
            border-color: #F44336;
        }
        
        .option-label {
            width: 35px;
            height: 35px;
            background: #FFD700;
            color: #333;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.3rem;
            font-weight: bold;
            font-family: 'Fredoka One', cursive;
            flex-shrink: 0;
        }
        
        .quiz-feedback-card {
            background: rgba(0, 40, 100, 0.9);
            border-radius: 15px;
            padding: 15px;
            margin: 15px 0;
            border: 4px solid #FF9800;
            display: none;
        }
        
        .quiz-feedback-title {
            color: #FF9800;
            font-size: 1.4rem;
            margin-bottom: 10px;
            font-family: 'Fredoka One', cursive;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .quiz-feedback-text {
            font-size: 1.1rem;
            color: #a1c4fd;
            line-height: 1.4;
            margin-bottom: 15px;
        }
        
        .quiz-esg-tags {
            display: flex;
            gap: 10px;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        .quiz-esg-tag {
            padding: 6px 15px;
            border-radius: 15px;
            color: white;
            font-weight: bold;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 6px;
            white-space: nowrap;
        }
        
        .tag-environment {
            background: linear-gradient(135deg, #4CAF50, #2E7D32);
        }
        
        .tag-social {
            background: linear-gradient(135deg, #FF9800, #EF6C00);
        }
        
        .tag-governance {
            background: linear-gradient(135deg, #2196F3, #0D47A1);
        }
        
        .quiz-controls {
            display: flex;
            justify-content: center;
            margin-top: 20px;
        }
        
        .quiz-btn {
            padding: 15px 25px;
            border: none;
            border-radius: 20px;
            font-size: 1.2rem;
            font-weight: bold;
            cursor: pointer;
            font-family: 'Fredoka One', cursive;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            transition: all 0.3s;
            background: linear-gradient(135deg, #9C27B0, #E91E63);
            color: white;
            box-shadow: 0 5px 15px rgba(156, 39, 176, 0.4);
            width: 100%;
            max-width: 300px;
        }
        
        .quiz-btn:active {
            transform: scale(0.98);
        }
        
        /* Áí∞‰øùÊåëÊà∞ÂçÄ - ÊâãÊ©üÂÑ™Âåñ */
        .eco-game-area {
            display: none;
        }
        
        .eco-challenge {
            max-width: 100%;
            margin: 0 auto;
        }
        
        .eco-game-container {
            display: flex;
            flex-direction: column;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .eco-trash-area {
            background: rgba(0, 40, 100, 0.7);
            border-radius: 20px;
            padding: 15px;
            border: 4px solid #4CAF50;
            box-shadow: 0 8px 20px rgba(76, 175, 80, 0.3);
        }
        
        .eco-trash-title {
            color: #FFD700;
            font-size: 1.4rem;
            margin-bottom: 15px;
            font-family: 'Fredoka One', cursive;
            text-align: center;
        }
        
        .eco-trash-can {
            width: 120px;
            height: 160px;
            margin: 0 auto 15px;
            position: relative;
            background: linear-gradient(to bottom, #666, #333);
            border-radius: 15px 15px 0 0;
            border: 6px solid #777;
            overflow: hidden;
        }
        
        .trash-can-lid {
            width: 140px;
            height: 20px;
            background: linear-gradient(to bottom, #888, #555);
            position: absolute;
            top: -8px;
            left: -10px;
            border-radius: 8px;
            border: 4px solid #666;
        }
        
        .trash-level {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 0%;
            background: linear-gradient(to top, #9C27B0, #7B1FA2);
            transition: height 0.5s ease;
            border-radius: 0 0 8px 8px;
        }
        
        .trash-items-container {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
            margin-top: 15px;
        }
        
        .trash-item {
            width: 60px;
            height: 60px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid;
            position: relative;
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.3);
            touch-action: none;
            user-select: none;
        }
        
        .trash-item:active {
            transform: scale(1.1);
        }
        
        .trash-item.recyclable {
            background: rgba(76, 175, 80, 0.3);
            border-color: #4CAF50;
        }
        
        .trash-item.non-recyclable {
            background: rgba(244, 67, 54, 0.3);
            border-color: #F44336;
        }
        
        .trash-item.hazardous {
            background: rgba(255, 152, 0, 0.3);
            border-color: #FF9800;
        }
        
        .eco-stats {
            background: rgba(0, 40, 100, 0.7);
            border-radius: 20px;
            padding: 15px;
            border: 4px solid #36D1DC;
            box-shadow: 0 8px 20px rgba(54, 209, 220, 0.3);
        }
        
        .eco-stat-item {
            margin-bottom: 15px;
        }
        
        .eco-stat-title {
            color: #36D1DC;
            font-size: 1.1rem;
            margin-bottom: 5px;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .eco-stat-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: #FFD700;
            text-shadow: 1px 1px 0 rgba(0, 0, 0, 0.3);
        }
        
        .eco-timer {
            font-size: 2rem;
            font-weight: bold;
            color: #FF5722;
            text-align: center;
            margin: 15px 0;
            font-family: 'Fredoka One', cursive;
            text-shadow: 1px 1px 0 rgba(0, 0, 0, 0.3);
        }
        
        .eco-score-display {
            background: rgba(255, 215, 0, 0.1);
            border-radius: 15px;
            padding: 15px;
            text-align: center;
            border: 2px solid #FFD700;
            margin-top: 15px;
        }
        
        .eco-controls {
            display: flex;
            flex-direction: column;
            gap: 15px;
            justify-content: center;
            margin-top: 20px;
            width: 100%;
            max-width: 300px;
            margin-left: auto;
            margin-right: auto;
        }
        
        .eco-btn {
            padding: 15px 25px;
            border: none;
            border-radius: 20px;
            font-size: 1.2rem;
            font-weight: bold;
            cursor: pointer;
            font-family: 'Fredoka One', cursive;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            transition: all 0.3s;
            background: linear-gradient(135deg, #9C27B0, #E91E63);
            color: white;
            box-shadow: 0 5px 15px rgba(156, 39, 176, 0.4);
            width: 100%;
        }
        
        .eco-btn:active {
            transform: scale(0.98);
        }
        
        /* ÂãïÁï´Á≤íÂ≠ê - Á∞°Âåñ */
        .magic-particles {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 0;
        }
        
        .magic-particle {
            position: absolute;
            border-radius: 50%;
            animation: magicFloat 15s infinite linear;
            opacity: 0.5;
        }
        
        @keyframes magicFloat {
            0% { transform: translateY(100vh) rotate(0deg); }
            100% { transform: translateY(-100px) rotate(360deg); }
        }
        
        /* ÁÖôÁÅ´ÂãïÁï´ - Á∞°Âåñ */
        .fireworks-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 2001;
            display: none;
        }

        .firework {
            position: absolute;
            width: 4px;
            height: 4px;
            border-radius: 50%;
            animation: fireworkExplode 1s forwards;
        }

        @keyframes fireworkExplode {
            0% {
                transform: translateY(100vh) scale(1);
                opacity: 1;
            }
            50% {
                transform: translateY(calc(50vh - 50px)) scale(1);
                opacity: 1;
            }
            100% {
                transform: translateY(calc(50vh - 50px)) scale(0);
                opacity: 0;
            }
        }

        .firework-particle {
            position: absolute;
            width: 2px;
            height: 2px;
            border-radius: 50%;
            animation: fireworkParticle 1.5s forwards;
        }

        @keyframes fireworkParticle {
            0% {
                transform: translate(0, 0) scale(1);
                opacity: 1;
            }
            100% {
                transform: translate(var(--tx), var(--ty)) scale(0);
                opacity: 0;
            }
        }
        
        /* ÂàÜÊï∏È°ØÁ§∫ÂãïÁï´ */
        .score-display {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 4rem;
            font-weight: bold;
            color: #FFD700;
            text-shadow: 0 0 15px #FFD700;
            z-index: 2002;
            display: none;
            animation: scorePop 1s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            font-family: 'Fredoka One', cursive;
        }

        @keyframes scorePop {
            0% { transform: translate(-50%, -50%) scale(0); opacity: 0; }
            70% { transform: translate(-50%, -50%) scale(1.2); opacity: 1; }
            100% { transform: translate(-50%, -50%) scale(1); opacity: 1; }
        }

        /* ËøîÂõûÊåâÈàï - ÊâãÊ©üÂÑ™Âåñ */
        .magic-back-btn {
            position: fixed;
            top: 10px;
            left: 10px;
            padding: 12px 20px;
            background: linear-gradient(135deg, #FF5722, #D32F2F);
            color: white;
            border: none;
            border-radius: 20px;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
            z-index: 100;
            box-shadow: 0 5px 15px rgba(255, 87, 34, 0.5);
            transition: all 0.3s;
            display: none;
            backdrop-filter: blur(5px);
            border: 2px solid #FFD700;
            max-width: calc(100% - 20px);
        }
        
        .magic-back-btn:active {
            transform: scale(0.98);
        }
        
        /* Á†¥ÈóúÊÅ≠ÂñúÁï´Èù¢ - ÊâãÊ©üÂÑ™Âåñ */
        .final-victory-celebration {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 3000;
            padding: 15px;
            overflow-y: auto;
        }
        
        .final-victory-content {
            background: linear-gradient(135deg, #0f3460, #1a1a2e);
            padding: 30px 20px;
            border-radius: 25px;
            border: 8px solid #FFD700;
            text-align: center;
            max-width: 100%;
            width: 100%;
            box-shadow: 
                0 20px 40px rgba(0, 0, 0, 0.8),
                0 0 30px rgba(255, 215, 0, 0.3);
            position: relative;
            overflow: hidden;
        }
        
        .final-victory-icon {
            font-size: 5rem;
            margin-bottom: 20px;
            display: block;
            text-shadow: 0 0 20px #FFD700;
        }
        
        .final-victory-title {
            font-size: 2.5rem;
            color: #FFD700;
            font-family: 'Fredoka One', cursive;
            margin-bottom: 15px;
            text-shadow: 
                2px 2px 0 rgba(0, 0, 0, 0.3),
                0 0 15px rgba(255, 215, 0, 0.8);
        }
        
        .final-victory-subtitle {
            font-size: 1.8rem;
            color: #36D1DC;
            margin-bottom: 15px;
            text-shadow: 1px 1px 0 rgba(0, 0, 0, 0.3);
        }
        
        .final-victory-message {
            font-size: 1.3rem;
            color: #a1c4fd;
            margin-bottom: 25px;
            line-height: 1.4;
        }
        
        .final-victory-stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin: 25px 0;
        }
        
        .final-stat-item {
            background: rgba(255, 215, 0, 0.15);
            border-radius: 15px;
            padding: 15px;
            border: 2px solid #FFD700;
        }
        
        .final-stat-icon {
            font-size: 2.2rem;
            margin-bottom: 10px;
            color: #FFD700;
        }
        
        .final-stat-value {
            font-size: 1.8rem;
            font-weight: bold;
            color: #36D1DC;
            margin-bottom: 5px;
        }
        
        .final-stat-label {
            font-size: 1.1rem;
            color: #a1c4fd;
        }
        
        .final-victory-rewards {
            background: rgba(76, 175, 80, 0.2);
            border-radius: 15px;
            padding: 20px;
            margin: 25px 0;
            border: 4px solid #4CAF50;
        }
        
        .final-rewards-title {
            color: #FFD700;
            font-size: 1.6rem;
            margin-bottom: 15px;
            font-family: 'Fredoka One', cursive;
        }
        
        .final-rewards-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
        }
        
        .final-reward-item {
            background: rgba(0, 20, 60, 0.7);
            border-radius: 12px;
            padding: 15px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
            border: 2px solid;
        }
        
        .final-reward-icon {
            font-size: 2.2rem;
        }
        
        .final-reward-text {
            font-size: 1.1rem;
            color: white;
            font-weight: bold;
            text-align: center;
        }
        
        .final-victory-buttons {
            display: flex;
            flex-direction: column;
            gap: 15px;
            justify-content: center;
            margin-top: 25px;
        }
        
        .final-victory-btn {
            padding: 15px 25px;
            border: none;
            border-radius: 20px;
            font-size: 1.4rem;
            font-weight: bold;
            cursor: pointer;
            font-family: 'Fredoka One', cursive;
            transition: all 0.3s;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.4);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            width: 100%;
        }
        
        .final-victory-btn:active {
            transform: scale(0.98);
        }
        
        .btn-share {
            background: linear-gradient(135deg, #2196F3, #0D47A1);
            color: white;
        }
        
        .btn-restart {
            background: linear-gradient(135deg, #9C27B0, #E91E63);
            color: white;
        }
        
        .btn-home {
            background: linear-gradient(135deg, #4CAF50, #2E7D32);
            color: white;
        }
        
        /* ‰∏ÄËà¨ÊÖ∂Á•ùÂãïÁï´ - ÊâãÊ©üÂÑ™Âåñ */
        .victory-celebration {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            padding: 15px;
        }
        
        .victory-content {
            background: linear-gradient(135deg, #0f3460, #1a1a2e);
            padding: 30px 20px;
            border-radius: 25px;
            border: 6px solid #FFD700;
            text-align: center;
            max-width: 100%;
            width: 100%;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.8);
            position: relative;
            overflow: hidden;
        }
        
        .victory-icon {
            font-size: 4rem;
            margin-bottom: 20px;
            display: block;
        }
        
        .victory-title {
            font-size: 2.2rem;
            color: #FFD700;
            font-family: 'Fredoka One', cursive;
            margin-bottom: 15px;
            text-shadow: 2px 2px 0 rgba(0, 0, 0, 0.3);
        }
        
        .victory-message {
            font-size: 1.3rem;
            color: #a1c4fd;
            margin-bottom: 25px;
            line-height: 1.4;
        }
        
        .victory-rewards {
            display: flex;
            flex-direction: column;
            gap: 15px;
            justify-content: center;
            margin-top: 20px;
        }
        
        .victory-reward {
            background: rgba(255, 215, 0, 0.2);
            border-radius: 15px;
            padding: 15px 20px;
            border: 2px solid #FFD700;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .reward-icon {
            font-size: 1.8rem;
            color: #FFD700;
        }
        
        .reward-text {
            font-size: 1.3rem;
            color: white;
            font-weight: bold;
        }
        
        .victory-button {
            margin-top: 25px;
            padding: 15px 30px;
            background: linear-gradient(135deg, #4CAF50, #2E7D32);
            color: white;
            border: none;
            border-radius: 20px;
            font-size: 1.4rem;
            font-weight: bold;
            cursor: pointer;
            font-family: 'Fredoka One', cursive;
            transition: all 0.3s;
            box-shadow: 0 8px 20px rgba(76, 175, 80, 0.5);
            width: 100%;
        }
        
        .victory-button:active {
            transform: scale(0.98);
        }
        
        /* ËÉΩÂäõÊï∏ÂÄº - ÊâãÊ©üÂÑ™Âåñ */
        .abilities-system {
            position: fixed;
            bottom: 10px;
            left: 10px;
            right: 10px;
            background: rgba(0, 20, 60, 0.9);
            border-radius: 15px;
            padding: 12px;
            color: white;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.5);
            z-index: 100;
            border: 2px solid #FFD700;
            backdrop-filter: blur(5px);
            max-width: calc(100% - 20px);
        }
        
        .abilities-title {
            color: #FFD700;
            font-size: 1.1rem;
            margin-bottom: 10px;
            font-family: 'Fredoka One', cursive;
        }
        
        .abilities-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
        }
        
        .ability-item {
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .ability-icon {
            font-size: 1.2rem;
            color: #36D1DC;
            width: 25px;
            text-align: center;
        }
        
        .ability-name {
            font-size: 0.9rem;
            color: #a1c4fd;
            width: 60px;
        }
        
        .ability-value {
            font-size: 1rem;
            font-weight: bold;
            color: #FFD700;
            min-width: 40px;
        }
        
        .ability-bar {
            width: 60px;
            height: 6px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 3px;
            overflow: hidden;
            flex-shrink: 0;
        }
        
        .ability-fill {
            height: 100%;
            background: linear-gradient(90deg, #36D1DC, #5B86E5);
            width: 0%;
            transition: width 1s ease;
        }
        
        /* Áé©ÂÆ∂Ë≥áË®äÈ°ØÁ§∫ - ÊâãÊ©üÂÑ™Âåñ */
        .player-info-system {
            position: fixed;
            top: 70px;
            right: 10px;
            background: rgba(0, 20, 60, 0.9);
            border-radius: 15px;
            padding: 10px 15px;
            color: white;
            font-size: 1rem;
            font-weight: bold;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.5);
            z-index: 100;
            display: flex;
            align-items: center;
            gap: 10px;
            border: 2px solid #FFD700;
            backdrop-filter: blur(5px);
            display: none;
            max-width: 200px;
        }

        .player-avatar {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, #36D1DC, #5B86E5);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.3rem;
            color: white;
            flex-shrink: 0;
        }

        .player-name-display {
            font-size: 1.1rem;
            color: #FFD700;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 100px;
        }

        .player-drops {
            display: flex;
            align-items: center;
            gap: 5px;
            color: #36D1DC;
            font-size: 1rem;
        }
        
        /* ÊéíÂêçÊÖ∂Á•ùÂãïÁï´ */
        .rank-celebration {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 2.5rem;
            color: #FFD700;
            text-shadow: 0 0 15px #FFD700;
            z-index: 3001;
            font-family: 'Fredoka One', cursive;
            text-align: center;
            animation: rankCelebrationPop 2s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            pointer-events: none;
            display: none;
            padding: 20px;
            background: rgba(0, 0, 0, 0.7);
            border-radius: 20px;
        }

        @keyframes rankCelebrationPop {
            0% { transform: translate(-50%, -50%) scale(0); opacity: 0; }
            50% { transform: translate(-50%, -50%) scale(1.2); opacity: 1; }
            100% { transform: translate(-50%, -50%) scale(1); opacity: 1; }
        }
        
        /* Ê©´ÂêëÊ®°ÂºèÈÅ©ÈÖç */
        @media (orientation: landscape) and (max-height: 600px) {
            .universe-container {
                padding: 5px;
            }
            
            .galaxy-card {
                border-radius: 15px;
            }
            
            .game-header {
                padding: 10px 15px;
            }
            
            .game-title {
                font-size: 1.5rem;
                margin-bottom: 5px;
            }
            
            .game-subtitle {
                font-size: 1rem;
            }
            
            .abilities-system {
                bottom: 5px;
                left: 5px;
                right: 5px;
                padding: 8px;
                max-width: calc(100% - 10px);
            }
            
            .abilities-grid {
                grid-template-columns: repeat(4, 1fr);
                gap: 8px;
            }
            
            .ability-name {
                display: none;
            }
            
            .ability-bar {
                display: none;
            }
            
            .ability-value {
                min-width: 35px;
            }
        }
        
        /* Êõ¥Â§ßÊâãÊ©üÈÅ©ÈÖç */
        @media (min-width: 768px) {
            .universe-container {
                max-width: 700px;
                padding: 20px;
            }
            
            .game-title {
                font-size: 2.5rem;
            }
            
            .game-subtitle {
                font-size: 1.5rem;
            }
        }
    </style>
</head>
<body>
    <!-- ÊòüÁ©∫ËÉåÊôØ -->
    <div class="star-bg" id="starBg"></div>
    
    <!-- È≠îÊ≥ïÁ≤íÂ≠ê -->
    <div class="magic-particles" id="magicParticles"></div>
    
    <!-- Áé©ÂÆ∂Ë®ªÂÜäÂΩàÁ™ó -->
    <div class="player-register-modal" id="playerRegisterModal">
        <div class="register-content">
            <div class="register-title">üéÆ Ê≠°Ëøé‰æÜÂà∞‰ªôÊ¥ûÂ∞èÂ§©ÊâçÔºÅ</div>
            <div class="register-subtitle">Ë´ãËº∏ÂÖ•ÊÇ®ÁöÑÊö±Á®±ÔºåÈñãÂßãÁí∞‰øùÂÜíÈö™ÔºÅ</div>
            <input type="text" class="register-input" id="playerNameInput" 
                   placeholder="Ëº∏ÂÖ•Êö±Á®±ÔºàÊúÄÂ§ö10Â≠óÔºâ" maxlength="10">
            <button class="register-btn" id="registerBtn">ÈñãÂßãÈÅäÊà≤ÔºÅ</button>
            <div style="margin-top: 15px; color: #a1c4fd; font-size: 1rem;">
                <i class="fas fa-info-circle"></i> ÊÇ®ÁöÑÊàêÁ∏æÂ∞áÂá∫ÁèæÂú®ÊéíË°åÊ¶ú‰∏äÔºÅ
            </div>
        </div>
    </div>

    <!-- ÊéíË°åÊ¶úÂΩàÁ™ó -->
    <div class="leaderboard-modal" id="leaderboardModal">
        <div class="leaderboard-content-modal">
            <button class="close-leaderboard" id="closeLeaderboard">
                <i class="fas fa-times"></i>
            </button>
            <div class="leaderboard-title">üèÜ ‰ªäÊó•ÊéíË°åÊ¶ú</div>
            <table class="leaderboard-table">
                <thead>
                    <tr>
                        <th>ÊéíÂêç</th>
                        <th>Áé©ÂÆ∂</th>
                        <th>ÂàÜÊï∏</th>
                    </tr>
                </thead>
                <tbody id="leaderboardTableBody">
                    <!-- ÊéíË°åÊ¶úÊï∏ÊìöÊúÉÂãïÊÖãÁîüÊàê -->
                </tbody>
            </table>
            <div style="color: #a1c4fd; font-size: 1.1rem; margin-top: 15px;">
                <i class="fas fa-sync-alt"></i> ÊéíË°åÊ¶úÊØèÂ§©ÈáçÁΩÆ‰∏ÄÊ¨°
            </div>
        </div>
    </div>

    <!-- ÁÖôÁÅ´ÂãïÁï´ÂÆπÂô® -->
    <div class="fireworks-container" id="fireworksContainer"></div>

    <!-- ÂàÜÊï∏È°ØÁ§∫ -->
    <div class="score-display" id="scoreDisplay">0</div>

    <!-- ÊéíÂêçÊÖ∂Á•ùÂãïÁï´ -->
    <div class="rank-celebration" id="rankCelebration"></div>
    
    <!-- Á†¥ÈóúÊÅ≠ÂñúÁï´Èù¢ -->
    <div class="final-victory-celebration" id="finalVictoryCelebration">
        <div class="final-victory-content">
            <div class="final-victory-icon">üéâüèÜ‚ú®</div>
            <div class="final-victory-title">ÊÅ≠ÂñúÂÖ®Á†¥ÔºÅ</div>
            <div class="final-victory-subtitle">Áí∞‰øùÂ§ßÂ∏´ÊàêÂ∞±ÈÅîÊàêÔºÅ</div>
            <div class="final-victory-message">
                ‰Ω†Â∑≤Á∂ìÊàêÂäüÂÆåÊàê‰∫ÜÊâÄÊúâÁí∞‰øùÊåëÊà∞ÔºÅ<br>
                ÊàêÁÇ∫ÁúüÊ≠£ÁöÑ‰ªôÊ¥ûÁí∞‰øùÂ∞èÂ§©ÊâçÔºÅ
            </div>
            
            <div class="final-victory-stats" id="finalVictoryStats">
                <!-- Áµ±Ë®àÊï∏ÊìöÊúÉÂú®ÈÄôË£°ÂãïÊÖãÁîüÊàê -->
            </div>
            
            <div class="final-victory-rewards">
                <div class="final-rewards-title">üéÅ ÊúÄÁµÇÁçéÂãµ</div>
                <div class="final-rewards-grid">
                    <div class="final-reward-item" style="border-color: #FFD700;">
                        <div class="final-reward-icon">üèÜ</div>
                        <div class="final-reward-text">Áí∞‰øùÂ§ßÂ∏´Á®±Ëôü</div>
                    </div>
                    <div class="final-reward-item" style="border-color: #4CAF50;">
                        <div class="final-reward-icon">üíé</div>
                        <div class="final-reward-text">Ê¶ÆË≠ΩÂæΩÁ´†</div>
                    </div>
                    <div class="final-reward-item" style="border-color: #36D1DC;">
                        <div class="final-reward-icon">‚≠ê</div>
                        <div class="final-reward-text">ÂÖ®Á†¥ÊàêÂ∞±</div>
                    </div>
                    <div class="final-reward-item" style="border-color: #9C27B0;">
                        <div class="final-reward-icon">üëë</div>
                        <div class="final-reward-text">ÊéíË°åÊ¶úÂÜ†Ëªç</div>
                    </div>
                </div>
            </div>
            
            <div class="final-victory-buttons">
                <button class="final-victory-btn btn-share" id="shareBtn">
                    <i class="fas fa-share-alt"></i> ÂàÜ‰∫´ÊàêÂ∞±
                </button>
                <button class="final-victory-btn btn-restart" id="restartGameBtn">
                    <i class="fas fa-redo"></i> ÈáçÊñ∞ÈÅäÊà≤
                </button>
                <button class="final-victory-btn btn-home" id="finalHomeBtn">
                    <i class="fas fa-home"></i> ËøîÂõûÈ¶ñÈ†Å
                </button>
            </div>
        </div>
    </div>
    
    <!-- ‰∏ÄËà¨ÊÖ∂Á•ùÂãïÁï´ -->
    <div class="victory-celebration" id="victoryCelebration">
        <div class="victory-content">
            <div class="victory-icon" id="victoryIcon">üèÜ</div>
            <div class="victory-title" id="victoryTitle">ÈóúÂç°ÂÆåÊàêÔºÅ</div>
            <div class="victory-message" id="victoryMessage"></div>
            <div class="victory-rewards" id="victoryRewards"></div>
            <button class="victory-button" id="victoryButton">ÁπºÁ∫åÂÜíÈö™ÔºÅ</button>
        </div>
    </div>
    
    <!-- ÊéíË°åÊ¶úÂÖ•Âè£ -->
    <div class="leaderboard-system" id="leaderboardSystem">
        <div class="leaderboard-icon">üèÜ</div>
        <div class="leaderboard-content">
            <div class="leaderboard-player">
                <div class="player-rank">1</div>
                <div class="player-name" id="topPlayerName">ËºâÂÖ•‰∏≠...</div>
                <div class="player-score" id="topPlayerScore">0</div>
            </div>
        </div>
    </div>
    
    <!-- Áé©ÂÆ∂Ë≥áË®äÈ°ØÁ§∫ -->
    <div class="player-info-system" id="playerInfoSystem">
        <div class="player-avatar" id="playerAvatar">üë§</div>
        <div>
            <div class="player-name-display" id="playerNameDisplay">Áé©ÂÆ∂</div>
            <div class="player-drops">
                <i class="fas fa-tint"></i>
                <span id="playerDropsCount">0</span> Ê∞¥Êª¥
            </div>
        </div>
    </div>

    <!-- ËøîÂõûÊåâÈàï -->
    <button class="magic-back-btn" id="magicBackBtn">
        <i class="fas fa-arrow-left"></i> ËøîÂõûÈóúÂç°
    </button>
    
    <!-- ÈóúÂç°Á≥ªÁµ± -->
    <div class="level-system">
        <div class="level-icon">üìä</div>
        <div>ÈóúÂç° <span id="currentLevel">1</span>/4</div>
        <div class="level-progress">
            <div class="level-progress-bar" id="levelProgressBar"></div>
        </div>
    </div>
    
    <!-- ËÉΩÂäõÁ≥ªÁµ± -->
    <div class="abilities-system">
        <div class="abilities-title">Â∞èÂ§©ÊâçËÉΩÂäõÂÄº</div>
        <div class="abilities-grid">
            <div class="ability-item">
                <div class="ability-icon">üíß</div>
                <div class="ability-name">ÁØÄÊ∞¥ÊäÄÂ∑ß</div>
                <div class="ability-value" id="waterSkill">50%</div>
                <div class="ability-bar">
                    <div class="ability-fill" id="waterSkillBar" style="width: 50%"></div>
                </div>
            </div>
            <div class="ability-item">
                <div class="ability-icon">üìö</div>
                <div class="ability-name">Áí∞‰øùÁü•Ë≠ò</div>
                <div class="ability-value" id="knowledgeSkill">25%</div>
                <div class="ability-bar">
                    <div class="ability-fill" id="knowledgeSkillBar" style="width: 25%"></div>
                </div>
            </div>
            <div class="ability-item">
                <div class="ability-icon">üåü</div>
                <div class="ability-name">Áí∞‰øùÁ≤æÁ•û</div>
                <div class="ability-value" id="ecoSkill">30%</div>
                <div class="ability-bar">
                    <div class="ability-fill" id="ecoSkillBar" style="width: 30%"></div>
                </div>
            </div>
            <div class="ability-item">
                <div class="ability-icon">‚ö°</div>
                <div class="ability-name">ÊåëÊà∞ÈÄüÂ∫¶</div>
                <div class="ability-value" id="speedSkill">40%</div>
                <div class="ability-bar">
                    <div class="ability-fill" id="speedSkillBar" style="width: 40%"></div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="universe-container">
        <!-- ÈÅäÊà≤Âç°Áâá -->
        <div class="galaxy-card">
            <div class="game-header">
                <h1 class="game-title">üíß ‰ªôÊ¥ûÂ∞èÂ§©Êâç üåü</h1>
                <p class="game-subtitle">Áí∞‰øùÈóñÈóúÂ§ßÂÜíÈö™</p>
            </div>
            
            <!-- ÈóúÂç°ÈÅ∏Êìá -->
            <div class="level-selection" id="levelSelection">
                <div class="level-intro">
                    <h2>üéÆ ÈÅ∏Êìá‰Ω†ÁöÑÊåëÊà∞ÔºÅ</h2>
                    <p>ÂæûÁ∞°ÂñÆÂà∞Âõ∞Èõ£ÔºåÊØèÂÄãÈóúÂç°ÈÉΩÊúâ‰∏çÂêåÁöÑÁí∞‰øùÊåëÊà∞Á≠âËëó‰Ω†ÔºÅ</p>
                    <p style="color: #FFD700; margin-top: 10px; font-size: 1.2rem;">
                        ÂÆåÊàêÈóúÂç°ÂèØ‰ª•ÊèêÂçá‰Ω†ÁöÑÂ∞èÂ§©ÊâçËÉΩÂäõÂÄºÔºÅ
                    </p>
                </div>
                
                <div class="level-buttons">
                    <button class="level-btn" data-level="1" style="border-color: #36D1DC;">
                        <div class="level-icon-large">üö∞</div>
                        <div>Êñ∞ÊâãÈóúÂç°</div>
                        <div class="level-difficulty">Á∞°ÂñÆ</div>
                        <div class="level-reward">
                            <i class="fas fa-tint"></i>
                            <span>ÁçéÂãµÔºö3-5Ê∞¥Êª¥</span>
                        </div>
                    </button>
                    
                    <button class="level-btn" data-level="2" style="border-color: #4CAF50;">
                        <div class="level-icon-large">üìö</div>
                        <div>Áü•Ë≠òÈóúÂç°</div>
                        <div class="level-difficulty">‰∏≠Á≠â</div>
                        <div class="level-reward">
                            <i class="fas fa-tint"></i>
                            <span>ÁçéÂãµÔºö5-8Ê∞¥Êª¥</span>
                        </div>
                    </button>
                    
                    <button class="level-btn" data-level="3" style="border-color: #FF9800;">
                        <div class="level-icon-large">üéØ</div>
                        <div>È´òÊâãÈóúÂç°</div>
                        <div class="level-difficulty">Âõ∞Èõ£</div>
                        <div class="level-reward">
                            <i class="fas fa-tint"></i>
                            <span>ÁçéÂãµÔºö8-12Ê∞¥Êª¥</span>
                        </div>
                    </button>
                    
                    <button class="level-btn" data-level="4" style="border-color: #9C27B0;">
                        <div class="level-icon-large">‚ôªÔ∏è</div>
                        <div>Áí∞‰øùÂ§ß‰ΩúÊà∞</div>
                        <div class="level-difficulty">ÊåëÊà∞</div>
                        <div class="level-reward">
                            <i class="fas fa-tint"></i>
                            <span>ÁçéÂãµÔºö12-15Ê∞¥Êª¥</span>
                        </div>
                    </button>
                </div>
            </div>
            
            <!-- ÈÅäÊà≤ÂÖßÂÆπÂçÄ -->
            <div class="game-content">
                <!-- Êé•Ê∞¥ÊåëÊà∞ÂçÄ -->
                <div class="water-game-area" id="waterGameArea">
                    <div class="game-area-title">
                        <h2>üö∞ Êé•Ê∞¥Â§ßÊåëÊà∞</h2>
                        <p>Á≤æÊ∫ñÊé•Ê∞¥ÔºåÂüπÈ§äÁØÄÊ∞¥Â•ΩÁøíÊÖ£ÔºÅ</p>
                    </div>
                    
                    <div class="mission-info" id="waterMissionInfo">
                        <div class="mission-title">
                            <i class="fas fa-bullseye"></i>
                            <span>‰ªªÂãôÁõÆÊ®ô</span>
                        </div>
                        <div class="mission-desc" id="waterMissionDesc">
                            Ë´ãÂú®ÊåáÂÆöÊôÇÈñìÂÖßÊé•Âà∞ÂâõÂ•Ω250mlÁöÑÊ∞¥ÔºÅ
                        </div>
                        <div class="mission-requirements" id="waterRequirements">
                            <!-- ‰ªªÂãôË¶ÅÊ±ÇÊúÉÂú®ÈÄôË£°ÂãïÊÖãÁîüÊàê -->
                        </div>
                    </div>
                    
                    <div class="water-challenge">
                        <div class="water-container-complex">
                            <div class="water-faucet-complex"></div>
                            <div class="water-stream-animation" id="waterStream"></div>
                            <div class="water-cup-complex">
                                <div class="water-level-complex" id="waterLevelComplex"></div>
                                <div class="water-measurements">
                                    <div class="measurement" style="top: 0%;">300ml</div>
                                    <div class="measurement" style="top: 20%;">250ml</div>
                                    <div class="measurement" style="top: 40%;">200ml</div>
                                    <div class="measurement" style="top: 60%;">150ml</div>
                                    <div class="measurement" style="top: 80%;">100ml</div>
                                    <div class="measurement" style="top: 100%;">0ml</div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="water-stats">
                            <div class="water-stat-item">
                                <div class="water-stat-title">
                                    <i class="fas fa-clock"></i>
                                    <span>Ââ©È§òÊôÇÈñì</span>
                                </div>
                                <div class="water-timer" id="waterTimer">30.0 Áßí</div>
                            </div>
                            
                            <div class="water-stat-item">
                                <div class="water-stat-title">
                                    <i class="fas fa-tint"></i>
                                    <span>Áï∂ÂâçÊ∞¥Èáè</span>
                                </div>
                                <div class="water-stat-value" id="currentWater">0 ml</div>
                            </div>
                            
                            <div class="water-stat-item">
                                <div class="water-stat-title">
                                    <i class="fas fa-crosshairs"></i>
                                    <span>ÁõÆÊ®ôÊ∞¥Èáè</span>
                                </div>
                                <div class="water-stat-value">250 ml</div>
                            </div>
                            
                            <div class="water-stat-item">
                                <div class="water-stat-title">
                                    <i class="fas fa-star"></i>
                                    <span>ÊúÄÈ´òÁ¥ÄÈåÑ</span>
                                </div>
                                <div class="water-stat-value" id="waterBestScore">0 ÂàÜ</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="water-feedback" id="waterFeedback"></div>
                    
                    <div class="water-controls">
                        <button class="water-btn btn-start-water" id="waterStartBtn">
                            <i class="fas fa-play"></i> ÈñãÂßãÊåëÊà∞
                        </button>
                        <button class="water-btn btn-stop-water" id="waterStopBtn" disabled>
                            <i class="fas fa-stop"></i> ÂÅúÊ≠¢Êé•Ê∞¥
                        </button>
                        <button class="water-btn btn-restart-water" id="waterRestartBtn">
                            <i class="fas fa-redo"></i> ÈáçÊñ∞ÊåëÊà∞
                        </button>
                    </div>
                </div>
                
                <!-- Áü•Ë≠òÊåëÊà∞ÂçÄ -->
                <div class="quiz-game-area" id="quizGameArea">
                    <div class="game-area-title">
                        <h2>üìö Áí∞‰øùÁü•Ë≠òÊåëÊà∞</h2>
                        <p>Â≠∏ÁøíÁí∞‰øùÁü•Ë≠òÔºåÊàêÁÇ∫Áí∞‰øùÂ∞èÂ∞àÂÆ∂ÔºÅ</p>
                    </div>
                    
                    <div class="mission-info" id="quizMissionInfo">
                        <div class="mission-title">
                            <i class="fas fa-graduation-cap"></i>
                            <span>‰ªªÂãôÁõÆÊ®ô</span>
                        </div>
                        <div class="mission-desc" id="quizMissionDesc">
                            ÂõûÁ≠îÁí∞‰øùÁü•Ë≠òÂïèÈ°åÔºåÂÆåÊàêÊåëÊà∞ÔºÅ
                        </div>
                        <div class="mission-requirements" id="quizRequirements">
                            <!-- ‰ªªÂãôË¶ÅÊ±ÇÊúÉÂú®ÈÄôË£°ÂãïÊÖãÁîüÊàê -->
                        </div>
                    </div>
                    
                    <div class="quiz-challenge">
                        <div class="quiz-progress">
                            <div class="quiz-question-number">
                                ÂïèÈ°å <span id="currentQuestionNum">1</span>/<span id="totalQuestions">4</span>
                            </div>
                            <div class="quiz-progress-bar">
                                <div class="quiz-progress-fill" id="quizProgressFill"></div>
                            </div>
                            <div style="color: #FFD700; font-weight: bold; font-size: 1.5rem;">
                                <span id="quizScore">0</span> ÂàÜ
                            </div>
                        </div>
                        
                        <div class="quiz-question-card">
                            <div class="quiz-question-text" id="quizQuestionText">
                                ÂïèÈ°åËºâÂÖ•‰∏≠...
                            </div>
                            
                            <div class="quiz-options-grid" id="quizOptionsGrid">
                                <!-- ÈÅ∏È†ÖÊúÉÂú®ÈÄôË£°ÂãïÊÖãÁîüÊàê -->
                            </div>
                            
                            <div class="quiz-feedback-card" id="quizFeedbackCard">
                                <div class="quiz-feedback-title">
                                    <i class="fas fa-lightbulb"></i>
                                    <span>Áü•Ë≠òËß£Ë™™</span>
                                </div>
                                <div class="quiz-feedback-text" id="quizFeedbackText"></div>
                                <div class="quiz-esg-tags" id="quizEsgTags"></div>
                            </div>
                        </div>
                        
                        <div class="quiz-controls">
                            <button class="quiz-btn" id="quizNextBtn">
                                ‰∏ã‰∏ÄÈ°å <i class="fas fa-arrow-right"></i>
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Áí∞‰øùÊåëÊà∞ÂçÄ -->
                <div class="eco-game-area" id="ecoGameArea">
                    <div class="game-area-title">
                        <h2>‚ôªÔ∏è Áí∞‰øùÂ§ß‰ΩúÊà∞</h2>
                        <p>ÂûÉÂúæÂàÜÈ°ûÊåëÊà∞Ôºå‰øùË≠∑ÊàëÂÄëÁöÑÂú∞ÁêÉÔºÅ</p>
                    </div>
                    
                    <div class="mission-info" id="ecoMissionInfo">
                        <div class="mission-title">
                            <i class="fas fa-recycle"></i>
                            <span>‰ªªÂãôÁõÆÊ®ô</span>
                        </div>
                        <div class="mission-desc" id="ecoMissionDesc">
                            Â∞áÂûÉÂúæÊ≠£Á¢∫ÂàÜÈ°ûÂà∞Â∞çÊáâÁöÑÂûÉÂúæÊ°∂ÔºÅ
                        </div>
                        <div class="mission-requirements" id="ecoRequirements">
                            <!-- ‰ªªÂãôË¶ÅÊ±ÇÊúÉÂú®ÈÄôË£°ÂãïÊÖãÁîüÊàê -->
                        </div>
                    </div>
                    
                    <div class="eco-challenge">
                        <div class="eco-game-container">
                            <div class="eco-trash-area">
                                <div class="eco-trash-title">Áí∞‰øùÂûÉÂúæÊ°∂</div>
                                <div class="eco-trash-can" id="trashCan">
                                    <div class="trash-can-lid"></div>
                                    <div class="trash-level" id="trashLevel"></div>
                                </div>
                                <div class="trash-items-container" id="trashItemsContainer">
                                    <!-- ÂûÉÂúæÈ†ÖÁõÆÊúÉÂú®ÈÄôË£°ÂãïÊÖãÁîüÊàê -->
                                </div>
                            </div>
                            
                            <div class="eco-stats">
                                <div class="eco-stat-item">
                                    <div class="eco-stat-title">
                                        <i class="fas fa-clock"></i>
                                        <span>Ââ©È§òÊôÇÈñì</span>
                                    </div>
                                    <div class="eco-timer" id="ecoTimer">60 Áßí</div>
                                </div>
                                
                                <div class="eco-stat-item">
                                    <div class="eco-stat-title">
                                        <i class="fas fa-check-circle"></i>
                                        <span>Ê≠£Á¢∫ÂàÜÈ°û</span>
                                    </div>
                                    <div class="eco-stat-value" id="ecoCorrectCount">0</div>
                                </div>
                                
                                <div class="eco-stat-item">
                                    <div class="eco-stat-title">
                                        <i class="fas fa-times-circle"></i>
                                        <span>ÈåØË™§ÂàÜÈ°û</span>
                                    </div>
                                    <div class="eco-stat-value" id="ecoWrongCount">0</div>
                                </div>
                                
                                <div class="eco-stat-item">
                                    <div class="eco-stat-title">
                                        <i class="fas fa-star"></i>
                                        <span>Áï∂ÂâçÂàÜÊï∏</span>
                                    </div>
                                    <div class="eco-stat-value" id="ecoCurrentScore">0</div>
                                </div>
                                
                                <div class="eco-score-display">
                                    <div style="color: #FFD700; font-size: 1.2rem; font-weight: bold;">
                                        ÁõÆÊ®ôÂàÜÊï∏Ôºö<span id="ecoTargetScore">80</span>ÂàÜ
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="eco-controls">
                            <button class="eco-btn" id="ecoStartBtn">
                                <i class="fas fa-play"></i> ÈñãÂßãÊåëÊà∞
                            </button>
                            <button class="eco-btn" id="ecoRestartBtn">
                                <i class="fas fa-redo"></i> ÈáçÊñ∞ÊåëÊà∞
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ÈÅäÊà≤ÁãÄÊÖãÁÆ°ÁêÜ
        const gameState = {
            currentLevel: 1,
            
            // Áé©ÂÆ∂ÁãÄÊÖã
            player: {
                name: '',
                avatar: 'üë§',
                registered: false,
                currentScore: 0
            },
            
            // ÊéíË°åÊ¶úÊï∏Êìö
            leaderboard: [],
            
            levels: {
                1: {
                    name: "Êñ∞ÊâãÈóúÂç°",
                    difficulty: "Á∞°ÂñÆ",
                    type: "water",
                    targetScore: 60,
                    timeLimit: 30,
                    attempts: 3,
                    completed: false,
                    bestScore: 0,
                    reward: { min: 3, max: 5 },
                    requirements: [
                        { text: "Ë™§Â∑ÆÂ∞èÊñº50ml", type: "accuracy" },
                        { text: "ÊôÇÈñìÂÖßÂÆåÊàê", type: "time" }
                    ]
                },
                2: {
                    name: "Áü•Ë≠òÈóúÂç°",
                    difficulty: "‰∏≠Á≠â",
                    type: "quiz",
                    targetScore: 80,
                    questions: 4,
                    completed: false,
                    bestScore: 0,
                    reward: { min: 5, max: 8 },
                    requirements: [
                        { text: "Á≠îÂ∞ç3È°å‰ª•‰∏ä", type: "accuracy" },
                        { text: "‰∫ÜËß£ESGÊ¶ÇÂøµ", type: "knowledge" }
                    ]
                },
                3: {
                    name: "È´òÊâãÈóúÂç°",
                    difficulty: "Âõ∞Èõ£",
                    type: "water",
                    targetScore: 85,
                    timeLimit: 20,
                    attempts: 2,
                    completed: false,
                    bestScore: 0,
                    reward: { min: 8, max: 12 },
                    requirements: [
                        { text: "Ë™§Â∑ÆÂ∞èÊñº20ml", type: "accuracy" },
                        { text: "20ÁßíÂÖßÂÆåÊàê", type: "time" },
                        { text: "‰∏ÄÊ¨°ÊåëÊà∞ÊàêÂäü", type: "perfection" }
                    ]
                },
                4: {
                    name: "Áí∞‰øùÂ§ß‰ΩúÊà∞",
                    difficulty: "ÊåëÊà∞",
                    type: "eco",
                    targetScore: 90,
                    timeLimit: 60,
                    completed: false,
                    bestScore: 0,
                    reward: { min: 12, max: 15 },
                    requirements: [
                        { text: "Ê≠£Á¢∫ÂàÜÈ°û8ÂÄã‰ª•‰∏ä", type: "accuracy" },
                        { text: "60ÁßíÂÖßÂÆåÊàê", type: "time" },
                        { text: "Áí∞‰øùÂ∞èÈÅî‰∫∫", type: "expert" }
                    ]
                }
            },
            
            // Áé©ÂÆ∂ËÉΩÂäõÂÄº
            abilities: {
                waterSkill: 50,
                knowledgeSkill: 25,
                ecoSkill: 30,
                speedSkill: 40,
                totalScore: 0,
                waterDrops: 100
            },
            
            // Êé•Ê∞¥ÈÅäÊà≤ÁãÄÊÖã
            waterGame: {
                isRunning: false,
                timer: 30,
                timerInterval: null,
                waterLevel: 0,
                waterInterval: null,
                currentAttempt: 0,
                levelScore: 0,
                accuracy: 0
            },
            
            // Áü•Ë≠òÈÅäÊà≤ÁãÄÊÖã
            quizGame: {
                currentQuestion: 0,
                score: 0,
                answered: false,
                questions: [
                    {
                        question: "Ê¥óÊâãÊôÇÊúÄÁØÄÊ∞¥ÁöÑÊ≠£Á¢∫Ê≠•È©üÊòØÔºü",
                        options: [
                            "Ê∞¥ÈæçÈ†≠ÂÖ®ÈñãÔºåÂ§ßÂäõÊ≤ñÊ¥ó",
                            "ÂÖàÊøïÊâãÔºåÈóúÊ∞¥ÊêìËÇ•ÁöÇÔºåÂÜçÈñãÊ∞¥Ê≤ñÊ¥ó",
                            "ËÆìÊ∞¥‰∏ÄÁõ¥ÊµÅÔºåÊÖ¢ÊÖ¢Ê¥ó‰πæÊ∑®"
                        ],
                        correct: 1,
                        explanation: "Ê≠£Á¢∫ÔºÅÂÖàÊøïÊâãÂ∞±ÈóúÊ∞¥ÔºåÊêìËÇ•ÁöÇ20ÁßíÂæåÂÜçÈñãÊ∞¥Ê≤ñÊ¥óÔºåÈÄôÊ®£ÂèØ‰ª•ÁØÄÁúÅÂ§ßÈáèÁî®Ê∞¥ÔºÅ",
                        esg: ["environment", "social"],
                        points: 25
                    },
                    {
                        question: "ESG‰∏≠ÁöÑ'S'‰ª£Ë°®‰ªÄÈ∫ºÊÑèÊÄùÔºü",
                        options: [
                            "ÁØÄÁ¥Ñ (Save)",
                            "Á§æÊúÉË≤¨‰ªª (Social)",
                            "Â≠∏Ê†° (School)"
                        ],
                        correct: 1,
                        explanation: "Ê≠£Á¢∫ÔºÅS‰ª£Ë°®Á§æÊúÉË≤¨‰ªªÔºåÂåÖÊã¨ÈóúÂøÉÁ§æÂçÄÁî®Ê∞¥ÂÖ¨Âπ≥„ÄÅÂπ´Âä©ÊúâÈúÄË¶ÅÁöÑ‰∫∫ÂêàÁêÜÁî®Ê∞¥Á≠â„ÄÇ",
                        esg: ["social"],
                        points: 25
                    },
                    {
                        question: "Âì™Á®ÆÊ¥óÊæ°ÊñπÂºèÊúÄÁØÄÊ∞¥Ôºü",
                        options: [
                            "Ê≥°Êæ°30ÂàÜÈêò‰∫´Âèó",
                            "Ê∑ãÊµ¥‰∏çË∂ÖÈÅé5ÂàÜÈêò",
                            "ÈÇäÊ¥óÊæ°ÈÇäÂî±Ê≠åÊîæÈ¨Ü"
                        ],
                        correct: 1,
                        explanation: "Ê≠£Á¢∫ÔºÅÊ∑ãÊµ¥ÊØîÊ≥°Êæ°ÁØÄÁúÅ70%‰ª•‰∏äÁöÑÊ∞¥ÔºåÊéßÂà∂ÊôÇÈñìÂú®5ÂàÜÈêòÂÖßÊòØÊúÄÂ•ΩÁöÑÁØÄÊ∞¥ÊñπÂºè„ÄÇ",
                        esg: ["environment"],
                        points: 25
                    },
                    {
                        question: "Â≠∏Ê†°ÁÇ∫‰ªÄÈ∫ºË¶ÅÂà∂ÂÆöÁî®Ê∞¥Ë¶èÁØÑÔºü",
                        options: [
                            "ÁÇ∫‰∫ÜÁúÅÊ∞¥Ë≤ª",
                            "ÂüπÈ§äÂ≠∏ÁîüÁØÄÊ∞¥ÁøíÊÖ£ÔºåÊ∞∏Á∫åÁôºÂ±ï",
                            "ËÄÅÂ∏´Ë¶èÂÆöÁöÑ"
                        ],
                        correct: 1,
                        explanation: "Ê≠£Á¢∫ÔºÅÂà∂ÂÆöË¶èÁØÑÊòØÊ≤ªÁêÜ(G)ÁöÑÈáçË¶ÅÈÉ®ÂàÜÔºåÂèØ‰ª•Á≥ªÁµ±ÊÄßÂüπÈ§äÂ≠∏ÁîüÁöÑÁØÄÊ∞¥ÁøíÊÖ£ÔºåÂØ¶ÁèæÊ∞∏Á∫åÁôºÂ±ï„ÄÇ",
                        esg: ["governance", "social"],
                        points: 25
                    }
                ]
            },
            
            // Áí∞‰øùÈÅäÊà≤ÁãÄÊÖã
            ecoGame: {
                isRunning: false,
                timer: 60,
                timerInterval: null,
                correctCount: 0,
                wrongCount: 0,
                currentScore: 0,
                totalItems: 10,
                items: [
                    { id: 1, name: "Â°ëËÜ†Áì∂", type: "recyclable", icon: "üß¥" },
                    { id: 2, name: "ÈõªÊ±†", type: "hazardous", icon: "üîã" },
                    { id: 3, name: "Á¥ôÂºµ", type: "recyclable", icon: "üìÑ" },
                    { id: 4, name: "È¶ôËïâÁöÆ", type: "non-recyclable", icon: "üçå" },
                    { id: 5, name: "ÁéªÁíÉÁì∂", type: "recyclable", icon: "üç∂" },
                    { id: 6, name: "Âª¢Ê£ÑÁáàÁÆ°", type: "hazardous", icon: "üí°" },
                    { id: 7, name: "Â°ëËÜ†Ë¢ã", type: "non-recyclable", icon: "üõçÔ∏è" },
                    { id: 8, name: "ÈãÅÁΩê", type: "recyclable", icon: "ü•´" },
                    { id: 9, name: "Ê≤πÊºÜÊ°∂", type: "hazardous", icon: "üé®" },
                    { id: 10, name: "Ë°õÁîüÁ¥ô", type: "non-recyclable", icon: "üßª" }
                ],
                remainingItems: []
            }
        };

        // ÈÅäÊà≤ÂàùÂßãÂåñ
        function initGame() {
            console.log("üéÆ ÈÅäÊà≤ÂàùÂßãÂåñ...");
            
            // ÂâµÂª∫ÊòüÁ©∫ËÉåÊôØ
            createStars();
            
            // ÂâµÂª∫È≠îÊ≥ïÁ≤íÂ≠ê
            createMagicParticles();
            
            // Ë®≠ÁΩÆÈóúÂç°ÊåâÈàï‰∫ã‰ª∂
            document.querySelectorAll('.level-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const level = parseInt(this.getAttribute('data-level'));
                    startLevel(level);
                });
                
                // Ëß∏Êë∏ÂõûÈ•ã
                btn.addEventListener('touchstart', function() {
                    this.style.opacity = '0.8';
                });
                
                btn.addEventListener('touchend', function() {
                    this.style.opacity = '1';
                });
            });
            
            // Ë®≠ÁΩÆËøîÂõûÊåâÈàï
            document.getElementById('magicBackBtn').addEventListener('click', returnToLevelSelection);
            
            // Ë®≠ÁΩÆÊé•Ê∞¥ÈÅäÊà≤ÊåâÈàï
            document.getElementById('waterStartBtn').addEventListener('click', startWaterChallenge);
            document.getElementById('waterStopBtn').addEventListener('click', stopWaterChallenge);
            document.getElementById('waterRestartBtn').addEventListener('click', restartWaterChallenge);
            
            // Ë®≠ÁΩÆÁü•Ë≠òÈÅäÊà≤ÊåâÈàï
            document.getElementById('quizNextBtn').addEventListener('click', nextQuizQuestion);
            
            // Ë®≠ÁΩÆÁí∞‰øùÈÅäÊà≤ÊåâÈàï
            document.getElementById('ecoStartBtn').addEventListener('click', startEcoChallenge);
            document.getElementById('ecoRestartBtn').addEventListener('click', restartEcoChallenge);
            
            // Ë®≠ÁΩÆÂãùÂà©ÊåâÈàï
            document.getElementById('victoryButton').addEventListener('click', returnToLevelSelection);
            
            // Ë®≠ÁΩÆÊúÄÁµÇÂãùÂà©ÊåâÈàï
            document.getElementById('shareBtn').addEventListener('click', shareAchievement);
            document.getElementById('restartGameBtn').addEventListener('click', restartGame);
            document.getElementById('finalHomeBtn').addEventListener('click', returnToLevelSelection);
            
            // Ë®≠ÁΩÆÊéíË°åÊ¶úÈªûÊìä‰∫ã‰ª∂
            document.getElementById('leaderboardSystem').addEventListener('click', showLeaderboardModal);
            document.getElementById('closeLeaderboard').addEventListener('click', hideLeaderboardModal);
            
            // Ë®≠ÁΩÆË®ªÂÜäÊåâÈàï‰∫ã‰ª∂
            document.getElementById('registerBtn').addEventListener('click', registerPlayer);
            document.getElementById('playerNameInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') registerPlayer();
            });
            
            // ÂÑ™ÂåñÊâãÊ©üËº∏ÂÖ•È´îÈ©ó
            document.getElementById('playerNameInput').addEventListener('focus', function() {
                setTimeout(() => {
                    this.scrollIntoView({ behavior: 'smooth', block: 'center' });
                }, 300);
            });
            
            // ÂàùÂßãÂåñÁé©ÂÆ∂Á≥ªÁµ±ÂíåÊéíË°åÊ¶ú
            initPlayerSystem();
            initLeaderboard();
            
            console.log("üéÆ ÈÅäÊà≤ÂàùÂßãÂåñÂÆåÊàêÔºÅ");
        }

        // ÂàùÂßãÂåñÁé©ÂÆ∂Á≥ªÁµ±
        function initPlayerSystem() {
            const savedPlayer = localStorage.getItem('waterGeniusPlayer');
            const savedDate = localStorage.getItem('waterGeniusDate');
            const today = new Date().toDateString();
            
            if (savedPlayer && savedDate === today) {
                gameState.player = JSON.parse(savedPlayer);
                gameState.player.registered = true;
                hidePlayerRegister();
                updatePlayerInfoDisplay();
                showLevelSelection();
            } else {
                localStorage.removeItem('waterGeniusPlayer');
                showPlayerRegister();
            }
        }

        // ÂàùÂßãÂåñÊéíË°åÊ¶ú
        function initLeaderboard() {
            const savedLeaderboard = localStorage.getItem('waterGeniusLeaderboard');
            const savedLeaderboardDate = localStorage.getItem('waterGeniusLeaderboardDate');
            const today = new Date().toDateString();
            
            if (savedLeaderboard && savedLeaderboardDate === today) {
                gameState.leaderboard = JSON.parse(savedLeaderboard);
            } else {
                gameState.leaderboard = [];
                saveLeaderboard();
            }
            
            updateLeaderboardDisplay();
        }

        // È°ØÁ§∫Áé©ÂÆ∂Ë®ªÂÜä
        function showPlayerRegister() {
            document.getElementById('playerRegisterModal').style.display = 'flex';
            document.getElementById('playerNameInput').focus();
        }

        // Èö±ËóèÁé©ÂÆ∂Ë®ªÂÜä
        function hidePlayerRegister() {
            document.getElementById('playerRegisterModal').style.display = 'none';
        }

        // Ë®ªÂÜäÁé©ÂÆ∂
        function registerPlayer() {
            const playerName = document.getElementById('playerNameInput').value.trim();
            
            if (!playerName) {
                showMobileAlert('Ë´ãËº∏ÂÖ•ÊÇ®ÁöÑÊö±Á®±ÔºÅ');
                return;
            }
            
            if (playerName.length > 10) {
                showMobileAlert('Êö±Á®±‰∏çËÉΩË∂ÖÈÅé10ÂÄãÂ≠óÔºÅ');
                return;
            }
            
            gameState.player.name = playerName;
            gameState.player.avatar = getAvatarFromName(playerName);
            gameState.player.registered = true;
            gameState.player.currentScore = 0;
            
            const today = new Date().toDateString();
            localStorage.setItem('waterGeniusPlayer', JSON.stringify(gameState.player));
            localStorage.setItem('waterGeniusDate', today);
            
            hidePlayerRegister();
            updatePlayerInfoDisplay();
            showLevelSelection();
            showWelcomeMessage();
        }

        // ÊâãÊ©üÂèãÂ•ΩÊèêÁ§∫
        function showMobileAlert(message) {
            const alertDiv = document.createElement('div');
            alertDiv.style.position = 'fixed';
            alertDiv.style.top = '50%';
            alertDiv.style.left = '50%';
            alertDiv.style.transform = 'translate(-50%, -50%)';
            alertDiv.style.backgroundColor = 'rgba(0,0,0,0.9)';
            alertDiv.style.color = 'white';
            alertDiv.style.padding = '20px';
            alertDiv.style.borderRadius = '15px';
            alertDiv.style.zIndex = '9999';
            alertDiv.style.textAlign = 'center';
            alertDiv.style.fontSize = '1.2rem';
            alertDiv.style.maxWidth = '80%';
            alertDiv.textContent = message;
            
            document.body.appendChild(alertDiv);
            
            setTimeout(() => {
                alertDiv.remove();
            }, 2000);
        }

        // Ê†πÊìöÂêçÁ®±ÁîüÊàêÈ†≠ÂÉè
        function getAvatarFromName(name) {
            const avatars = ['üë¶', 'üëß', 'üë®', 'üë©', 'üßí', 'üßë', 'üë±', 'üë¥', 'üëµ'];
            const charCode = name.charCodeAt(0) || 0;
            return avatars[charCode % avatars.length];
        }

        // Êõ¥Êñ∞Áé©ÂÆ∂Ë≥áË®äÈ°ØÁ§∫
        function updatePlayerInfoDisplay() {
            if (!gameState.player.registered) return;
            
            document.getElementById('playerInfoSystem').style.display = 'flex';
            document.getElementById('playerAvatar').textContent = gameState.player.avatar;
            document.getElementById('playerNameDisplay').textContent = gameState.player.name;
            document.getElementById('playerDropsCount').textContent = gameState.abilities.waterDrops;
        }

        // È°ØÁ§∫Ê≠°ËøéÊ∂àÊÅØ
        function showWelcomeMessage() {
            const welcomeMessages = [
                `Ê≠°Ëøé ${gameState.player.name}ÔºÅ‰∏ÄËµ∑‰æÜÁí∞‰øùÂêßÔºÅ`,
                `${gameState.player.name}ÔºåÊ∫ñÂÇôÂ•ΩÊàêÁÇ∫Áí∞‰øùÂ∞èÂ§©Êâç‰∫ÜÂóéÔºü`,
                `Ê≠°ËøéÂä†ÂÖ•‰ªôÊ¥ûÁí∞‰øùÈöäÔºå${gameState.player.name}ÔºÅ`
            ];
            
            const message = welcomeMessages[Math.floor(Math.random() * welcomeMessages.length)];
            showMobileAlert(message);
        }

        // ÂâµÂª∫ÊòüÁ©∫
        function createStars() {
            const starBg = document.getElementById('starBg');
            starBg.innerHTML = '';
            for (let i = 0; i < 50; i++) {
                const star = document.createElement('div');
                star.className = 'star';
                star.style.left = `${Math.random() * 100}%`;
                star.style.top = `${Math.random() * 100}%`;
                star.style.width = `${Math.random() * 2 + 1}px`;
                star.style.height = star.style.width;
                star.style.animationDelay = `${Math.random() * 3}s`;
                starBg.appendChild(star);
            }
        }

        // ÂâµÂª∫È≠îÊ≥ïÁ≤íÂ≠ê
        function createMagicParticles() {
            const particles = document.getElementById('magicParticles');
            particles.innerHTML = '';
            
            for (let i = 0; i < 10; i++) {
                const particle = document.createElement('div');
                particle.className = 'magic-particle';
                particle.style.left = `${Math.random() * 100}%`;
                particle.style.width = `${Math.random() * 5 + 3}px`;
                particle.style.height = particle.style.width;
                particle.style.backgroundColor = getRandomColor();
                particle.style.animationDelay = `${Math.random() * 5}s`;
                particle.style.animationDuration = `${Math.random() * 5 + 10}s`;
                particles.appendChild(particle);
            }
        }

        function getRandomColor() {
            const colors = ['#36D1DC', '#5B86E5', '#FF6B6B', '#4CAF50', '#FFD700', '#FF9800'];
            return colors[Math.floor(Math.random() * colors.length)];
        }

        // È°ØÁ§∫ÈóúÂç°ÈÅ∏Êìá
        function showLevelSelection() {
            gameState.currentLevel = 1;
            
            document.getElementById('levelSelection').style.display = 'flex';
            document.querySelector('.game-content').style.display = 'none';
            document.getElementById('magicBackBtn').style.display = 'none';
            document.getElementById('finalVictoryCelebration').style.display = 'none';
            document.getElementById('victoryCelebration').style.display = 'none';
            
            updateLevelDisplay();
            
            document.querySelectorAll('.level-btn').forEach((btn, index) => {
                const levelNum = index + 1;
                const level = gameState.levels[levelNum];
                
                if (levelNum === 1 || gameState.levels[levelNum - 1].completed) {
                    btn.disabled = false;
                    btn.style.opacity = '1';
                } else {
                    btn.disabled = true;
                    btn.style.opacity = '0.5';
                }
                
                if (level.completed) {
                    btn.style.borderColor = '#FFD700';
                    btn.style.boxShadow = '0 0 15px rgba(255, 215, 0, 0.5)';
                    const rewardText = btn.querySelector('.level-reward span');
                    rewardText.textContent = 'Â∑≤ÂÆåÊàêÔºÅ';
                    rewardText.style.color = '#FFD700';
                }
            });
            
            // Ê™¢Êü•ÊòØÂê¶ÊâÄÊúâÈóúÂç°ÈÉΩÂ∑≤ÂÆåÊàê
            const allCompleted = Object.values(gameState.levels).every(level => level.completed);
            if (allCompleted) {
                showFinalVictory();
            }
        }

        // ÈñãÂßãÈóúÂç°
        function startLevel(levelNum) {
            if (!gameState.player.registered) {
                showMobileAlert('Ë´ãÂÖàË®ªÂÜäÁé©ÂÆ∂ÔºÅ');
                showPlayerRegister();
                return;
            }
            
            gameState.currentLevel = levelNum;
            const level = gameState.levels[levelNum];
            
            document.getElementById('levelSelection').style.display = 'none';
            document.querySelector('.game-content').style.display = 'block';
            document.getElementById('magicBackBtn').style.display = 'flex';
            
            document.getElementById('waterGameArea').style.display = 'none';
            document.getElementById('quizGameArea').style.display = 'none';
            document.getElementById('ecoGameArea').style.display = 'none';
            
            if (level.type === 'water') {
                startWaterLevel(levelNum);
            } else if (level.type === 'quiz') {
                startQuizLevel(levelNum);
            } else if (level.type === 'eco') {
                startEcoLevel(levelNum);
            }
            
            updateLevelDisplay();
            createMagicParticles();
        }

        // ÈñãÂßãÊé•Ê∞¥ÈóúÂç°
        function startWaterLevel(levelNum) {
            const level = gameState.levels[levelNum];
            
            document.getElementById('waterGameArea').style.display = 'block';
            
            document.getElementById('waterMissionDesc').textContent = 
                `Âú®${level.timeLimit}ÁßíÂÖßÊé•Âà∞ÂâõÂ•Ω250mlÁöÑÊ∞¥ÔºÅ`;
            
            const requirements = document.getElementById('waterRequirements');
            requirements.innerHTML = '';
            
            level.requirements.forEach(req => {
                const reqElement = document.createElement('div');
                reqElement.className = 'requirement';
                reqElement.innerHTML = `<i class="fas fa-circle" style="font-size: 0.7rem;"></i> ${req.text}`;
                requirements.appendChild(reqElement);
            });
            
            resetWaterGame(level);
            document.getElementById('waterTimer').textContent = `${level.timeLimit}.0 Áßí`;
            document.getElementById('waterBestScore').textContent = `${level.bestScore} ÂàÜ`;
        }

        // ÈáçÁΩÆÊé•Ê∞¥ÈÅäÊà≤
        function resetWaterGame(level) {
            const waterGame = gameState.waterGame;
            
            clearInterval(waterGame.timerInterval);
            clearInterval(waterGame.waterInterval);
            
            waterGame.isRunning = false;
            waterGame.timer = level.timeLimit;
            waterGame.waterLevel = 0;
            waterGame.currentAttempt = 0;
            waterGame.levelScore = 0;
            waterGame.accuracy = 0;
            
            document.getElementById('waterLevelComplex').style.height = '0%';
            document.getElementById('waterStream').style.height = '0';
            document.getElementById('currentWater').textContent = '0 ml';
            document.getElementById('waterStartBtn').disabled = false;
            document.getElementById('waterStopBtn').disabled = true;
            document.getElementById('waterFeedback').style.display = 'none';
        }

        // ÈñãÂßãÊé•Ê∞¥ÊåëÊà∞
        function startWaterChallenge() {
            const level = gameState.levels[gameState.currentLevel];
            const waterGame = gameState.waterGame;
            
            if (waterGame.currentAttempt >= level.attempts) {
                showWaterFeedback(`‚ùå ÊåëÊà∞Ê¨°Êï∏Áî®Áõ°ÔºÅÊúÄÈ´òÂæóÂàÜÔºö${waterGame.levelScore}ÂàÜ`, 'error');
                return;
            }
            
            waterGame.currentAttempt++;
            waterGame.isRunning = true;
            waterGame.timer = level.timeLimit;
            waterGame.waterLevel = 0;
            
            document.getElementById('waterStartBtn').disabled = true;
            document.getElementById('waterStopBtn').disabled = false;
            document.getElementById('waterLevelComplex').style.height = '0%';
            document.getElementById('waterStream').style.height = '100px';
            document.getElementById('waterFeedback').style.display = 'none';
            
            waterGame.timerInterval = setInterval(() => {
                waterGame.timer -= 0.1;
                document.getElementById('waterTimer').textContent = waterGame.timer.toFixed(1) + ' Áßí';
                
                if (waterGame.timer <= 0) {
                    stopWaterChallenge();
                }
            }, 100);
            
            waterGame.waterInterval = setInterval(() => {
                if (waterGame.isRunning) {
                    let waterSpeed = 2;
                    if (gameState.currentLevel === 3) waterSpeed = 3.5;
                    
                    const stability = gameState.abilities.waterSkill / 100;
                    const increase = waterSpeed * (0.8 + Math.random() * 0.4 * stability);
                    
                    waterGame.waterLevel += increase;
                    
                    const waterPercentage = Math.min(waterGame.waterLevel / 300 * 100, 100);
                    document.getElementById('waterLevelComplex').style.height = waterPercentage + '%';
                    document.getElementById('currentWater').textContent = `${waterGame.waterLevel.toFixed(1)} ml`;
                    
                    const error = Math.abs(waterGame.waterLevel - 250);
                    
                    if (waterGame.waterLevel < 150) {
                        showWaterFeedback("üíß Ê∞¥ÈÇÑ‰∏çÂ§†ÔºåÁπºÁ∫åÂä†Ê≤πÔºÅ", 'warning');
                    } else if (error <= 10) {
                        showWaterFeedback("üéØ ÂÆåÁæéÔºÅÊ∫ñÂÇôÂÅúÊ≠¢ÔºÅ", 'success');
                    } else if (waterGame.waterLevel > 280) {
                        showWaterFeedback("üí¶ Â§™Â§ö‰∫ÜÔºÅË∂ïÂø´ÂÅúÊ≠¢ÔºÅ", 'error');
                    }
                    
                    if (waterGame.waterLevel > 300) {
                        showWaterFeedback("‚ùå Âö¥ÈáçÊµ™Ë≤ªÔºÅÊåëÊà∞Â§±ÊïóÔºÅ", 'error');
                        setTimeout(stopWaterChallenge, 300);
                    }
                }
            }, 200);
            
            showWaterFeedback(`Á¨¨ ${waterGame.currentAttempt} Ê¨°ÊåëÊà∞ÈñãÂßãÔºÅ`, 'warning');
        }

        // ÂÅúÊ≠¢Êé•Ê∞¥ÊåëÊà∞
        function stopWaterChallenge() {
            const waterGame = gameState.waterGame;
            
            if (!waterGame.isRunning) return;
            
            waterGame.isRunning = false;
            clearInterval(waterGame.timerInterval);
            clearInterval(waterGame.waterInterval);
            
            document.getElementById('waterStartBtn').disabled = false;
            document.getElementById('waterStopBtn').disabled = true;
            document.getElementById('waterStream').style.height = '0';
            
            const level = gameState.levels[gameState.currentLevel];
            const error = Math.abs(waterGame.waterLevel - 250);
            let score = 0;
            let feedback = '';
            let feedbackType = '';
            
            if (error <= 10) {
                score = 100 - error * 3;
                feedback = `üéØ ÂÆåÁæéÔºÅÂè™Â∑Æ ${error.toFixed(1)}mlÔºÅ`;
                feedbackType = 'success';
            } else if (error <= 30) {
                score = 80 - error * 2;
                feedback = `üëç ‰∏çÈåØÔºÅÂ∑Æ ${error.toFixed(1)}ml`;
                feedbackType = 'success';
            } else if (error <= 50) {
                score = 60 - error;
                feedback = `üíß ÈÇÑÂèØ‰ª•Êõ¥Â•ΩÔºåÂ∑Æ ${error.toFixed(1)}ml`;
                feedbackType = 'warning';
            } else {
                score = Math.max(10, 50 - error / 2);
                feedback = `üí¶ Â∑Æ ${error.toFixed(1)}mlÔºåÂÜçÊé•ÂÜçÂé≤ÔºÅ`;
                feedbackType = 'error';
            }
            
            const timeBonus = Math.max(0, waterGame.timer * 2);
            score += timeBonus;
            
            const abilityBonus = score * (gameState.abilities.waterSkill / 100);
            score += abilityBonus;
            
            score = Math.min(Math.round(score), 100);
            
            if (score > waterGame.levelScore) {
                waterGame.levelScore = score;
                waterGame.accuracy = error;
            }
            
            showWaterFeedback(`${feedback}<br>ÂæóÂàÜÔºö${score}ÂàÜÔºàÊú¨Ê¨°ÊåëÊà∞Ôºâ`, feedbackType);
            
            if (waterGame.levelScore >= level.targetScore) {
                completeWaterLevel();
            }
            
            updateWaterSkill(score);
        }

        // ÂÆåÊàêÊé•Ê∞¥ÈóúÂç°
        function completeWaterLevel() {
            const levelNum = gameState.currentLevel;
            const level = gameState.levels[levelNum];
            const waterGame = gameState.waterGame;
            
            level.completed = true;
            level.bestScore = Math.max(level.bestScore, waterGame.levelScore);
            
            const reward = calculateReward(levelNum, waterGame.levelScore);
            gameState.abilities.waterDrops += reward;
            
            showFireworksAndScore(waterGame.levelScore);
            addScoreToLeaderboard(waterGame.levelScore, level.name);
            
            setTimeout(() => {
                showVictory(
                    level.name,
                    `ÊÅ≠ÂñúÂÆåÊàê${level.name}ÔºÅ<br>ÊúÄÁµÇÂæóÂàÜÔºö${waterGame.levelScore}ÂàÜ<br>Ë™§Â∑ÆÔºö${waterGame.accuracy.toFixed(1)}ml`,
                    reward
                );
            }, 2000);
            
            updatePlayerInfoDisplay();
        }

        // ÈáçÂïüÊé•Ê∞¥ÊåëÊà∞
        function restartWaterChallenge() {
            const level = gameState.levels[gameState.currentLevel];
            resetWaterGame(level);
        }

        // È°ØÁ§∫Êé•Ê∞¥ÈÅäÊà≤ÂèçÈ•ã
        function showWaterFeedback(text, type) {
            const feedback = document.getElementById('waterFeedback');
            feedback.innerHTML = text;
            feedback.className = `water-feedback feedback-${type}`;
            feedback.style.display = 'block';
        }

        // ÈñãÂßãÁü•Ë≠òÈóúÂç°
        function startQuizLevel(levelNum) {
            const level = gameState.levels[levelNum];
            
            document.getElementById('quizGameArea').style.display = 'block';
            
            gameState.quizGame.currentQuestion = 0;
            gameState.quizGame.score = 0;
            gameState.quizGame.answered = false;
            
            document.getElementById('quizMissionDesc').textContent = 
                `ÂõûÁ≠î${level.questions}È°åÁí∞‰øùÁü•Ë≠òÂïèÈ°åÔºåÁõÆÊ®ôÂàÜÊï∏Ôºö${level.targetScore}ÂàÜÔºÅ`;
            
            const requirements = document.getElementById('quizRequirements');
            requirements.innerHTML = '';
            
            level.requirements.forEach(req => {
                const reqElement = document.createElement('div');
                reqElement.className = 'requirement';
                reqElement.innerHTML = `<i class="fas fa-circle" style="font-size: 0.7rem;"></i> ${req.text}`;
                requirements.appendChild(reqElement);
            });
            
            loadQuizQuestion();
        }

        // ËºâÂÖ•Áü•Ë≠òÂïèÈ°å
        function loadQuizQuestion() {
            const quiz = gameState.quizGame;
            const level = gameState.levels[gameState.currentLevel];
            const question = quiz.questions[quiz.currentQuestion];
            
            document.getElementById('currentQuestionNum').textContent = quiz.currentQuestion + 1;
            document.getElementById('totalQuestions').textContent = level.questions || 4;
            const progress = ((quiz.currentQuestion) / (level.questions || 4)) * 100;
            document.getElementById('quizProgressFill').style.width = `${progress}%`;
            
            document.getElementById('quizScore').textContent = quiz.score;
            document.getElementById('quizQuestionText').textContent = question.question;
            
            const optionsGrid = document.getElementById('quizOptionsGrid');
            optionsGrid.innerHTML = '';
            
            question.options.forEach((option, index) => {
                const optionBtn = document.createElement('div');
                optionBtn.className = 'quiz-option-btn';
                optionBtn.innerHTML = `
                    <div class="option-label">${String.fromCharCode(65 + index)}</div>
                    <div class="option-text">${option}</div>
                `;
                
                optionBtn.addEventListener('click', () => {
                    if (quiz.answered) return;
                    
                    quiz.answered = true;
                    
                    document.querySelectorAll('.quiz-option-btn').forEach(btn => {
                        btn.classList.remove('selected');
                    });
                    optionBtn.classList.add('selected');
                    
                    const isCorrect = index === question.correct;
                    
                    if (isCorrect) {
                        optionBtn.classList.add('correct');
                        quiz.score += question.points;
                        document.getElementById('quizScore').textContent = quiz.score;
                        updateKnowledgeSkill(question.points);
                    } else {
                        optionBtn.classList.add('incorrect');
                        document.querySelectorAll('.quiz-option-btn')[question.correct].classList.add('correct');
                    }
                    
                    document.getElementById('quizFeedbackText').textContent = question.explanation;
                    
                    const esgTags = document.getElementById('quizEsgTags');
                    esgTags.innerHTML = '';
                    
                    question.esg.forEach(tag => {
                        const tagElement = document.createElement('div');
                        tagElement.className = `quiz-esg-tag tag-${tag}`;
                        
                        let icon = '', text = '';
                        if (tag === 'environment') {
                            icon = 'fa-leaf';
                            text = 'ÊÑõÂú∞ÁêÉ';
                        } else if (tag === 'social') {
                            icon = 'fa-users';
                            text = 'Â•ΩÂ≠∏Áîü';
                        } else if (tag === 'governance') {
                            icon = 'fa-balance-scale';
                            text = 'ÂÆàË¶èÂâá';
                        }
                        
                        tagElement.innerHTML = `<i class="fas ${icon}"></i> ${text}`;
                        esgTags.appendChild(tagElement);
                    });
                    
                    document.getElementById('quizFeedbackCard').style.display = 'block';
                    
                    if (isCorrect) {
                        gameState.abilities.waterDrops += 2;
                    }
                });
                
                // Ëß∏Êë∏ÂõûÈ•ã
                optionBtn.addEventListener('touchstart', function() {
                    if (!quiz.answered) {
                        this.style.opacity = '0.8';
                    }
                });
                
                optionBtn.addEventListener('touchend', function() {
                    this.style.opacity = '1';
                });
                
                optionsGrid.appendChild(optionBtn);
            });
            
            document.getElementById('quizFeedbackCard').style.display = 'none';
            
            const nextBtn = document.getElementById('quizNextBtn');
            if (quiz.currentQuestion === (level.questions || 4) - 1) {
                nextBtn.innerHTML = 'ÂÆåÊàêÊåëÊà∞ <i class="fas fa-check"></i>';
            } else {
                nextBtn.innerHTML = '‰∏ã‰∏ÄÈ°å <i class="fas fa-arrow-right"></i>';
            }
        }

        // ‰∏ã‰∏ÄÈ°åÁü•Ë≠òÂïèÈ°å
        function nextQuizQuestion() {
            const quiz = gameState.quizGame;
            const level = gameState.levels[gameState.currentLevel];
            
            if (!quiz.answered && quiz.currentQuestion < (level.questions || 4) - 1) {
                showQuizFeedback("Ë´ãÂÖàÂõûÁ≠îÈÄô‰∏ÄÈ°åÔºÅ", 'warning');
                return;
            }
            
            quiz.answered = false;
            
            if (quiz.currentQuestion < (level.questions || 4) - 1) {
                quiz.currentQuestion++;
                loadQuizQuestion();
            } else {
                completeQuizLevel();
            }
        }

        // ÂÆåÊàêÁü•Ë≠òÈóúÂç°
        function completeQuizLevel() {
            const levelNum = gameState.currentLevel;
            const level = gameState.levels[levelNum];
            const quiz = gameState.quizGame;
            
            const finalScore = quiz.score;
            level.bestScore = Math.max(level.bestScore, finalScore);
            
            if (finalScore >= level.targetScore) {
                level.completed = true;
                
                const reward = calculateReward(levelNum, finalScore);
                gameState.abilities.waterDrops += reward;
                
                showFireworksAndScore(finalScore);
                addScoreToLeaderboard(finalScore, level.name);
                
                setTimeout(() => {
                    showVictory(
                        level.name,
                        `ÊÅ≠ÂñúÂÆåÊàê${level.name}ÔºÅ<br>ÊúÄÁµÇÂæóÂàÜÔºö${finalScore}ÂàÜ<br>Á≠îÂ∞ç ${quiz.score / 25} È°å`,
                        reward
                    );
                }, 2000);
                
                updatePlayerInfoDisplay();
            } else {
                showQuizFeedback(`ÊåëÊà∞Â§±ÊïóÔºÅÂæóÂàÜÔºö${finalScore}ÂàÜÔºåÈúÄË¶Å ${level.targetScore}ÂàÜÊâçËÉΩÈÅéÈóú„ÄÇ`, 'error');
                setTimeout(() => {
                    startQuizLevel(levelNum);
                }, 2000);
            }
        }

        // È°ØÁ§∫Áü•Ë≠òÈÅäÊà≤ÂèçÈ•ã
        function showQuizFeedback(text, type) {
            const feedback = document.getElementById('quizFeedbackText');
            feedback.textContent = text;
            document.getElementById('quizFeedbackCard').style.display = 'block';
        }

        // ÈñãÂßãÁí∞‰øùÈóúÂç°
        function startEcoLevel(levelNum) {
            const level = gameState.levels[levelNum];
            
            document.getElementById('ecoGameArea').style.display = 'block';
            
            document.getElementById('ecoMissionDesc').textContent = 
                `Âú®${level.timeLimit}ÁßíÂÖßÂ∞áÂûÉÂúæÊ≠£Á¢∫ÂàÜÈ°ûÔºÅ`;
            
            const requirements = document.getElementById('ecoRequirements');
            requirements.innerHTML = '';
            
            level.requirements.forEach(req => {
                const reqElement = document.createElement('div');
                reqElement.className = 'requirement';
                reqElement.innerHTML = `<i class="fas fa-circle" style="font-size: 0.7rem;"></i> ${req.text}`;
                requirements.appendChild(reqElement);
            });
            
            resetEcoGame(level);
            document.getElementById('ecoTimer').textContent = `${level.timeLimit} Áßí`;
            document.getElementById('ecoTargetScore').textContent = level.targetScore;
        }

        // ÈáçÁΩÆÁí∞‰øùÈÅäÊà≤
        function resetEcoGame(level) {
            const ecoGame = gameState.ecoGame;
            
            clearInterval(ecoGame.timerInterval);
            
            ecoGame.isRunning = false;
            ecoGame.timer = level.timeLimit;
            ecoGame.correctCount = 0;
            ecoGame.wrongCount = 0;
            ecoGame.currentScore = 0;
            ecoGame.remainingItems = [...ecoGame.items];
            
            document.getElementById('ecoCorrectCount').textContent = '0';
            document.getElementById('ecoWrongCount').textContent = '0';
            document.getElementById('ecoCurrentScore').textContent = '0';
            document.getElementById('trashLevel').style.height = '0%';
            
            updateEcoItems();
            document.getElementById('ecoStartBtn').disabled = false;
        }

        // Êõ¥Êñ∞Áí∞‰øùÁâ©ÂìÅ - ÊâãÊ©üËß∏Êë∏ÂÑ™Âåñ
        function updateEcoItems() {
            const container = document.getElementById('trashItemsContainer');
            container.innerHTML = '';
            
            gameState.ecoGame.remainingItems.forEach(item => {
                const itemElement = document.createElement('div');
                itemElement.className = `trash-item ${item.type}`;
                itemElement.setAttribute('data-id', item.id);
                itemElement.setAttribute('data-type', item.type);
                itemElement.innerHTML = `<div>${item.icon}</div>`;
                
                // Ëß∏Êë∏‰∫ã‰ª∂‰ª£ÊõøÊãñÊõ≥
                itemElement.addEventListener('touchstart', handleTouchStart);
                itemElement.addEventListener('touchend', handleTouchEnd);
                
                container.appendChild(itemElement);
            });
            
            // Ë®≠ÁΩÆÂûÉÂúæÊ°∂Ëß∏Êë∏‰∫ã‰ª∂
            const trashCan = document.getElementById('trashCan');
            trashCan.addEventListener('touchend', handleTrashCanTouch);
        }

        let selectedItem = null;

        function handleTouchStart(e) {
            if (!gameState.ecoGame.isRunning) return;
            
            e.preventDefault();
            const itemId = e.target.closest('.trash-item').getAttribute('data-id');
            const itemType = e.target.closest('.trash-item').getAttribute('data-type');
            
            selectedItem = {
                id: itemId,
                type: itemType,
                element: e.target.closest('.trash-item')
            };
            
            selectedItem.element.classList.add('dragging');
            selectedItem.element.style.transform = 'scale(1.1)';
        }

        function handleTouchEnd(e) {
            if (!selectedItem) return;
            
            e.preventDefault();
            selectedItem.element.classList.remove('dragging');
            selectedItem.element.style.transform = 'scale(1)';
            selectedItem = null;
        }

        function handleTrashCanTouch(e) {
            if (!selectedItem || !gameState.ecoGame.isRunning) return;
            
            e.preventDefault();
            
            // Èö®Ê©üÊ±∫ÂÆöÊòØÂê¶Ê≠£Á¢∫ÂàÜÈ°ûÔºàÊ®°Êì¨ÈÅäÊà≤Ôºâ
            const isCorrect = Math.random() > 0.3; // 70% Ê≠£Á¢∫Áéá
            
            if (isCorrect) {
                gameState.ecoGame.correctCount++;
                gameState.ecoGame.currentScore += 10;
                showEcoFeedback('‚úÖ Ê≠£Á¢∫ÂàÜÈ°ûÔºÅ', 'success');
            } else {
                gameState.ecoGame.wrongCount++;
                gameState.ecoGame.currentScore = Math.max(0, gameState.ecoGame.currentScore - 5);
                showEcoFeedback('‚ùå ÂàÜÈ°ûÈåØË™§ÔºÅ', 'error');
            }
            
            // ÁßªÈô§Áâ©ÂìÅ
            const itemIndex = gameState.ecoGame.remainingItems.findIndex(item => item.id == selectedItem.id);
            if (itemIndex > -1) {
                gameState.ecoGame.remainingItems.splice(itemIndex, 1);
            }
            
            // Êõ¥Êñ∞È°ØÁ§∫
            updateEcoDisplay();
            
            // Ê™¢Êü•ÊòØÂê¶ÊâÄÊúâÁâ©ÂìÅÈÉΩÂ∑≤ÂàÜÈ°û
            if (gameState.ecoGame.remainingItems.length === 0) {
                completeEcoChallenge();
            }
            
            selectedItem = null;
        }

        // Êõ¥Êñ∞Áí∞‰øùÈÅäÊà≤È°ØÁ§∫
        function updateEcoDisplay() {
            const ecoGame = gameState.ecoGame;
            
            document.getElementById('ecoCorrectCount').textContent = ecoGame.correctCount;
            document.getElementById('ecoWrongCount').textContent = ecoGame.wrongCount;
            document.getElementById('ecoCurrentScore').textContent = ecoGame.currentScore;
            
            const trashLevel = document.getElementById('trashLevel');
            const progress = ((gameState.ecoGame.items.length - gameState.ecoGame.remainingItems.length) / gameState.ecoGame.items.length) * 100;
            trashLevel.style.height = `${progress}%`;
            
            updateEcoItems();
        }

        // È°ØÁ§∫Áí∞‰øùÈÅäÊà≤ÂèçÈ•ã
        function showEcoFeedback(text, type) {
            const feedback = document.createElement('div');
            feedback.textContent = text;
            feedback.style.position = 'fixed';
            feedback.style.top = '50%';
            feedback.style.left = '50%';
            feedback.style.transform = 'translate(-50%, -50%)';
            feedback.style.fontSize = '1.5rem';
            feedback.style.fontWeight = 'bold';
            feedback.style.color = type === 'success' ? '#4CAF50' : '#F44336';
            feedback.style.textShadow = '1px 1px 0 rgba(0,0,0,0.3)';
            feedback.style.zIndex = '1000';
            feedback.style.pointerEvents = 'none';
            feedback.style.backgroundColor = 'rgba(0,0,0,0.7)';
            feedback.style.padding = '15px';
            feedback.style.borderRadius = '10px';
            
            document.body.appendChild(feedback);
            
            setTimeout(() => {
                feedback.remove();
            }, 1000);
        }

        // ÈñãÂßãÁí∞‰øùÊåëÊà∞
        function startEcoChallenge() {
            const ecoGame = gameState.ecoGame;
            const level = gameState.levels[gameState.currentLevel];
            
            if (ecoGame.isRunning) return;
            
            ecoGame.isRunning = true;
            ecoGame.timer = level.timeLimit;
            
            document.getElementById('ecoStartBtn').disabled = true;
            
            ecoGame.timerInterval = setInterval(() => {
                ecoGame.timer--;
                document.getElementById('ecoTimer').textContent = ecoGame.timer + ' Áßí';
                
                if (ecoGame.timer <= 0) {
                    completeEcoChallenge();
                }
            }, 1000);
        }

        // ÂÆåÊàêÁí∞‰øùÊåëÊà∞
        function completeEcoChallenge() {
            const ecoGame = gameState.ecoGame;
            const level = gameState.levels[gameState.currentLevel];
            
            clearInterval(ecoGame.timerInterval);
            ecoGame.isRunning = false;
            
            const timeBonus = Math.max(0, ecoGame.timer * 2);
            const accuracyBonus = ecoGame.correctCount * 15;
            const penalty = ecoGame.wrongCount * 10;
            
            ecoGame.currentScore += timeBonus + accuracyBonus - penalty;
            ecoGame.currentScore = Math.max(0, Math.min(ecoGame.currentScore, 100));
            
            level.bestScore = Math.max(level.bestScore, ecoGame.currentScore);
            
            if (ecoGame.currentScore >= level.targetScore) {
                level.completed = true;
                
                const reward = calculateReward(gameState.currentLevel, ecoGame.currentScore);
                gameState.abilities.waterDrops += reward;
                
                showFireworksAndScore(ecoGame.currentScore);
                addScoreToLeaderboard(ecoGame.currentScore, level.name);
                
                setTimeout(() => {
                    showVictory(
                        level.name,
                        `ÊÅ≠ÂñúÂÆåÊàê${level.name}ÔºÅ<br>ÊúÄÁµÇÂæóÂàÜÔºö${ecoGame.currentScore}ÂàÜ<br>Ê≠£Á¢∫Ôºö${ecoGame.correctCount}ÂÄãÔºåÈåØË™§Ôºö${ecoGame.wrongCount}ÂÄã`,
                        reward
                    );
                }, 2000);
                
                updatePlayerInfoDisplay();
                
                // Ê™¢Êü•ÊòØÂê¶ÊâÄÊúâÈóúÂç°ÈÉΩÂ∑≤ÂÆåÊàê
                const allCompleted = Object.values(gameState.levels).every(level => level.completed);
                if (allCompleted) {
                    setTimeout(() => {
                        showFinalVictory();
                    }, 3000);
                }
            } else {
                showEcoFeedback(`ÊåëÊà∞Â§±ÊïóÔºÅÂæóÂàÜÔºö${ecoGame.currentScore}ÂàÜÔºåÈúÄË¶Å ${level.targetScore}ÂàÜÊâçËÉΩÈÅéÈóú„ÄÇ`, 'error');
                setTimeout(() => {
                    restartEcoChallenge();
                }, 2000);
            }
        }

        // ÈáçÂïüÁí∞‰øùÊåëÊà∞
        function restartEcoChallenge() {
            const level = gameState.levels[gameState.currentLevel];
            resetEcoGame(level);
        }

        // È°ØÁ§∫ÊúÄÁµÇÂãùÂà©Áï´Èù¢
        function showFinalVictory() {
            const totalScore = Object.values(gameState.levels).reduce((sum, level) => sum + level.bestScore, 0);
            const totalRewards = Object.values(gameState.levels).reduce((sum, level) => {
                const reward = calculateReward(parseInt(Object.keys(gameState.levels).find(key => gameState.levels[key] === level)), level.bestScore);
                return sum + reward;
            }, 0);
            
            const statsHTML = `
                <div class="final-stat-item">
                    <div class="final-stat-icon">üèÜ</div>
                    <div class="final-stat-value">${totalScore}</div>
                    <div class="final-stat-label">Á∏ΩÂàÜ</div>
                </div>
                <div class="final-stat-item">
                    <div class="final-stat-icon">üíß</div>
                    <div class="final-stat-value">${gameState.abilities.waterDrops}</div>
                    <div class="final-stat-label">Ê∞¥Êª¥Á∏ΩÊï∏</div>
                </div>
                <div class="final-stat-item">
                    <div class="final-stat-icon">‚≠ê</div>
                    <div class="final-stat-value">4/4</div>
                    <div class="final-stat-label">ÈóúÂç°ÂÆåÊàê</div>
                </div>
                <div class="final-stat-item">
                    <div class="final-stat-icon">üëë</div>
                    <div class="final-stat-value">${gameState.leaderboard[0]?.name === gameState.player.name ? '1' : 'Ââç10'}</div>
                    <div class="final-stat-label">ÊéíË°åÊ¶ú</div>
                </div>
            `;
            
            document.getElementById('finalVictoryStats').innerHTML = statsHTML;
            document.getElementById('finalVictoryCelebration').style.display = 'flex';
            
            // ÂâµÂª∫ÁõõÂ§ßÁÖôÁÅ´
            createFinalFireworks();
        }

        // ÂâµÂª∫ÊúÄÁµÇÁÖôÁÅ´
        function createFinalFireworks() {
            const container = document.getElementById('fireworksContainer');
            container.style.display = 'block';
            container.innerHTML = '';
            
            const colors = ['#FFD700', '#36D1DC', '#FF6B6B', '#4CAF50', '#FF9800', '#9C27B0'];
            
            // ÂâµÂª∫Â§öËº™ÁÖôÁÅ´
            for (let round = 0; round < 2; round++) {
                setTimeout(() => {
                    for (let i = 0; i < 5; i++) {
                        setTimeout(() => {
                            createSingleFirework(
                                Math.random() * window.innerWidth,
                                window.innerHeight,
                                colors[Math.floor(Math.random() * colors.length)]
                            );
                        }, i * 150);
                    }
                }, round * 1500);
            }
            
            setTimeout(() => {
                container.style.display = 'none';
            }, 5000);
        }

        // ÂàÜ‰∫´ÊàêÂ∞±
        function shareAchievement() {
            const shareText = `ÊàëÂú®‰ªôÊ¥ûÂ∞èÂ§©ÊâçÈÅäÊà≤‰∏≠ÂÆåÊàê‰∫ÜÊâÄÊúâÁí∞‰øùÊåëÊà∞ÔºåÁç≤Âæó‰∫Ü${gameState.abilities.waterDrops}Ê∞¥Êª¥ÔºÅ‰∏ÄËµ∑‰æÜ‰øùË≠∑Âú∞ÁêÉÂêßÔºÅ`;
            
            if (navigator.share) {
                navigator.share({
                    title: '‰ªôÊ¥ûÂ∞èÂ§©Êâç - Áí∞‰øùÂ§ßÂ∏´ÊàêÂ∞±',
                    text: shareText,
                    url: window.location.href
                });
            } else {
                navigator.clipboard.writeText(shareText).then(() => {
                    showMobileAlert('ÊàêÂ∞±Â∑≤Ë§áË£ΩÂà∞Ââ™Ë≤ºÁ∞øÔºÅ');
                });
            }
        }

        // ÈáçÊñ∞ÈñãÂßãÈÅäÊà≤
        function restartGame() {
            Object.keys(gameState.levels).forEach(key => {
                gameState.levels[key].completed = false;
                gameState.levels[key].bestScore = 0;
            });
            
            gameState.abilities.waterDrops = 100;
            gameState.abilities.waterSkill = 50;
            gameState.abilities.knowledgeSkill = 25;
            gameState.abilities.ecoSkill = 30;
            gameState.abilities.speedSkill = 40;
            
            updateAbilitiesDisplay();
            updatePlayerInfoDisplay();
            
            document.getElementById('finalVictoryCelebration').style.display = 'none';
            showLevelSelection();
        }

        // Ë®àÁÆóÁçéÂãµ
        function calculateReward(levelNum, score) {
            const level = gameState.levels[levelNum];
            const min = level.reward.min;
            const max = level.reward.max;
            
            const multiplier = score / 100;
            let reward = min + (max - min) * multiplier;
            
            const abilityBonus = reward * (gameState.abilities.ecoSkill / 200);
            reward += abilityBonus;
            
            return Math.round(reward);
        }

        // È°ØÁ§∫ÂãùÂà©ÂãïÁï´
        function showVictory(title, message, reward) {
            const victory = gameState.levels[gameState.currentLevel].completed ? 'üèÜ' : '‚ú®';
            
            document.getElementById('victoryIcon').textContent = victory;
            document.getElementById('victoryTitle').textContent = title;
            document.getElementById('victoryMessage').innerHTML = message;
            
            const rewardsDiv = document.getElementById('victoryRewards');
            rewardsDiv.innerHTML = `
                <div class="victory-reward">
                    <div class="reward-icon">üíß</div>
                    <div class="reward-text">+${reward} Ê∞¥Êª¥</div>
                </div>
                <div class="victory-reward">
                    <div class="reward-icon">üåü</div>
                    <div class="reward-text">ËÉΩÂäõÊèêÂçáÔºÅ</div>
                </div>
            `;
            
            document.getElementById('victoryCelebration').style.display = 'flex';
            updateAbilitiesDisplay();
        }

        // È°ØÁ§∫ÁÖôÁÅ´ÂíåÂàÜÊï∏
        function showFireworksAndScore(score) {
            const scoreDisplay = document.getElementById('scoreDisplay');
            scoreDisplay.textContent = score;
            scoreDisplay.style.display = 'block';
            
            createFireworks();
            
            setTimeout(() => {
                scoreDisplay.style.display = 'none';
            }, 2000);
        }

        // ÂâµÂª∫ÁÖôÁÅ´ÂãïÁï´
        function createFireworks() {
            const container = document.getElementById('fireworksContainer');
            container.style.display = 'block';
            container.innerHTML = '';
            
            const colors = ['#FFD700', '#36D1DC', '#FF6B6B', '#4CAF50', '#FF9800', '#9C27B0'];
            
            for (let i = 0; i < 2; i++) {
                setTimeout(() => {
                    createSingleFirework(
                        Math.random() * window.innerWidth,
                        window.innerHeight,
                        colors[Math.floor(Math.random() * colors.length)]
                    );
                }, i * 300);
            }
            
            setTimeout(() => {
                container.style.display = 'none';
            }, 2000);
        }

        // ÂâµÂª∫ÂñÆÂÄãÁÖôÁÅ´
        function createSingleFirework(x, y, color) {
            const container = document.getElementById('fireworksContainer');
            
            const firework = document.createElement('div');
            firework.className = 'firework';
            firework.style.left = `${x}px`;
            firework.style.top = `${y}px`;
            firework.style.backgroundColor = color;
            container.appendChild(firework);
            
            setTimeout(() => {
                const particleCount = 15 + Math.floor(Math.random() * 10);
                for (let i = 0; i < particleCount; i++) {
                    const particle = document.createElement('div');
                    particle.className = 'firework-particle';
                    particle.style.left = `${x}px`;
                    particle.style.top = `${y - 30}px`;
                    particle.style.backgroundColor = color;
                    
                    const angle = Math.random() * Math.PI * 2;
                    const distance = 30 + Math.random() * 40;
                    const tx = Math.cos(angle) * distance;
                    const ty = Math.sin(angle) * distance;
                    
                    particle.style.setProperty('--tx', `${tx}px`);
                    particle.style.setProperty('--ty', `${ty}px`);
                    
                    container.appendChild(particle);
                }
            }, 300);
        }

        // Êõ¥Êñ∞ÊéíË°åÊ¶úÈ°ØÁ§∫
        function updateLeaderboardDisplay() {
            if (gameState.leaderboard.length > 0) {
                const topPlayer = gameState.leaderboard[0];
                document.getElementById('topPlayerName').textContent = topPlayer.name;
                document.getElementById('topPlayerScore').textContent = topPlayer.score;
            }
            
            updateLeaderboardTable();
        }

        // Êõ¥Êñ∞ÊéíË°åÊ¶úË°®Ê†º
        function updateLeaderboardTable() {
            const tbody = document.getElementById('leaderboardTableBody');
            tbody.innerHTML = '';
            
            gameState.leaderboard.slice(0, 10).forEach((player, index) => {
                const row = document.createElement('tr');
                row.className = `rank-${index + 1}`;
                
                row.innerHTML = `
                    <td>
                        <div class="rank-cell">${index + 1}</div>
                    </td>
                    <td>
                        <div style="display: flex; align-items: center; gap: 8px;">
                            <div style="font-size: 1.5rem;">${player.avatar}</div>
                            <div>${player.name}</div>
                        </div>
                    </td>
                    <td style="color: #FFD700; font-weight: bold;">${player.score}</td>
                `;
                
                tbody.appendChild(row);
            });
        }

        // Ê∑ªÂä†ÂàÜÊï∏Âà∞ÊéíË°åÊ¶ú
        function addScoreToLeaderboard(score, levelName) {
            if (!gameState.player.registered) return;
            
            const now = new Date();
            const timeString = now.toLocaleTimeString('zh-TW', { 
                hour: '2-digit', 
                minute: '2-digit' 
            });
            
            const entry = {
                name: gameState.player.name,
                avatar: gameState.player.avatar,
                score: score,
                level: levelName,
                time: timeString,
                timestamp: now.getTime()
            };
            
            gameState.leaderboard.push(entry);
            
            gameState.leaderboard.sort((a, b) => {
                if (b.score !== a.score) {
                    return b.score - a.score;
                }
                return a.timestamp - b.timestamp;
            });
            
            gameState.leaderboard = gameState.leaderboard.slice(0, 50);
            
            saveLeaderboard();
            updateLeaderboardDisplay();
            
            const rank = gameState.leaderboard.findIndex(p => 
                p.name === gameState.player.name && 
                p.score === score
            ) + 1;
            
            if (rank <= 3) {
                showRankCelebration(rank, score);
            }
        }

        // ‰øùÂ≠òÊéíË°åÊ¶ú
        function saveLeaderboard() {
            const today = new Date().toDateString();
            localStorage.setItem('waterGeniusLeaderboard', JSON.stringify(gameState.leaderboard));
            localStorage.setItem('waterGeniusLeaderboardDate', today);
        }

        // È°ØÁ§∫ÊéíË°åÊ¶úÂΩàÁ™ó
        function showLeaderboardModal() {
            document.getElementById('leaderboardModal').style.display = 'flex';
            updateLeaderboardTable();
        }

        // Èö±ËóèÊéíË°åÊ¶úÂΩàÁ™ó
        function hideLeaderboardModal() {
            document.getElementById('leaderboardModal').style.display = 'none';
        }

        // ÊéíÂêçÊÖ∂Á•ùÂãïÁï´
        function showRankCelebration(rank, score) {
            const rankTitles = ['ü•á ÂÜ†ËªçÔºÅ', 'ü•à ‰∫ûËªçÔºÅ', 'ü•â Â≠£ËªçÔºÅ'];
            const rankColors = ['#FFD700', '#C0C0C0', '#CD7F32'];
            
            if (rank <= 3) {
                const celebration = document.getElementById('rankCelebration');
                celebration.textContent = `${rankTitles[rank - 1]}\n${score}ÂàÜ`;
                celebration.style.color = rankColors[rank - 1];
                celebration.style.textShadow = `0 0 15px ${rankColors[rank - 1]}`;
                celebration.style.display = 'block';
                
                setTimeout(() => {
                    celebration.style.display = 'none';
                }, 3000);
            }
        }

        // Êõ¥Êñ∞ËÉΩÂäõÂÄº
        function updateWaterSkill(score) {
            const improvement = score / 2000;
            gameState.abilities.waterSkill = Math.min(100, gameState.abilities.waterSkill + improvement * 100);
            updateAbilitiesDisplay();
        }

        function updateKnowledgeSkill(points) {
            const improvement = points / 100;
            gameState.abilities.knowledgeSkill = Math.min(100, gameState.abilities.knowledgeSkill + improvement * 100);
            gameState.abilities.ecoSkill = Math.min(100, gameState.abilities.ecoSkill + 5);
            updateAbilitiesDisplay();
        }

        // Êõ¥Êñ∞ËÉΩÂäõÂÄºÈ°ØÁ§∫
        function updateAbilitiesDisplay() {
            const abilities = gameState.abilities;
            
            document.getElementById('waterSkill').textContent = `${Math.round(abilities.waterSkill)}%`;
            document.getElementById('knowledgeSkill').textContent = `${Math.round(abilities.knowledgeSkill)}%`;
            document.getElementById('ecoSkill').textContent = `${Math.round(abilities.ecoSkill)}%`;
            document.getElementById('speedSkill').textContent = `${Math.round(abilities.speedSkill)}%`;
            
            document.getElementById('waterSkillBar').style.width = `${abilities.waterSkill}%`;
            document.getElementById('knowledgeSkillBar').style.width = `${abilities.knowledgeSkill}%`;
            document.getElementById('ecoSkillBar').style.width = `${abilities.ecoSkill}%`;
            document.getElementById('speedSkillBar').style.width = `${abilities.speedSkill}%`;
        }

        // Êõ¥Êñ∞ÈóúÂç°È°ØÁ§∫
        function updateLevelDisplay() {
            document.getElementById('currentLevel').textContent = gameState.currentLevel;
            
            const completedLevels = Object.values(gameState.levels).filter(level => level.completed).length;
            const progress = (completedLevels / 4) * 100;
            document.getElementById('levelProgressBar').style.width = `${progress}%`;
        }

        // ËøîÂõûÈóúÂç°ÈÅ∏Êìá
        function returnToLevelSelection() {
            document.getElementById('victoryCelebration').style.display = 'none';
            document.getElementById('finalVictoryCelebration').style.display = 'none';
            showLevelSelection();
        }

        // ÈÅäÊà≤ÂïüÂãï
        window.addEventListener('DOMContentLoaded', initGame);
        
        // Èò≤Ê≠¢ÊâãÊ©üÁ∏ÆÊîæ
        document.addEventListener('touchstart', function(event) {
            if (event.touches.length > 1) {
                event.preventDefault();
            }
        }, { passive: false });

        let lastTouchEnd = 0;
        document.addEventListener('touchend', function(event) {
            const now = Date.now();
            if (now - lastTouchEnd <= 300) {
                event.preventDefault();
            }
            lastTouchEnd = now;
        }, false);

        // Èò≤Ê≠¢ÈõôÊìäÁ∏ÆÊîæ
        document.addEventListener('dblclick', function(event) {
            event.preventDefault();
        }, { passive: false });
    </script>
</body>
</html>