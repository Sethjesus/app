<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>仙洞國小環保小衛士 - 能源監控版</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Arial Rounded MT Bold', 'Arial', sans-serif;
        }
        
        body {
            background-color: #e9f7ef;
            color: #333;
            line-height: 1.6;
            padding: 10px;
            background-image: linear-gradient(to bottom, #e9f7ef, #d4f1e6);
            min-height: 100vh;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        header {
            text-align: center;
            padding: 20px;
            background: linear-gradient(135deg, #4CAF50, #2E7D32);
            color: white;
            border-radius: 15px;
            margin-bottom: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            position: relative;
            overflow: hidden;
        }
        
        header h1 {
            font-size: 2.8rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2);
        }
        
        header p {
            font-size: 1.2rem;
            max-width: 1000px;
            margin: 0 auto;
        }
        
        .logo {
            width: 100px;
            height: 100px;
            background-color: white;
            border-radius: 50%;
            margin: 0 auto 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3rem;
            color: #4CAF50;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        
        .timer {
            position: absolute;
            top: 20px;
            right: 20px;
            background-color: rgba(255, 255, 255, 0.2);
            padding: 10px 15px;
            border-radius: 10px;
            font-size: 1.5rem;
            font-weight: bold;
            backdrop-filter: blur(5px);
        }
        
        .tabs {
            display: flex;
            justify-content: center;
            margin: 20px 0;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .tab-button {
            padding: 12px 25px;
            background-color: #f1f8e9;
            border: none;
            border-radius: 50px;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
            color: #2E7D32;
        }
        
        .tab-button.active {
            background-color: #4CAF50;
            color: white;
        }
        
        .tab-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 10px rgba(0, 0, 0, 0.1);
        }
        
        .tab-content {
            display: none;
            animation: fadeIn 0.5s;
        }
        
        .tab-content.active {
            display: block;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .main-content {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .teaching-section, .game-section {
            flex: 1;
            min-width: 300px;
            background-color: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
        }
        
        .section-title {
            color: #2E7D32;
            border-bottom: 3px solid #FFEB3B;
            padding-bottom: 10px;
            margin-bottom: 20px;
            font-size: 1.8rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .section-title i {
            font-size: 1.8rem;
        }
        
        .knowledge-cards {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .knowledge-card {
            background: linear-gradient(135deg, #f9f9f9, #ffffff);
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            transition: transform 0.3s, box-shadow 0.3s;
            border-left: 5px solid;
            cursor: pointer;
            height: 100%;
        }
        
        .knowledge-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 7px 12px rgba(0, 0, 0, 0.1);
        }
        
        .knowledge-card.energy {
            border-left-color: #FF9800;
        }
        
        .knowledge-card.ozone {
            border-left-color: #9C27B0;
        }
        
        .knowledge-card.water {
            border-left-color: #2196F3;
        }
        
        .knowledge-card.animal {
            border-left-color: #795548;
        }
        
        .knowledge-card.esg {
            border-left-color: #4CAF50;
        }
        
        .knowledge-card.carbon {
            border-left-color: #8BC34A;
        }
        
        .knowledge-card.climate {
            border-left-color: #607D8B;
        }
        
        /* 新增知識卡片樣式 */
        .knowledge-card.meter {
            border-left-color: #2196F3;
        }
        
        .knowledge-card.gateway {
            border-left-color: #9C27B0;
        }
        
        .knowledge-card.ems {
            border-left-color: #FF5722;
        }
        
        .card-icon {
            font-size: 2.5rem;
            margin-bottom: 15px;
            text-align: center;
        }
        
        .knowledge-card h3 {
            font-size: 1.5rem;
            margin-bottom: 10px;
            color: #333;
            text-align: center;
        }
        
        .card-content {
            font-size: 1rem;
            color: #555;
            line-height: 1.5;
        }
        
        .card-tip {
            background-color: #FFF9C4;
            padding: 10px;
            border-radius: 5px;
            margin-top: 15px;
            font-size: 0.9rem;
            border-left: 3px solid #FFC107;
        }
        
        .game-area {
            background-color: #f8fdf9;
            border-radius: 10px;
            padding: 20px;
            min-height: 500px;
            border: 2px dashed #4CAF50;
        }
        
        .game-instruction {
            font-size: 1.2rem;
            margin-bottom: 20px;
            color: #555;
            text-align: center;
        }
        
        .game-modes {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .mode-button {
            padding: 10px 20px;
            background-color: #E8F5E9;
            border: 2px solid #4CAF50;
            border-radius: 10px;
            cursor: pointer;
            font-weight: bold;
            color: #2E7D32;
            transition: all 0.3s;
        }
        
        .mode-button.active {
            background-color: #4CAF50;
            color: white;
        }
        
        .game-container {
            min-height: 350px;
            position: relative;
        }
        
        /* 配對遊戲樣式 */
        .matching-game {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
        }
        
        .matching-row {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 30px;
            flex-wrap: wrap;
        }
        
        .matching-item {
            width: 140px;
            height: 140px;
            border-radius: 10px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: bold;
            text-align: center;
            padding: 15px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            position: relative;
        }
        
        .matching-item.left {
            background-color: #E3F2FD;
            border: 2px solid #2196F3;
            color: #1565C0;
        }
        
        .matching-item.right {
            background-color: #F1F8E9;
            border: 2px solid #8BC34A;
            color: #33691E;
        }
        
        .matching-item.selected {
            transform: scale(1.05);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
        }
        
        .matching-item.matched {
            opacity: 0.7;
            cursor: default;
        }
        
        .matching-arrow {
            font-size: 2rem;
            color: #FF5722;
        }
        
        /* 節電挑戰遊戲樣式 - 修正版 */
        .energy-challenge {
            text-align: center;
        }
        
        .house-container {
            width: 300px;
            height: 250px;
            margin: 20px auto;
            position: relative;
            background-color: #FFF3E0;
            border-radius: 10px;
            padding: 20px;
            border: 3px solid #FF9800;
        }
        
        .appliance {
            position: absolute;
            width: 60px;
            height: 60px;
            background-color: white;
            border-radius: 10px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 3px 5px rgba(0,0,0,0.2);
            font-size: 0.8rem;
            text-align: center;
        }
        
        .appliance.on {
            background-color: #FFECB3;
            border: 2px solid #FF9800;
        }
        
        .appliance.off {
            background-color: #F5F5F5;
            border: 2px solid #9E9E9E;
            color: #777;
        }
        
        .appliance-icon {
            font-size: 1.5rem;
            margin-bottom: 5px;
        }
        
        .energy-meter {
            width: 80%;
            height: 30px;
            background-color: #E0E0E0;
            border-radius: 15px;
            margin: 20px auto;
            overflow: hidden;
            position: relative;
        }
        
        .energy-level {
            height: 100%;
            width: 50%;
            background: linear-gradient(90deg, #4CAF50, #FF9800, #F44336);
            border-radius: 15px;
            transition: width 0.5s;
        }
        
        .meter-labels {
            display: flex;
            justify-content: space-between;
            width: 80%;
            margin: 0 auto;
            font-size: 0.9rem;
            font-weight: bold;
            color: #555;
        }
        
        .energy-details {
            display: flex;
            justify-content: space-around;
            margin-top: 15px;
            font-size: 0.9rem;
        }
        
        .energy-detail {
            background-color: #F5F5F5;
            padding: 8px 12px;
            border-radius: 8px;
            min-width: 120px;
        }
        
        .energy-detail .label {
            font-weight: bold;
            color: #666;
        }
        
        .energy-detail .value {
            font-size: 1.1rem;
            font-weight: bold;
            color: #2E7D32;
        }
        
        .energy-detail .value.high {
            color: #F44336;
        }
        
        /* 碳匯挑戰賽樣式 - 修正版 */
        .carbon-sink-game {
            text-align: center;
        }
        
        .carbon-meter {
            width: 80%;
            height: 30px;
            background-color: #E0E0E0;
            border-radius: 15px;
            margin: 20px auto;
            overflow: hidden;
            position: relative;
        }
        
        .carbon-level {
            height: 100%;
            width: 30%;
            background: linear-gradient(90deg, #F44336, #FF9800, #4CAF50);
            border-radius: 15px;
            transition: width 0.5s;
        }
        
        .carbon-sources, .carbon-sinks {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 20px;
            flex-wrap: wrap;
        }
        
        .carbon-source {
            padding: 10px 15px;
            background-color: #FFEBEE;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid #F44336;
            font-weight: bold;
            color: #C62828;
            min-width: 120px;
        }
        
        .carbon-sink {
            padding: 10px 15px;
            background-color: #E8F5E9;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid #4CAF50;
            font-weight: bold;
            color: #2E7D32;
            min-width: 120px;
        }
        
        .carbon-source:hover {
            background-color: #FFCDD2;
        }
        
        .carbon-sink:hover {
            background-color: #C8E6C9;
        }
        
        .earth-container {
            width: 200px;
            height: 200px;
            margin: 20px auto;
            position: relative;
            background-color: #BBDEFB;
            border-radius: 50%;
            overflow: hidden;
            border: 5px solid #64B5F6;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 5rem;
            color: #1E88E5;
        }
        
        .carbon-score {
            display: flex;
            justify-content: space-around;
            margin-top: 15px;
            font-size: 0.9rem;
        }
        
        .carbon-score-item {
            background-color: #F5F5F5;
            padding: 8px 12px;
            border-radius: 8px;
            min-width: 140px;
        }
        
        .carbon-score-item .label {
            font-weight: bold;
            color: #666;
        }
        
        .carbon-score-item .value {
            font-size: 1.1rem;
            font-weight: bold;
            color: #2E7D32;
        }
        
        .carbon-score-item .value.negative {
            color: #F44336;
        }
        
        .carbon-score-item .value.positive {
            color: #4CAF50;
        }
        
        /* 拯救北極熊遊戲樣式 */
        .polar-bear-game {
            text-align: center;
        }
        
        .iceberg {
            width: 300px;
            height: 150px;
            background-color: #B3E5FC;
            margin: 20px auto;
            border-radius: 20px;
            position: relative;
            overflow: hidden;
            border: 3px solid #81D4FA;
        }
        
        .ice-level {
            height: 80%;
            width: 100%;
            background-color: #E1F5FE;
            position: absolute;
            bottom: 0;
            transition: height 2s;
        }
        
        .polar-bear {
            position: absolute;
            bottom: 10px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 4rem;
            transition: bottom 2s;
            z-index: 2;
        }
        
        .threats {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 20px;
            flex-wrap: wrap;
        }
        
        .threat {
            padding: 10px 15px;
            background-color: #FFEBEE;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid #F44336;
            font-weight: bold;
            color: #C62828;
        }
        
        .threat:hover {
            background-color: #FFCDD2;
        }
        
        .solutions {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 20px;
            flex-wrap: wrap;
        }
        
        .solution {
            padding: 10px 15px;
            background-color: #E8F5E9;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid #4CAF50;
            font-weight: bold;
            color: #2E7D32;
        }
        
        .solution:hover {
            background-color: #C8E6C9;
        }
        
        .solution.disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .game-stats {
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
            padding-top: 15px;
            border-top: 1px solid #ddd;
        }
        
        .score, .level {
            font-size: 1.3rem;
            font-weight: bold;
            color: #2E7D32;
        }
        
        .game-controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 20px;
        }
        
        button {
            padding: 12px 25px;
            border: none;
            border-radius: 50px;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        button:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 10px rgba(0, 0, 0, 0.1);
        }
        
        .btn-start {
            background-color: #4CAF50;
            color: white;
        }
        
        .btn-reset {
            background-color: #FF9800;
            color: white;
        }
        
        .btn-next {
            background-color: #2196F3;
            color: white;
        }
        
        .feedback {
            text-align: center;
            font-size: 1.4rem;
            font-weight: bold;
            margin-top: 20px;
            min-height: 40px;
            padding: 10px;
            border-radius: 10px;
            transition: all 0.3s;
        }
        
        .feedback.correct {
            color: #2E7D32;
            background-color: rgba(76, 175, 80, 0.1);
        }
        
        .feedback.incorrect {
            color: #F44336;
            background-color: rgba(244, 67, 54, 0.1);
        }
        
        .progress-container {
            margin-top: 20px;
            background-color: #eee;
            border-radius: 10px;
            overflow: hidden;
            height: 20px;
        }
        
        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #4CAF50, #8BC34A);
            width: 0%;
            transition: width 0.5s;
        }
        
        .footer {
            text-align: center;
            padding: 20px;
            color: #666;
            font-size: 0.9rem;
            border-top: 1px solid #ddd;
            margin-top: 20px;
        }
        
        .fact-popup {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            display: none;
        }
        
        .fact-content {
            background-color: white;
            width: 90%;
            max-width: 600px;
            border-radius: 15px;
            padding: 30px;
            position: relative;
            animation: popup 0.5s;
        }
        
        @keyframes popup {
            from { transform: scale(0.8); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }
        
        .close-popup {
            position: absolute;
            top: 15px;
            right: 15px;
            font-size: 1.5rem;
            cursor: pointer;
            color: #777;
        }
        
        .fact-content h3 {
            color: #2E7D32;
            margin-bottom: 15px;
            font-size: 1.8rem;
        }
        
        .fact-icon {
            font-size: 3rem;
            text-align: center;
            margin: 15px 0;
            color: #4CAF50;
        }
        
        .badge {
            display: inline-block;
            padding: 5px 10px;
            background-color: #FFEB3B;
            border-radius: 5px;
            font-size: 0.8rem;
            font-weight: bold;
            margin-left: 10px;
            color: #333;
        }
        
        /* 新增設備圖示樣式 */
        .device-illustration {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 20px;
            margin: 20px 0;
        }
        
        .device-item {
            text-align: center;
            width: 140px;
        }
        
        .device-icon {
            font-size: 3rem;
            color: #2196F3;
            margin-bottom: 10px;
        }
        
        .device-name {
            font-weight: bold;
            color: #333;
            margin-bottom: 5px;
        }
        
        .device-desc {
            font-size: 0.9rem;
            color: #666;
        }
        
        /* 能源監控流程圖 */
        .monitoring-flow {
            display: flex;
            justify-content: center;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
            margin: 25px 0;
            padding: 20px;
            background-color: #f8f9fa;
            border-radius: 10px;
            border: 2px dashed #4CAF50;
        }
        
        .flow-step {
            text-align: center;
            min-width: 120px;
        }
        
        .flow-arrow {
            font-size: 1.5rem;
            color: #FF9800;
        }
        
        .flow-icon {
            font-size: 2.5rem;
            color: #2196F3;
            margin-bottom: 10px;
        }
        
        .flow-text {
            font-weight: bold;
            color: #333;
        }
        
        /* 電表模擬遊戲樣式 */
        .meter-simulation {
            background-color: #f5f5f5;
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            border: 2px solid #2196F3;
        }
        
        .meter-display {
            background-color: #333;
            color: #0f0;
            padding: 15px;
            border-radius: 10px;
            font-family: 'Courier New', monospace;
            font-size: 1.5rem;
            text-align: center;
            margin: 15px 0;
            border: 3px solid #666;
        }
        
        .meter-controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin: 20px 0;
        }
        
        .appliance-control {
            background-color: white;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid #ddd;
            min-width: 120px;
        }
        
        .appliance-control.on {
            background-color: #FFEB3B;
            border-color: #FF9800;
        }
        
        .appliance-control.off {
            background-color: #f5f5f5;
            border-color: #9E9E9E;
        }
        
        .power-consumption {
            display: flex;
            justify-content: space-around;
            margin-top: 20px;
            padding-top: 15px;
            border-top: 1px solid #ddd;
        }
        
        .consumption-item {
            text-align: center;
        }
        
        .consumption-value {
            font-size: 1.3rem;
            font-weight: bold;
            color: #2196F3;
        }
        
        @media (max-width: 768px) {
            .main-content {
                flex-direction: column;
            }
            
            header h1 {
                font-size: 2rem;
            }
            
            .timer {
                position: static;
                margin-top: 15px;
                display: inline-block;
            }
            
            .tabs {
                flex-direction: column;
                align-items: center;
            }
            
            .knowledge-cards {
                grid-template-columns: 1fr;
            }
            
            .house-container {
                width: 250px;
                height: 220px;
            }
            
            .appliance {
                width: 50px;
                height: 50px;
                font-size: 0.7rem;
            }
            
            .energy-details, .carbon-score {
                flex-direction: column;
                align-items: center;
                gap: 10px;
            }
            
            .monitoring-flow {
                flex-direction: column;
            }
            
            .flow-arrow {
                transform: rotate(90deg);
            }
            
            .device-item {
                width: 100px;
            }
            
            .meter-controls {
                flex-wrap: wrap;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="logo">
                <i class="fas fa-earth-asia"></i>
            </div>
            <h1>仙洞國小環保小衛士 - 能源監控版</h1>
            <p>學習環境保護知識，從節約用電、碳匯到認識能源監控設備，一起守護地球！</p>
            <div class="timer">
                <i class="fas fa-clock"></i> <span id="time">30:00</span>
            </div>
        </header>
        
        <div class="tabs">
            <button class="tab-button active" data-tab="knowledge">
                <i class="fas fa-graduation-cap"></i> 環保知識學堂
            </button>
            <button class="tab-button" data-tab="energy-tech">
                <i class="fas fa-tachometer-alt"></i> 能源監控科技
            </button>
            <button class="tab-button" data-tab="matching-game">
                <i class="fas fa-puzzle-piece"></i> 環保配對遊戲
            </button>
            <button class="tab-button" data-tab="energy-game">
                <i class="fas fa-bolt"></i> 節電挑戰賽
            </button>
            <button class="tab-button" data-tab="carbon-game">
                <i class="fas fa-tree"></i> 碳匯挑戰賽
            </button>
            <button class="tab-button" data-tab="polar-bear-game">
                <i class="fas fa-paw"></i> 拯救北極熊
            </button>
        </div>
        
        <!-- 環保知識學堂標籤頁 -->
        <div class="tab-content active" id="knowledge-tab">
            <div class="teaching-section">
                <h2 class="section-title"><i class="fas fa-book-open"></i> 環保知識大全</h2>
                <p>小朋友，讓我們學習更多關於環境保護的知識，了解我們的地球正面臨哪些挑戰，以及我們可以怎麼做！</p>
                
                <div class="knowledge-cards">
                    <div class="knowledge-card energy" onclick="showFact('energy')">
                        <div class="card-icon">
                            <i class="fas fa-bolt"></i>
                        </div>
                        <h3>用電節約與能源監控</h3>
                        <div class="card-content">
                            <p><strong>電費計算公式：</strong></p>
                            <p>電費 = 用電度數 × 每度電價(約3元)</p>
                            <p><strong>電器耗電計算：</strong></p>
                            <p>用電度數 = 電器功率(W) × 使用時間(小時) ÷ 1000</p>
                            <p><strong>例如：</strong></p>
                            <ul>
                                <li>100W電燈開10小時 = 1度電 = 3元</li>
                                <li>冷氣1500W開1小時 = 1.5度電 = 4.5元</li>
                                <li>關閉待機電器可節省5-10%電費</li>
                            </ul>
                        </div>
                        <div class="card-tip">
                            <strong>節電技巧：</strong>離開房間超過10分鐘就關燈，夏季冷氣設定26-28°C最省電！
                        </div>
                    </div>
                    
                    <div class="knowledge-card carbon" onclick="showFact('carbon')">
                        <div class="card-icon">
                            <i class="fas fa-tree"></i>
                        </div>
                        <h3>樹木碳匯與海洋碳匯 <span class="badge">新知識</span></h3>
                        <div class="card-content">
                            <p><strong>碳匯是什麼？</strong>能夠吸收二氧化碳的自然系統。</p>
                            <p><strong>樹木碳匯：</strong></p>
                            <ul>
                                <li>一棵樹每年可吸收12公斤二氧化碳</li>
                                <li>一棵樹一生可吸收約1噸二氧化碳</li>
                                <li>1公頃森林每年吸收22噸二氧化碳</li>
                            </ul>
                            <p><strong>海洋碳匯：</strong></p>
                            <ul>
                                <li>海洋吸收約30%人類排放的二氧化碳</li>
                                <li>浮游植物通過光合作用吸收二氧化碳</li>
                                <li>1平方公里的健康海洋每年吸收150公斤二氧化碳</li>
                            </ul>
                        </div>
                        <div class="card-tip">
                            <strong>行動：</strong>種植一棵樹，它一生可以吸收1噸的二氧化碳！
                        </div>
                    </div>
                    
                    <div class="knowledge-card water" onclick="showFact('water')">
                        <div class="card-icon">
                            <i class="fas fa-tint"></i>
                        </div>
                        <h3>珍惜水資源</h3>
                        <div class="card-content">
                            <p>地球上的水只有2.5%是淡水，其中大部分是冰河。我們要：</p>
                            <ul>
                                <li>縮短洗澡時間，使用省水蓮蓬頭</li>
                                <li>刷牙時關水龍頭，可節省6公升水</li>
                                <li>收集雨水澆花</li>
                                <li>一水多用：洗米水可以澆花</li>
                            </ul>
                        </div>
                        <div class="card-tip">
                            <strong>你知道嗎：</strong>生產1件棉T恤需要2,700公升的水！
                        </div>
                    </div>
                    
                    <div class="knowledge-card animal" onclick="showFact('animal')">
                        <div class="card-icon">
                            <i class="fas fa-paw"></i>
                        </div>
                        <h3>北極熊與生態危機</h3>
                        <div class="card-content">
                            <p>北極熊依賴海冰捕食海豹，但全球暖化導致：</p>
                            <ul>
                                <li>北極海冰每10年減少13%</li>
                                <li>北極熊覓食困難，體重下降</li>
                                <li>生存區域縮小，數量減少</li>
                            </ul>
                            <p>保護北極熊，我們需要減少碳排放，減緩全球暖化。</p>
                        </div>
                    </div>
                    
                    <div class="knowledge-card esg" onclick="showFact('esg')">
                        <div class="card-icon">
                            <i class="fas fa-chart-line"></i>
                        </div>
                        <h3>什麼是ESG？ <span class="badge">新知識</span></h3>
                        <div class="card-content">
                            <p>ESG是企業評估的三個重要標準：</p>
                            <ul>
                                <li><strong>E 環境：</strong>公司對環境的影響，如碳排放、資源使用</li>
                                <li><strong>S 社會：</strong>公司對員工、社區的責任</li>
                                <li><strong>G 治理：</strong>公司的管理和透明度</li>
                            </ul>
                            <p>選擇支持ESG表現好的企業，就是在支持環保！</p>
                        </div>
                    </div>
                    
                    <div class="knowledge-card ozone" onclick="showFact('ozone')">
                        <div class="card-icon">
                            <i class="fas fa-layer-group"></i>
                        </div>
                        <h3>臭氧層破洞</h3>
                        <div class="card-content">
                            <p>臭氧層保護我們免受有害紫外線傷害。但人類使用的氟氯碳化物(CFCs)會破壞臭氧層，導致：</p>
                            <ul>
                                <li>皮膚癌風險增加</li>
                                <li>農作物減產</li>
                                <li>海洋生態受影響</li>
                            </ul>
                            <p>好消息：自從1987年蒙特婁公約後，臭氧層正在慢慢恢復！</p>
                        </div>
                    </div>
                </div>
                
                <div class="game-instruction">
                    <p><i class="fas fa-lightbulb"></i> <strong>環保小口訣：</strong> 隨手關燈省能源，冷氣26剛剛好，自備餐具少塑膠，走路騎車減碳排，珍惜用水滴滴貴，環保行動我最行！</p>
                </div>
            </div>
        </div>
        
        <!-- 新增的能源監控科技標籤頁 -->
        <div class="tab-content" id="energy-tech-tab">
            <div class="teaching-section">
                <h2 class="section-title"><i class="fas fa-tachometer-alt"></i> 能源監控科技小學堂</h2>
                <p>小朋友，讓我們認識現代能源監控的科技設備，了解如何用智慧工具來節約用電！</p>
                
                <div class="knowledge-cards">
                    <div class="knowledge-card meter" onclick="showFact('clamp-meter')">
                        <div class="card-icon">
                            <i class="fas fa-bolt"></i>
                        </div>
                        <h3>電流鉤表（夾式電表）<span class="badge">新設備</span></h3>
                        <div class="card-content">
                            <p><strong>什麼是電流鉤表？</strong></p>
                            <p>就像醫生的聽診器，可以「夾住」電線來測量電流，不需要切斷電線！</p>
                            <p><strong>特點：</strong></p>
                            <ul>
                                <li>安全方便，不用接觸電線內部</li>
                                <li>可以測量電器實際用電量</li>
                                <li>像夾子一樣夾住電線即可</li>
                                <li>測量單位：安培(A)</li>
                            </ul>
                            <p><strong>小朋友可以學：</strong>電流就像水流，鉤表就像水流計！</p>
                        </div>
                        <div class="card-tip">
                            <strong>小實驗：</strong>請老師示範用鉤表測量教室電燈的電流！
                        </div>
                    </div>
                    
                    <div class="knowledge-card meter" onclick="showFact('electric-meter')">
                        <div class="card-icon">
                            <i class="fas fa-chart-bar"></i>
                        </div>
                        <h3>智慧電表</h3>
                        <div class="card-content">
                            <p><strong>什麼是智慧電表？</strong></p>
                            <p>家裡的「用電小秘書」，可以自動記錄用電情況！</p>
                            <p><strong>功能：</strong></p>
                            <ul>
                                <li>每15分鐘記錄一次用電量</li>
                                <li>自動把數據傳給用戶</li>
                                <li>不用人工抄電表</li>
                                <li>可以即時查看用電狀況</li>
                            </ul>
                            <p><strong>與傳統電表差別：</strong></p>
                            <ul>
                                <li>傳統電表：需要人去看數字</li>
                                <li>智慧電表：自動傳送數據</li>
                                <li>傳統：每月知道一次用電量</li>
                                <li>智慧：隨時知道用電情況</li>
                            </ul>
                        </div>
                        <div class="card-tip">
                            <strong>觀察任務：</strong>回家找找看家裡的電表在哪裡！
                        </div>
                    </div>
                    
                    <div class="knowledge-card gateway" onclick="showFact('gateway')">
                        <div class="card-icon">
                            <i class="fas fa-wifi"></i>
                        </div>
                        <h3>閘道器（通訊小幫手）<span class="badge">新科技</span></h3>
                        <div class="card-content">
                            <p><strong>什麼是閘道器？</strong></p>
                            <p>就像能源數據的「郵差」，負責傳送用電訊息！</p>
                            <p><strong>兩種閘道器：</strong></p>
                            <ul>
                                <li><strong>無線閘道器：</strong>用Wi-Fi或藍牙傳輸，像無線對講機</li>
                                <li><strong>有線閘道器：</strong>用網路線傳輸，像固定電話</li>
                            </ul>
                            <p><strong>工作流程：</strong></p>
                            <ol>
                                <li>電表收集用電數據</li>
                                <li>閘道器接收數據</li>
                                <li>閘道器傳送到雲端</li>
                                <li>我們從手機或電腦查看</li>
                            </ol>
                        </div>
                        <div class="card-tip">
                            <strong>比喻：</strong>閘道器就像學校的廣播系統，把訊息傳給每間教室！
                        </div>
                    </div>
                    
                    <div class="knowledge-card ems" onclick="showFact('ems')">
                        <div class="card-icon">
                            <i class="fas fa-cloud"></i>
                        </div>
                        <h3>雲端能源管理系統(EMS)<span class="badge">智慧系統</span></h3>
                        <div class="card-content">
                            <p><strong>什麼是EMS？</strong></p>
                            <p>能源的「大腦」，在雲端分析用電情況，幫助我們節電！</p>
                            <p><strong>功能：</strong></p>
                            <ul>
                                <li>收集所有電表的數據</li>
                                <li>分析哪裡用電最多</li>
                                <li>找出浪費電的地方</li>
                                <li>建議節電方法</li>
                                <li>可以手機APP查看</li>
                            </ul>
                            <p><strong>EMS如何幫助我們：</strong></p>
                            <ul>
                                <li>發現冷氣開太冷</li>
                                <li>提醒關閉沒用的電燈</li>
                                <li>比較今天和昨天用電量</li>
                                <li>設定用電目標</li>
                            </ul>
                        </div>
                        <div class="card-tip">
                            <strong>想像：</strong>EMS就像能源醫生，幫我們的用電習慣做健康檢查！
                        </div>
                    </div>
                </div>
                
                <!-- 設備圖示展示 -->
                <div class="device-illustration">
                    <div class="device-item">
                        <div class="device-icon">
                            <i class="fas fa-bolt"></i>
                        </div>
                        <div class="device-name">電流鉤表</div>
                        <div class="device-desc">測量電流</div>
                    </div>
                    <div class="device-item">
                        <div class="device-icon">
                            <i class="fas fa-chart-line"></i>
                        </div>
                        <div class="device-name">智慧電表</div>
                        <div class="device-desc">記錄用電</div>
                    </div>
                    <div class="device-item">
                        <div class="device-icon">
                            <i class="fas fa-wifi"></i>
                        </div>
                        <div class="device-name">無線閘道器</div>
                        <div class="device-desc">無線傳輸</div>
                    </div>
                    <div class="device-item">
                        <div class="device-icon">
                            <i class="fas fa-ethernet"></i>
                        </div>
                        <div class="device-name">有線閘道器</div>
                        <div class="device-desc">有線傳輸</div>
                    </div>
                    <div class="device-item">
                        <div class="device-icon">
                            <i class="fas fa-cloud"></i>
                        </div>
                        <div class="device-name">雲端EMS</div>
                        <div class="device-desc">分析管理</div>
                    </div>
                </div>
                
                <!-- 能源監控流程圖 -->
                <div class="monitoring-flow">
                    <div class="flow-step">
                        <div class="flow-icon">
                            <i class="fas fa-plug"></i>
                        </div>
                        <div class="flow-text">電器用電</div>
                    </div>
                    <div class="flow-arrow">
                        <i class="fas fa-arrow-right"></i>
                    </div>
                    <div class="flow-step">
                        <div class="flow-icon">
                            <i class="fas fa-bolt"></i>
                        </div>
                        <div class="flow-text">電流鉤表測量</div>
                    </div>
                    <div class="flow-arrow">
                        <i class="fas fa-arrow-right"></i>
                    </div>
                    <div class="flow-step">
                        <div class="flow-icon">
                            <i class="fas fa-tachometer-alt"></i>
                        </div>
                        <div class="flow-text">智慧電表記錄</div>
                    </div>
                    <div class="flow-arrow">
                        <i class="fas fa-arrow-right"></i>
                    </div>
                    <div class="flow-step">
                        <div class="flow-icon">
                            <i class="fas fa-wifi"></i>
                        </div>
                        <div class="flow-text">閘道器傳送</div>
                    </div>
                    <div class="flow-arrow">
                        <i class="fas fa-arrow-right"></i>
                    </div>
                    <div class="flow-step">
                        <div class="flow-icon">
                            <i class="fas fa-cloud"></i>
                        </div>
                        <div class="flow-text">雲端EMS分析</div>
                    </div>
                    <div class="flow-arrow">
                        <i class="fas fa-arrow-right"></i>
                    </div>
                    <div class="flow-step">
                        <div class="flow-icon">
                            <i class="fas fa-mobile-alt"></i>
                        </div>
                        <div class="flow-text">手機APP查看</div>
                    </div>
                </div>
                
                <!-- 電表模擬遊戲 -->
                <div class="meter-simulation">
                    <h3><i class="fas fa-gamepad"></i> 電表模擬小遊戲</h3>
                    <p>模擬智慧電表如何記錄用電，試試開關電器看看用電變化！</p>
                    
                    <div class="meter-display" id="meter-display">
                        <div>⚡ 即時用電監控 ⚡</div>
                        <div>總用電量: <span id="total-kwh">0.0</span> 度</div>
                        <div>即時功率: <span id="current-watt">0</span> 瓦特</div>
                        <div>估算電費: <span id="estimated-cost">$0</span> 元</div>
                    </div>
                    
                    <div class="meter-controls">
                        <div class="appliance-control off" id="light-control" onclick="toggleAppliance('light')">
                            <i class="fas fa-lightbulb"></i>
                            <div>電燈</div>
                            <div>100W</div>
                        </div>
                        <div class="appliance-control off" id="fan-control" onclick="toggleAppliance('fan')">
                            <i class="fas fa-fan"></i>
                            <div>電風扇</div>
                            <div>80W</div>
                        </div>
                        <div class="appliance-control off" id="tv-control" onclick="toggleAppliance('tv')">
                            <i class="fas fa-tv"></i>
                            <div>電視</div>
                            <div>200W</div>
                        </div>
                        <div class="appliance-control off" id="computer-control" onclick="toggleAppliance('computer')">
                            <i class="fas fa-desktop"></i>
                            <div>電腦</div>
                            <div>300W</div>
                        </div>
                    </div>
                    
                    <div class="power-consumption">
                        <div class="consumption-item">
                            <div>開啟電器數</div>
                            <div class="consumption-value" id="appliance-count">0</div>
                        </div>
                        <div class="consumption-item">
                            <div>每小時用電</div>
                            <div class="consumption-value" id="hourly-use">0.0 度</div>
                        </div>
                        <div class="consumption-item">
                            <div>每日電費</div>
                            <div class="consumption-value" id="daily-cost">$0</div>
                        </div>
                    </div>
                    
                    <div class="game-instruction">
                        <p><i class="fas fa-lightbulb"></i> <strong>遊戲說明：</strong> 點擊電器圖示開關電器，觀察電表數據變化！</p>
                        <p>智慧電表就像這樣自動記錄用電，EMS系統分析後會告訴我們如何節電！</p>
                    </div>
                </div>
                
                <div class="game-instruction">
                    <p><i class="fas fa-graduation-cap"></i> <strong>能源監控小口訣：</strong> 鉤表量電流，電表記度數，閘道傳數據，雲端幫分析，手機隨時看，節電真簡單！</p>
                </div>
            </div>
        </div>
        
        <!-- 原有其他標籤頁內容 -->
        <div class="tab-content" id="matching-game-tab">
            <div class="game-section">
                <h2 class="section-title"><i class="fas fa-puzzle-piece"></i> 環保配對遊戲</h2>
                
                <div class="game-area">
                    <div class="game-stats">
                        <div class="score">得分: <span id="matching-score">0</span>/300</div>
                        <div class="level">關卡: <span id="matching-level">1</span>/3</div>
                    </div>
                    
                    <div class="game-instruction">
                        <p>將環境問題與解決方案配對起來！點擊左邊的問題，再點擊右邊的解決方案。</p>
                        <p><strong>計分規則：</strong>每關配對正確得100分，三關全對可得300分滿分！</p>
                    </div>
                    
                    <div class="game-container">
                        <div class="matching-game" id="matching-game-container">
                            <!-- 遊戲內容由JavaScript動態生成 -->
                        </div>
                    </div>
                    
                    <div class="feedback" id="matching-feedback"></div>
                    
                    <div class="game-controls">
                        <button class="btn-start" onclick="startMatchingGame()">
                            <i class="fas fa-play"></i> 開始遊戲
                        </button>
                        <button class="btn-reset" onclick="resetMatchingGame()">
                            <i class="fas fa-redo"></i> 重新開始
                        </button>
                        <button class="btn-next" onclick="nextMatchingLevel()" disabled id="matching-next-btn">
                            <i class="fas fa-arrow-right"></i> 下一關
                        </button>
                    </div>
                    
                    <div class="progress-container">
                        <div class="progress-bar" id="matching-progress-bar"></div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="tab-content" id="energy-game-tab">
            <div class="game-section">
                <h2 class="section-title"><i class="fas fa-bolt"></i> 節電挑戰賽</h2>
                
                <div class="game-area">
                    <div class="game-stats">
                        <div class="score">遊戲得分: <span id="energy-score">0</span>/100</div>
                        <div class="level">時間: <span id="energy-time">60</span>秒</div>
                    </div>
                    
                    <div class="game-instruction">
                        <p>關閉不必要的電器，節省能源！點擊電器來開啟或關閉它。</p>
                        <p><strong>計分規則：</strong></p>
                        <ul>
                       
                        </ul>
                        <p>目標：在60秒內關閉所有不必要電器，獲得100分滿分！</p>
                    </div>
                    
                    <div class="game-container">
                        <div class="energy-challenge" id="energy-game-container">
                            <div class="energy-meter">
                                <div class="energy-level" id="energy-level"></div>
                            </div>
                            <div class="meter-labels">
                                <span>節能</span>
                                <span>普通</span>
                                <span>耗能</span>
                            </div>
                            
                            <div class="energy-details">
                                <div class="energy-detail">
                                    <div class="label">每月電費</div>
                                    <div class="value" id="energy-cost">$800</div>
                                </div>
                                <div class="energy-detail">
                                    <div class="label">節省電費</div>
                                    <div class="value" id="energy-saved">$0</div>
                                </div>
                                <div class="energy-detail">
                                    <div class="label">用電度數</div>
                                    <div class="value" id="energy-kwh">0</div>
                                </div>
                            </div>
                            
                            <div class="house-container" id="house-container">
                                <!-- 電器由JavaScript動態生成 -->
                            </div>
                            
                            <div class="feedback" id="energy-feedback"></div>
                            
                            <div class="game-controls">
                                <button class="btn-start" onclick="startEnergyGame()">
                                    <i class="fas fa-play"></i> 開始挑戰
                                </button>
                                <button class="btn-reset" onclick="resetEnergyGame()">
                                    <i class="fas fa-redo"></i> 重新開始
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="tab-content" id="carbon-game-tab">
            <div class="game-section">
                <h2 class="section-title"><i class="fas fa-tree"></i> 碳匯挑戰賽</h2>
                
                <div class="game-area">
                    <div class="game-stats">
                        <div class="score">遊戲得分: <span id="carbon-score">0</span>/100</div>
                        <div class="level">碳平衡: <span id="carbon-balance">-100</span> 公斤</div>
                    </div>
                    
                    <div class="game-instruction">
                        <p>增加碳匯吸收，減少碳排放！點擊碳源增加排放，點擊碳匯增加吸收。</p>
                        <p><strong>計分規則：</strong></p>
                        <ul>
                       
                        </ul>
                        <p>目標：讓碳匯吸收量超過碳排放量，達到碳平衡正值，獲得100分滿分！</p>
                    </div>
                    
                    <div class="game-container">
                        <div class="carbon-sink-game" id="carbon-game-container">
                            <div class="earth-container">
                                <i class="fas fa-globe-americas" id="earth-icon"></i>
                            </div>
                            
                            <div class="carbon-meter">
                                <div class="carbon-level" id="carbon-level"></div>
                            </div>
                            <div class="meter-labels">
                                <span>碳匯不足</span>
                                <span>平衡</span>
                                <span>碳匯充足</span>
                            </div>
                            
                            <div class="carbon-score">
                                <div class="carbon-score-item">
                                    <div class="label">碳排放量</div>
                                    <div class="value negative" id="carbon-emission">100 公斤</div>
                                </div>
                                <div class="carbon-score-item">
                                    <div class="label">碳匯吸收量</div>
                                    <div class="value positive" id="carbon-sink-amount">0 公斤</div>
                                </div>
                            </div>
                            
                            <h3>碳排放源：</h3>
                            <div class="carbon-sources" id="carbon-sources-container">
                                <!-- 碳源由JavaScript動態生成 -->
                            </div>
                            
                            <h3>碳匯吸收：</h3>
                            <div class="carbon-sinks" id="carbon-sinks-container">
                                <!-- 碳匯由JavaScript動態生成 -->
                            </div>
                            
                            <div class="feedback" id="carbon-feedback"></div>
                            
                            <div class="game-controls">
                                <button class="btn-start" onclick="startCarbonGame()">
                                    <i class="fas fa-play"></i> 開始遊戲
                                </button>
                                <button class="btn-reset" onclick="resetCarbonGame()">
                                    <i class="fas fa-redo"></i> 重新開始
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="tab-content" id="polar-bear-game-tab">
            <div class="game-section">
                <h2 class="section-title"><i class="fas fa-paw"></i> 拯救北極熊</h2>
                
                <div class="game-area">
                    <div class="game-stats">
                        <div class="score">北極熊健康度: <span id="polar-bear-health">100</span>%</div>
                        <div class="level">冰層厚度: <span id="ice-thickness">100</span>%</div>
                    </div>
                    
                    <div class="game-instruction">
                        <p>幫助北極熊對抗全球暖化！點擊威脅來了解問題，點擊解決方案來幫助北極熊。</p>
                        <p>注意：冰層融化會讓北極熊落水！</p>
                    </div>
                    
                    <div class="game-container">
                        <div class="polar-bear-game" id="polar-bear-game-container">
                            <div class="iceberg">
                                <div class="ice-level" id="ice-level"></div>
                                <div class="polar-bear" id="polar-bear">🐻‍❄️</div>
                            </div>
                            
                            <h3>環境威脅：</h3>
                            <div class="threats" id="threats-container">
                                <!-- 威脅由JavaScript動態生成 -->
                            </div>
                            
                            <h3>解決方案：</h3>
                            <div class="solutions" id="solutions-container">
                                <!-- 解決方案由JavaScript動態生成 -->
                            </div>
                            
                            <div class="feedback" id="polar-bear-feedback"></div>
                            
                            <div class="game-controls">
                                <button class="btn-start" onclick="startPolarBearGame()">
                                    <i class="fas fa-play"></i> 開始救援
                                </button>
                                <button class="btn-reset" onclick="resetPolarBearGame()">
                                    <i class="fas fa-redo"></i> 重新開始
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="footer">
            <p>仙洞國小環保教育活動 | 活動時間：30分鐘 | 設計理念：培養小朋友環保意識，珍惜地球資源</p>
            <p>記住：每個小小的環保行動，都能為地球帶來大大的改變！</p>
        </div>
    </div>
    
    <!-- 知識彈出視窗 -->
    <div class="fact-popup" id="fact-popup">
        <div class="fact-content">
            <div class="close-popup" onclick="closeFactPopup()">&times;</div>
            <h3 id="fact-title"></h3>
            <div class="fact-icon" id="fact-icon"></div>
            <div id="fact-content"></div>
            <div class="card-tip" id="fact-tip"></div>
        </div>
    </div>

    <script>
        // 全局變數
        let timeLeft = 30 * 60; // 30分鐘轉換為秒
        let timerInterval;
        let currentTab = 'knowledge';
        
        // 初始化
        function init() {
            updateTimerDisplay();
            setupTabs();
            initMatchingGame();
            initEnergyGame();
            initCarbonGame();
            initPolarBearGame();
            initMeterSimulation(); // 新增電表模擬遊戲初始化
            startTimer();
            
            // 顯示歡迎訊息
            setTimeout(() => {
                showFact('welcome');
            }, 1000);
        }
        
        // 開始計時器
        function startTimer() {
            clearInterval(timerInterval);
            timerInterval = setInterval(() => {
                timeLeft--;
                updateTimerDisplay();
                
                if (timeLeft <= 0) {
                    clearInterval(timerInterval);
                    alert('時間到！今天的環保學習完成啦！你學到了好多環保知識，真棒！');
                }
            }, 1000);
        }
        
        // 更新計時器顯示
        function updateTimerDisplay() {
            const minutes = Math.floor(timeLeft / 60);
            const seconds = timeLeft % 60;
            document.getElementById('time').textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }
        
        // 設置標籤頁切換
        function setupTabs() {
            const tabButtons = document.querySelectorAll('.tab-button');
            const tabContents = document.querySelectorAll('.tab-content');
            
            tabButtons.forEach(button => {
                button.addEventListener('click', () => {
                    const tabId = button.getAttribute('data-tab');
                    
                    // 更新按鈕狀態
                    tabButtons.forEach(btn => btn.classList.remove('active'));
                    button.classList.add('active');
                    
                    // 更新內容顯示
                    tabContents.forEach(content => content.classList.remove('active'));
                    document.getElementById(`${tabId}-tab`).classList.add('active');
                    
                    currentTab = tabId;
                    
                    // 如果切換到能源監控標籤，重新開始電表遊戲
                    if (tabId === 'energy-tech') {
                        resetMeterGame();
                    }
                });
            });
        }
        
        // 顯示知識彈出視窗
        function showFact(factType) {
            const popup = document.getElementById('fact-popup');
            const title = document.getElementById('fact-title');
            const icon = document.getElementById('fact-icon');
            const content = document.getElementById('fact-content');
            const tip = document.getElementById('fact-tip');
            
            const facts = {
                'welcome': {
                    title: '歡迎來到環保小衛士！',
                    icon: '<i class="fas fa-earth-asia"></i>',
                    content: '<p>小朋友你好！歡迎來到仙洞國小環保小衛士學習遊戲！</p><p>在這裡，你會學到關於節約用電、珍惜水資源、保護臭氧層、認識ESG，還有碳匯和拯救北極熊的知識！</p><p>點擊不同的標籤頁可以學習和玩遊戲，讓我們一起成為環保小達人吧！</p>',
                    tip: '記得在30分鐘內完成所有學習和遊戲哦！'
                },
                'energy': {
                    title: '用電節約與電費計算',
                    icon: '<i class="fas fa-bolt"></i>',
                    content: '<p><strong>電費如何計算？</strong></p><p>電費 = 用電度數 × 每度電價(約3元)</p><p><strong>電器耗電計算：</strong></p><p>用電度數 = 電器功率(W) × 使用時間(小時) ÷ 1000</p><p><strong>實際例子：</strong></p><ul><li>100W電燈開10小時 = 1度電 = 3元電費</li><li>冷氣1500W開1小時 = 1.5度電 = 4.5元電費</li><li>電視200W開5小時 = 1度電 = 3元電費</li><li>電腦300W開3小時 = 0.9度電 = 2.7元電費</li></ul><p>關閉待機電器，每月可節省5-10%電費！</p>',
                    tip: '晚上睡覺前，記得檢查所有電器是否已關閉或拔掉插頭！'
                },
                'carbon': {
                    title: '樹木碳匯與海洋碳匯',
                    icon: '<i class="fas fa-tree"></i>',
                    content: '<p><strong>碳匯是什麼？</strong>能夠吸收二氧化碳的自然系統。</p><p><strong>樹木碳匯：</strong></p><ul><li>一棵樹每年可吸收12公斤二氧化碳</li><li>一棵樹一生可吸收約1噸二氧化碳</li><li>1公頃森林每年吸收22噸二氧化碳</li><li>全球森林每年吸收約29億噸二氧化碳</li></ul><p><strong>海洋碳匯：</strong></p><ul><li>海洋吸收約30%人類排放的二氧化碳</li><li>浮游植物通過光合作用吸收二氧化碳</li><li>1平方公里的健康海洋每年吸收150公斤二氧化碳</li><li>全球海洋每年吸收約25億噸二氧化碳</li></ul><p><strong>保護碳匯：</strong>減少森林砍伐、保護海洋生態、植樹造林！</p>',
                    tip: '種植一棵樹，它一生可以吸收1噸的二氧化碳！'
                },
                // 新增能源監控相關facts
                'clamp-meter': {
                    title: '電流鉤表（夾式電表）',
                    icon: '<i class="fas fa-bolt"></i>',
                    content: '<p><strong>電流鉤表的秘密：</strong></p><p>電流鉤表又叫做夾式電表，因為它長得像一個大夾子！</p><p><strong>工作原理：</strong></p><ul><li>利用電磁感應原理測量電流</li><li>夾住電線就能測量，不用接觸電線內部</li><li>非常安全，不會觸電</li><li>可以測量從0.1A到幾百A的電流</li></ul><p><strong>實際應用：</strong></p><ul><li>檢查家裡電器是否耗電</li><li>找出「電器吸血鬼」（待機耗電的電器）</li><li>幫助工廠節約能源</li><li>維修電器時檢測電流</li></ul>',
                    tip: '電流就像水流，安培(A)就是水流的「水量」單位！'
                },
                'electric-meter': {
                    title: '智慧電表',
                    icon: '<i class="fas fa-chart-bar"></i>',
                    content: '<p><strong>智慧電表的進化：</strong></p><p>從傳統機械式電表變成智慧電子式電表！</p><p><strong>傳統電表：</strong></p><ul><li>需要人工抄表</li><li>每月只知道一次用電量</li><li>無法知道何時用電最多</li><li>像老式時鐘，需要人去看</li></ul><p><strong>智慧電表：</strong></p><ul><li>自動記錄用電數據</li><li>每15分鐘記錄一次</li><li>可以分析用電習慣</li><li>像智慧手錶，自動記錄</li><li>幫助我們找出浪費電的時間</li></ul><p><strong>好處：</strong>可以隨時在手機上看用電情況，就像看天氣預報一樣方便！</p>',
                    tip: '家裡安裝智慧電表後，試著觀察每天的用電曲線圖！'
                },
                'gateway': {
                    title: '閘道器（能源數據的郵差）',
                    icon: '<i class="fas fa-wifi"></i>',
                    content: '<p><strong>閘道器的重要工作：</strong></p><p>閘道器是能源監控系統中的「通訊中心」！</p><p><strong>兩種傳輸方式：</strong></p><ul><li><strong>無線閘道器：</strong>使用Wi-Fi、藍牙、LoRa等無線技術，像無線電對講機</li><li><strong>有線閘道器：</strong>使用網路線(乙太網路)傳輸，像固定電話線</li></ul><p><strong>選擇哪種好？</strong></p><ul><li>無線：安裝方便，不用拉線</li><li>有線：信號穩定，不怕干擾</li><li>學校通常用有線，比較穩定</li><li>家裡可以用無線，比較方便</li></ul><p><strong>比喻：</strong>閘道器就像學校的廣播系統，把訊息從校長室傳到每間教室！</p>',
                    tip: '觀察學校的網路設備，說不定就能看到閘道器！'
                },
                'ems': {
                    title: '雲端能源管理系統(EMS)',
                    icon: '<i class="fas fa-cloud"></i>',
                    content: '<p><strong>EMS：能源的智慧大腦</strong></p><p>EMS在雲端分析我們的用電數據，幫助我們節約能源！</p><p><strong>主要功能：</strong></p><ul><li><strong>數據收集：</strong>收集所有電表的數據</li><li><strong>數據分析：</strong>分析用電模式，找出浪費</li><li><strong>異常警報：</strong>用電異常時自動提醒</li><li><strong>節能建議：</strong>提供具體的節電方法</li><li><strong>報告生成：</strong>產生用電報告，就像成績單</li></ul><p><strong>實際應用：</strong></p><ul><li>學校：監控教室用電，放學後自動關閉電源</li><li>家庭：手機APP查看用電，設定節電目標</li><li>工廠：優化生產用電，節省電費</li><li>商店：分析營業時間用電，減少浪費</li></ul><p><strong>比喻：</strong>EMS就像能源醫生，幫我們的用電習慣做健康檢查並開出節電處方！</p>',
                    tip: '試著用手機搜尋「家庭能源管理APP」，體驗一下EMS的功能！'
                }
            };
            
            if (facts[factType]) {
                title.innerHTML = facts[factType].title;
                icon.innerHTML = facts[factType].icon;
                content.innerHTML = facts[factType].content;
                tip.innerHTML = facts[factType].tip;
                popup.style.display = 'flex';
            }
        }
        
        // 關閉知識彈出視窗
        function closeFactPopup() {
            document.getElementById('fact-popup').style.display = 'none';
        }
        
        // ========== 電表模擬遊戲 ==========
        let meterApplianceState = {
            light: { on: false, power: 100 },
            fan: { on: false, power: 80 },
            tv: { on: false, power: 200 },
            computer: { on: false, power: 300 }
        };
        
        let totalKwh = 0;
        let meterGameInterval;
        let gameStartTime = Date.now();
        
        // 初始化電表模擬遊戲
        function initMeterSimulation() {
            // 每5秒更新一次用電量（模擬電表記錄）
            clearInterval(meterGameInterval);
            meterGameInterval = setInterval(updateMeterDisplay, 5000);
            
            // 初始顯示
            updateMeterDisplay();
        }
        
        // 開關電器
        function toggleAppliance(appliance) {
            const control = document.getElementById(`${appliance}-control`);
            meterApplianceState[appliance].on = !meterApplianceState[appliance].on;
            
            if (meterApplianceState[appliance].on) {
                control.classList.remove('off');
                control.classList.add('on');
            } else {
                control.classList.remove('on');
                control.classList.add('off');
            }
            
            updateMeterDisplay();
        }
        
        // 更新電表顯示
        function updateMeterDisplay() {
            // 計算總功率
            let totalWatt = 0;
            let applianceCount = 0;
            
            for (const appliance in meterApplianceState) {
                if (meterApplianceState[appliance].on) {
                    totalWatt += meterApplianceState[appliance].power;
                    applianceCount++;
                }
            }
            
            // 計算用電量（度 = 瓦特 × 小時 ÷ 1000）
            // 假設每5秒模擬真實時間的1小時
            const hoursPassed = (Date.now() - gameStartTime) / (5 * 1000); // 每5秒算1小時
            totalKwh = (totalWatt * hoursPassed) / 1000;
            
            // 計算電費（每度3元）
            const estimatedCost = totalKwh * 3;
            
            // 更新顯示
            document.getElementById('current-watt').textContent = totalWatt;
            document.getElementById('total-kwh').textContent = totalKwh.toFixed(2);
            document.getElementById('estimated-cost').textContent = `$${Math.round(estimatedCost)}`;
            document.getElementById('appliance-count').textContent = applianceCount;
            
            // 計算每小時用電和每日電費
            const hourlyKwh = totalWatt / 1000; // 瓦特轉換為千瓦
            const dailyCost = (hourlyKwh * 24 * 3).toFixed(1); // 24小時 × 每度3元
            
            document.getElementById('hourly-use').textContent = `${hourlyKwh.toFixed(2)} 度`;
            document.getElementById('daily-cost').textContent = `$${dailyCost}`;
            
            // 根據用電量改變電表顯示顏色
            const meterDisplay = document.getElementById('meter-display');
            if (totalWatt > 500) {
                meterDisplay.style.color = '#ff4444'; // 紅色：用電太多
                meterDisplay.style.backgroundColor = '#222';
            } else if (totalWatt > 200) {
                meterDisplay.style.color = '#ffaa00'; // 橙色：用電中等
                meterDisplay.style.backgroundColor = '#222';
            } else {
                meterDisplay.style.color = '#44ff44'; // 綠色：用電節約
                meterDisplay.style.backgroundColor = '#222';
            }
        }
        
        // 重置電表遊戲
        function resetMeterGame() {
            // 重置所有電器狀態
            for (const appliance in meterApplianceState) {
                meterApplianceState[appliance].on = false;
                const control = document.getElementById(`${appliance}-control`);
                if (control) {
                    control.classList.remove('on');
                    control.classList.add('off');
                }
            }
            
            // 重置用電量
            totalKwh = 0;
            gameStartTime = Date.now();
            
            // 更新顯示
            updateMeterDisplay();
        }
        
        // ========== 原有遊戲的JavaScript代碼保持不變 ==========
        // ========== 配對遊戲 ==========
        let matchingGameData = [];
        let matchingScore = 0;
        let matchingLevel = 1;
        let matchingGameActive = false;
        let selectedItem = null;
        let correctMatches = 0;
        let totalMatches = 3;
        
        function initMatchingGame() {
            matchingGameData = [
                {
                    problems: [
                        { id: 1, text: "冷氣開太冷", icon: "fas fa-snowflake" },
                        { id: 2, text: "使用一次性塑膠袋", icon: "fas fa-shopping-bag" },
                        { id: 3, text: "開車上學", icon: "fas fa-car" }
                    ],
                    solutions: [
                        { id: 1, text: "設定26-28°C", match: 1, icon: "fas fa-thermometer-half" },
                        { id: 2, text: "自備環保袋", match: 2, icon: "fas fa-shopping-basket" },
                        { id: 3, text: "走路或騎腳踏車", match: 3, icon: "fas fa-bicycle" }
                    ]
                },
                {
                    problems: [
                        { id: 1, text: "臭氧層破洞", icon: "fas fa-layer-group" },
                        { id: 2, text: "北極熊失去家園", icon: "fas fa-paw" },
                        { id: 3, text: "冰河融化", icon: "fas fa-mountain" }
                    ],
                    solutions: [
                        { id: 1, text: "減少使用冷媒", match: 1, icon: "fas fa-wind" },
                        { id: 2, text: "減少碳排放", match: 2, icon: "fas fa-industry" },
                        { id: 3, text: "減緩全球暖化", match: 3, icon: "fas fa-temperature-high" }
                    ]
                },
                {
                    problems: [
                        { id: 1, text: "浪費水資源", icon: "fas fa-tint" },
                        { id: 2, text: "電力浪費", icon: "fas fa-bolt" },
                        { id: 3, text: "空氣污染", icon: "fas fa-smog" }
                    ],
                    solutions: [
                        { id: 1, text: "一水多用", match: 1, icon: "fas fa-recycle" },
                        { id: 2, text: "隨手關燈", match: 2, icon: "fas fa-lightbulb" },
                        { id: 3, text: "搭乘大眾運輸", match: 3, icon: "fas fa-bus" }
                    ]
                }
            ];
            
            renderMatchingGame();
        }
        
        function renderMatchingGame() {
            const container = document.getElementById('matching-game-container');
            const levelData = matchingGameData[matchingLevel - 1];
            
            container.innerHTML = '';
            
            // 問題列
            const problemsRow = document.createElement('div');
            problemsRow.className = 'matching-row';
            
            levelData.problems.forEach(problem => {
                const problemElement = document.createElement('div');
                problemElement.className = 'matching-item left';
                problemElement.innerHTML = `
                    <i class="${problem.icon}"></i>
                    <span>${problem.text}</span>
                `;
                problemElement.dataset.id = problem.id;
                problemElement.dataset.type = 'problem';
                problemElement.addEventListener('click', () => selectMatchingItem(problemElement));
                problemsRow.appendChild(problemElement);
            });
            
            container.appendChild(problemsRow);
            
            // 箭頭
            const arrowRow = document.createElement('div');
            arrowRow.className = 'matching-row';
            arrowRow.innerHTML = `
                <div class="matching-arrow"><i class="fas fa-long-arrow-alt-down"></i></div>
                <div class="matching-arrow"><i class="fas fa-long-arrow-alt-down"></i></div>
                <div class="matching-arrow"><i class="fas fa-long-arrow-alt-down"></i></div>
            `;
            container.appendChild(arrowRow);
            
            // 解決方案列
            const solutionsRow = document.createElement('div');
            solutionsRow.className = 'matching-row';
            
            // 隨機排序解決方案
            const shuffledSolutions = [...levelData.solutions].sort(() => Math.random() - 0.5);
            
            shuffledSolutions.forEach(solution => {
                const solutionElement = document.createElement('div');
                solutionElement.className = 'matching-item right';
                solutionElement.innerHTML = `
                    <i class="${solution.icon}"></i>
                    <span>${solution.text}</span>
                `;
                solutionElement.dataset.id = solution.id;
                solutionElement.dataset.match = solution.match;
                solutionElement.dataset.type = 'solution';
                solutionElement.addEventListener('click', () => selectMatchingItem(solutionElement));
                solutionsRow.appendChild(solutionElement);
            });
            
            container.appendChild(solutionsRow);
            
            // 更新分數和等級顯示
            document.getElementById('matching-score').textContent = matchingScore;
            document.getElementById('matching-level').textContent = matchingLevel;
            document.getElementById('matching-progress-bar').style.width = '0%';
            
            // 重置反饋
            document.getElementById('matching-feedback').textContent = '點擊問題，再點擊解決方案來配對！';
            document.getElementById('matching-feedback').className = 'feedback';
            
            // 禁用下一關按鈕
            document.getElementById('matching-next-btn').disabled = true;
            
            // 重置選擇狀態
            selectedItem = null;
            correctMatches = 0;
        }
        
        function selectMatchingItem(item) {
            if (!matchingGameActive) return;
            
            if (item.classList.contains('matched')) return;
            
            if (!selectedItem) {
                // 選擇第一個項目
                selectedItem = item;
                item.classList.add('selected');
            } else {
                // 選擇第二個項目
                if (selectedItem.dataset.type === item.dataset.type) {
                    // 相同類型，更換選擇
                    selectedItem.classList.remove('selected');
                    selectedItem = item;
                    item.classList.add('selected');
                } else {
                    // 不同類型，檢查配對
                    const isProblemFirst = selectedItem.dataset.type === 'problem';
                    const problem = isProblemFirst ? selectedItem : item;
                    const solution = isProblemFirst ? item : selectedItem;
                    
                    const problemId = parseInt(problem.dataset.id);
                    const solutionMatchId = parseInt(solution.dataset.match);
                    
                    if (problemId === solutionMatchId) {
                        // 配對正確
                        problem.classList.add('matched');
                        solution.classList.add('matched');
                        problem.classList.remove('selected');
                        solution.classList.remove('selected');
                        
                        // 每關配對正確得100分，三關全對得300分
                        matchingScore += 100;
                        document.getElementById('matching-score').textContent = matchingScore;
                        
                        correctMatches++;
                        const progress = (correctMatches / totalMatches) * 100;
                        document.getElementById('matching-progress-bar').style.width = `${progress}%`;
                        
                        document.getElementById('matching-feedback').textContent = '太棒了！配對正確！';
                        document.getElementById('matching-feedback').className = 'feedback correct';
                        
                        if (correctMatches >= totalMatches) {
                            matchingGameActive = false;
                            document.getElementById('matching-feedback').textContent = `恭喜！完成第${matchingLevel}關！獲得100分！`;
                            
                            if (matchingLevel < 3) {
                                document.getElementById('matching-next-btn').disabled = false;
                            } else {
                                document.getElementById('matching-feedback').textContent += ' 你已完成所有關卡！獲得300分滿分！成為環保配對達人！';
                            }
                        }
                    } else {
                        // 配對錯誤
                        document.getElementById('matching-feedback').textContent = '配對錯誤，再試試看！';
                        document.getElementById('matching-feedback').className = 'feedback incorrect';
                        
                        // 錯誤不扣分，鼓勵嘗試
                        selectedItem.classList.remove('selected');
                    }
                    
                    selectedItem = null;
                }
            }
        }
        
        function startMatchingGame() {
            matchingGameActive = true;
            correctMatches = 0;
            document.getElementById('matching-progress-bar').style.width = '0%';
            
            // 重置所有項目狀態
            document.querySelectorAll('.matching-item').forEach(item => {
                item.classList.remove('matched', 'selected');
            });
            
            document.getElementById('matching-feedback').textContent = '遊戲開始！點擊問題，再點擊解決方案來配對！';
            document.getElementById('matching-feedback').className = 'feedback';
            
            document.getElementById('matching-next-btn').disabled = true;
        }
        
        function resetMatchingGame() {
            matchingGameActive = false;
            matchingScore = 0;
            matchingLevel = 1;
            correctMatches = 0;
            
            renderMatchingGame();
            
            document.getElementById('matching-feedback').textContent = '點擊「開始遊戲」按鈕開始遊戲！';
            document.getElementById('matching-feedback').className = 'feedback';
        }
        
        function nextMatchingLevel() {
            matchingLevel++;
            renderMatchingGame();
            startMatchingGame();
        }
        
        // ========== 節電挑戰遊戲 ==========
        let energyGameActive = false;
        let energyScore = 0;
        let energyTimeLeft = 60;
        let energyGameTimer;
        
        // 電器數據
        let appliances = [
            { 
                id: 1, 
                name: "冷氣", 
                power: 1500,
                x: 20, y: 30, 
                on: true, 
                icon: "fas fa-snowflake",
                hoursPerDay: 8,
                description: "耗電量大，設定26°C最省電"
            },
            { 
                id: 2, 
                name: "電視", 
                power: 200, 
                x: 120, y: 40, 
                on: true, 
                icon: "fas fa-tv",
                hoursPerDay: 4,
                description: "待機也會耗電，看完要關閉"
            },
            { 
                id: 3, 
                name: "電燈", 
                power: 100, 
                x: 220, y: 30, 
                on: true, 
                icon: "fas fa-lightbulb",
                hoursPerDay: 5,
                description: "離開房間要隨手關燈"
            },
            { 
                id: 4, 
                name: "電腦", 
                power: 300, 
                x: 40, y: 120, 
                on: true, 
                icon: "fas fa-desktop",
                hoursPerDay: 6,
                description: "不用時關機或休眠"
            },
            { 
                id: 5, 
                name: "電風扇", 
                power: 80, 
                x: 140, y: 130, 
                on: true, 
                icon: "fas fa-fan",
                hoursPerDay: 6,
                description: "比冷氣省電很多"
            },
            { 
                id: 6, 
                name: "充電器", 
                power: 50, 
                x: 220, y: 120, 
                on: true, 
                icon: "fas fa-charging-station",
                hoursPerDay: 3,
                description: "充飽電要拔掉插頭"
            }
        ];
        
        // 電價：每度電3元
        const electricityPrice = 3;
        
        function initEnergyGame() {
            renderEnergyGame();
        }
        
        function renderEnergyGame() {
            const container = document.getElementById('house-container');
            container.innerHTML = '';
            
            appliances.forEach(appliance => {
                const applianceElement = document.createElement('div');
                applianceElement.className = `appliance ${appliance.on ? 'on' : 'off'}`;
                applianceElement.style.left = `${appliance.x}px`;
                applianceElement.style.top = `${appliance.y}px`;
                applianceElement.innerHTML = `
                    <div class="appliance-icon"><i class="${appliance.icon}"></i></div>
                    <div>${appliance.name}</div>
                `;
                applianceElement.title = appliance.description;
                applianceElement.addEventListener('click', () => toggleEnergyAppliance(appliance.id));
                container.appendChild(applianceElement);
            });
            
            updateEnergyDisplay();
        }
        
        // 計算用電度數
        function calculateElectricityUsage() {
            let totalKwh = 0;
            let totalCost = 0;
            
            appliances.forEach(appliance => {
                if (appliance.on) {
                    const dailyKwh = (appliance.power * appliance.hoursPerDay) / 1000;
                    const monthlyKwh = dailyKwh * 30;
                    totalKwh += monthlyKwh;
                }
            });
            
            totalCost = totalKwh * electricityPrice;
            
            return { totalKwh, totalCost };
        }
        
        function toggleEnergyAppliance(id) {
            if (!energyGameActive) return;
            
            const appliance = appliances.find(a => a.id === id);
            const wasOn = appliance.on;
            appliance.on = !appliance.on;
            
            if (!appliance.on && wasOn) {
                energyScore += 10;
            } else if (appliance.on && !wasOn) {
                energyScore = Math.max(0, energyScore - 10);
            }
            
            updateEnergyDisplay();
            renderEnergyGame();
            
            checkEnergyGameCompletion();
        }
        
        function updateEnergyDisplay() {
            const usage = calculateElectricityUsage();
            const totalKwh = usage.totalKwh;
            const totalCost = usage.totalCost;
            
            let maxPossibleKwh = 0;
            appliances.forEach(appliance => {
                const dailyKwh = (appliance.power * appliance.hoursPerDay) / 1000;
                maxPossibleKwh += dailyKwh * 30;
            });
            
            const energyLevel = (totalKwh / maxPossibleKwh) * 100;
            
            document.getElementById('energy-level').style.width = `${energyLevel}%`;
            document.getElementById('energy-cost').textContent = `$${Math.round(totalCost)}`;
            
            let minPossibleKwh = 0;
            appliances.forEach(appliance => {
                if (appliance.id === 3 || appliance.id === 6) {
                    const dailyKwh = (appliance.power * appliance.hoursPerDay) / 1000;
                    minPossibleKwh += dailyKwh * 30;
                }
            });
            
            const savedCost = Math.max(0, 1200 - totalCost);
            
            document.getElementById('energy-saved').textContent = `$${Math.round(savedCost)}`;
            document.getElementById('energy-kwh').textContent = `${totalKwh.toFixed(1)} 度`;
            document.getElementById('energy-score').textContent = energyScore;
            document.getElementById('energy-time').textContent = energyTimeLeft;
            
            let feedback = '';
            let feedbackClass = 'feedback';
            
            if (energyLevel <= 30 && savedCost >= 300) {
                feedback = '優秀！能源使用在節能範圍且節省大量電費！';
                feedbackClass = 'feedback correct';
            } else if (energyLevel <= 50 && savedCost >= 150) {
                feedback = '還可以，繼續努力關閉更多電器！';
            } else {
                feedback = '用電太多了！快關掉一些不必要的電器！';
                feedbackClass = 'feedback incorrect';
            }
            
            document.getElementById('energy-feedback').textContent = feedback;
            document.getElementById('energy-feedback').className = feedbackClass;
        }
        
        function checkEnergyGameCompletion() {
            const usage = calculateElectricityUsage();
            const totalKwh = usage.totalKwh;
            const totalCost = usage.totalCost;
            
            let maxPossibleKwh = 0;
            appliances.forEach(appliance => {
                const dailyKwh = (appliance.power * appliance.hoursPerDay) / 1000;
                maxPossibleKwh += dailyKwh * 30;
            });
            
            const energyLevel = (totalKwh / maxPossibleKwh) * 100;
            
            let minPossibleKwh = 0;
            appliances.forEach(appliance => {
                if (appliance.id === 3 || appliance.id === 6) {
                    const dailyKwh = (appliance.power * appliance.hoursPerDay) / 1000;
                    minPossibleKwh += dailyKwh * 30;
                }
            });
            
            const savedCost = Math.max(0, 1200 - totalCost);
            
            let bonusScore = 0;
            
            if (energyLevel <= 30) {
                bonusScore += 30;
            }
            
            if (savedCost >= 300) {
                bonusScore += 30;
            }
            
            if (energyTimeLeft >= 10) {
                bonusScore += 30;
            }
            
            const totalScore = Math.min(100, energyScore + bonusScore);
            document.getElementById('energy-score').textContent = totalScore;
            
            if (totalScore >= 100) {
                energyGameActive = false;
                clearInterval(energyGameTimer);
                document.getElementById('energy-feedback').textContent = '太棒了！你獲得100分滿分！成為節電達人！';
                document.getElementById('energy-feedback').className = 'feedback correct';
            }
        }
        
        function startEnergyGame() {
            energyGameActive = true;
            energyScore = 0;
            energyTimeLeft = 60;
            
            appliances.forEach(appliance => {
                appliance.on = true;
            });
            
            renderEnergyGame();
            
            clearInterval(energyGameTimer);
            energyGameTimer = setInterval(() => {
                energyTimeLeft--;
                document.getElementById('energy-time').textContent = energyTimeLeft;
                
                if (energyTimeLeft <= 0) {
                    clearInterval(energyGameTimer);
                    energyGameActive = false;
                    
                    checkEnergyGameCompletion();
                    
                    document.getElementById('energy-feedback').textContent = `時間到！你的最終得分是${document.getElementById('energy-score').textContent}分！`;
                    document.getElementById('energy-feedback').className = 'feedback';
                }
            }, 1000);
            
            document.getElementById('energy-feedback').textContent = '遊戲開始！點擊電器來開啟或關閉它，目標是獲得100分滿分！';
            document.getElementById('energy-feedback').className = 'feedback';
        }
        
        function resetEnergyGame() {
            energyGameActive = false;
            energyScore = 0;
            energyTimeLeft = 60;
            clearInterval(energyGameTimer);
            
            appliances.forEach(appliance => {
                appliance.on = true;
            });
            
            renderEnergyGame();
            
            document.getElementById('energy-feedback').textContent = '點擊「開始挑戰」按鈕開始遊戲！';
            document.getElementById('energy-feedback').className = 'feedback';
        }
        
        // ========== 碳匯挑戰賽 ==========
        let carbonGameActive = false;
        let carbonScore = 0;
        let carbonEmission = 100;
        let carbonSinkAmount = 0;
        
        function initCarbonGame() {
            renderCarbonGame();
        }
        
        function renderCarbonGame() {
            const sourcesContainer = document.getElementById('carbon-sources-container');
            const sinksContainer = document.getElementById('carbon-sinks-container');
            
            sourcesContainer.innerHTML = '';
            sinksContainer.innerHTML = '';
            
            const carbonSources = [
                { id: 1, name: "開車10公里", emission: 2.4, icon: "fas fa-car", description: "產生2.4公斤二氧化碳" },
                { id: 2, name: "冷氣1小時", emission: 0.6, icon: "fas fa-snowflake", description: "產生0.6公斤二氧化碳" },
                { id: 3, name: "丟棄1kg垃圾", emission: 1.2, icon: "fas fa-trash", description: "產生1.2公斤二氧化碳" },
                { id: 4, name: "用1度電", emission: 0.5, icon: "fas fa-bolt", description: "產生0.5公斤二氧化碳" }
            ];
            
            const carbonSinks = [
                { id: 1, name: "種一棵樹", sink: 12, icon: "fas fa-tree", description: "每年吸收12公斤二氧化碳" },
                { id: 2, name: "保護1公頃森林", sink: 22, icon: "fas fa-forest", description: "每年吸收22噸二氧化碳" },
                { id: 3, name: "保護海洋生態", sink: 15, icon: "fas fa-water", description: "每年吸收15公斤二氧化碳" },
                { id: 4, name: "植樹造林", sink: 18, icon: "fas fa-seedling", description: "每年吸收18公斤二氧化碳" }
            ];
            
            carbonSources.forEach(source => {
                const sourceElement = document.createElement('div');
                sourceElement.className = 'carbon-source';
                sourceElement.innerHTML = `
                    <i class="${source.icon}"></i> ${source.name}
                `;
                sourceElement.title = source.description;
                sourceElement.addEventListener('click', () => addCarbonEmission(source.id));
                sourcesContainer.appendChild(sourceElement);
            });
            
            carbonSinks.forEach(sink => {
                const sinkElement = document.createElement('div');
                sinkElement.className = 'carbon-sink';
                sinkElement.innerHTML = `
                    <i class="${sink.icon}"></i> ${sink.name}
                `;
                sinkElement.title = sink.description;
                sinkElement.addEventListener('click', () => addCarbonSink(sink.id));
                sinksContainer.appendChild(sinkElement);
            });
            
            updateCarbonDisplay();
        }
        
        function addCarbonEmission(sourceId) {
            if (!carbonGameActive) return;
            
            const sources = [
                { id: 1, emission: 2.4, name: "開車10公里" },
                { id: 2, emission: 0.6, name: "冷氣1小時" },
                { id: 3, emission: 1.2, name: "丟棄1kg垃圾" },
                { id: 4, emission: 0.5, name: "用1度電" }
            ];
            
            const source = sources.find(s => s.id === sourceId);
            carbonEmission += source.emission;
            
            carbonScore = Math.max(0, carbonScore - 5);
            
            updateCarbonDisplay();
            
            document.getElementById('carbon-feedback').textContent = `增加了${source.emission}公斤碳排放！`;
            document.getElementById('carbon-feedback').className = 'feedback incorrect';
            
            checkCarbonGameCompletion();
        }
        
        function addCarbonSink(sinkId) {
            if (!carbonGameActive) return;
            
            const sinks = [
                { id: 1, sink: 12, name: "種一棵樹" },
                { id: 2, sink: 22, name: "保護1公頃森林" },
                { id: 3, sink: 15, name: "保護海洋生態" },
                { id: 4, sink: 18, name: "植樹造林" }
            ];
            
            const sink = sinks.find(s => s.id === sinkId);
            carbonSinkAmount += sink.sink;
            
            carbonScore += 5;
            
            updateCarbonDisplay();
            
            document.getElementById('carbon-feedback').textContent = `增加了${sink.sink}公斤碳匯吸收！`;
            document.getElementById('carbon-feedback').className = 'feedback correct';
            
            checkCarbonGameCompletion();
        }
        
        function updateCarbonDisplay() {
            const carbonBalance = carbonSinkAmount - carbonEmission;
            
            document.getElementById('carbon-emission').textContent = `${carbonEmission.toFixed(1)} 公斤`;
            document.getElementById('carbon-sink-amount').textContent = `${carbonSinkAmount.toFixed(1)} 公斤`;
            document.getElementById('carbon-balance').textContent = `${carbonBalance.toFixed(1)} 公斤`;
            document.getElementById('carbon-score').textContent = carbonScore;
            
            let carbonPercentage = (carbonBalance + 100) / 2;
            carbonPercentage = Math.max(0, Math.min(100, carbonPercentage));
            document.getElementById('carbon-level').style.width = `${carbonPercentage}%`;
            
            const earthIcon = document.getElementById('earth-icon');
            if (carbonBalance >= 50) {
                earthIcon.className = "fas fa-globe-americas";
                earthIcon.style.color = "#1E88E5";
            } else if (carbonBalance >= 0) {
                earthIcon.className = "fas fa-globe-asia";
                earthIcon.style.color = "#4CAF50";
            } else if (carbonBalance >= -50) {
                earthIcon.className = "fas fa-globe-europe";
                earthIcon.style.color = "#FF9800";
            } else {
                earthIcon.className = "fas fa-globe-africa";
                earthIcon.style.color = "#F44336";
            }
        }
        
        function checkCarbonGameCompletion() {
            const carbonBalance = carbonSinkAmount - carbonEmission;
            
            let bonusScore = 0;
            
            if (carbonBalance >= 0) {
                bonusScore += 30;
            }
            
            if (carbonBalance >= 50) {
                bonusScore += 20;
            }
            
            const totalScore = Math.min(100, carbonScore + bonusScore);
            document.getElementById('carbon-score').textContent = totalScore;
            
            if (totalScore >= 100) {
                carbonGameActive = false;
                document.getElementById('carbon-feedback').textContent = '太棒了！你獲得100分滿分！碳匯吸收遠超過碳排放！';
                document.getElementById('carbon-feedback').className = 'feedback correct';
            }
        }
        
        function startCarbonGame() {
            carbonGameActive = true;
            carbonScore = 0;
            carbonEmission = 100;
            carbonSinkAmount = 0;
            
            updateCarbonDisplay();
            
            document.getElementById('carbon-feedback').textContent = '遊戲開始！點擊碳源增加排放，點擊碳匯增加吸收！';
            document.getElementById('carbon-feedback').className = 'feedback';
        }
        
        function resetCarbonGame() {
            carbonGameActive = false;
            carbonScore = 0;
            carbonEmission = 100;
            carbonSinkAmount = 0;
            
            updateCarbonDisplay();
            
            document.getElementById('carbon-feedback').textContent = '點擊「開始遊戲」按鈕開始遊戲！';
            document.getElementById('carbon-feedback').className = 'feedback';
        }
        
        // ========== 拯救北極熊遊戲 ==========
        let polarBearGameActive = false;
        let polarBearHealth = 100;
        let iceThickness = 100;
        
        function initPolarBearGame() {
            renderPolarBearGame();
        }
        
        function renderPolarBearGame() {
            updatePolarBearDisplay();
        }
        
        function updatePolarBearDisplay() {
            document.getElementById('ice-thickness').textContent = iceThickness;
            document.getElementById('polar-bear-health').textContent = polarBearHealth;
            
            document.getElementById('ice-level').style.height = `${iceThickness}%`;
            
            const bearElement = document.getElementById('polar-bear');
            const bottomPosition = 10 + (100 - iceThickness) * 0.5;
            bearElement.style.bottom = `${bottomPosition}px`;
            
            if (polarBearHealth >= 70) {
                bearElement.textContent = "🐻‍❄️";
            } else if (polarBearHealth >= 30) {
                bearElement.textContent = "😟🐻‍❄️";
            } else {
                bearElement.textContent = "😨🐻‍❄️";
            }
        }
        
        function startPolarBearGame() {
            polarBearGameActive = true;
            polarBearHealth = 100;
            iceThickness = 100;
            
            const threatsContainer = document.getElementById('threats-container');
            const solutionsContainer = document.getElementById('solutions-container');
            
            threatsContainer.innerHTML = '';
            solutionsContainer.innerHTML = '';
            
            const threats = [
                { id: 1, name: "全球暖化", damage: 15, icon: "fas fa-temperature-high" },
                { id: 2, name: "海冰融化", damage: 20, icon: "fas fa-icicles" },
                { id: 3, name: "海洋污染", damage: 10, icon: "fas fa-trash" },
                { id: 4, name: "過度捕魚", damage: 10, icon: "fas fa-fish" }
            ];
            
            const solutions = [
                { id: 1, name: "種樹", heal: 15, icon: "fas fa-tree" },
                { id: 2, name: "節約用電", heal: 10, icon: "fas fa-bolt" },
                { id: 3, name: "減少塑膠", heal: 10, icon: "fas fa-recycle" },
                { id: 4, name: "綠色能源", heal: 20, icon: "fas fa-solar-panel" }
            ];
            
            threats.forEach(threat => {
                const threatElement = document.createElement('div');
                threatElement.className = 'threat';
                threatElement.innerHTML = `
                    <i class="${threat.icon}"></i> ${threat.name}
                `;
                threatElement.addEventListener('click', () => applyThreat(threat.id));
                threatsContainer.appendChild(threatElement);
            });
            
            solutions.forEach(solution => {
                const solutionElement = document.createElement('div');
                solutionElement.className = 'solution';
                solutionElement.innerHTML = `
                    <i class="${solution.icon}"></i> ${solution.name}
                `;
                solutionElement.addEventListener('click', () => applySolution(solution.id));
                solutionsContainer.appendChild(solutionElement);
            });
            
            updatePolarBearDisplay();
            
            document.getElementById('polar-bear-feedback').textContent = '遊戲開始！點擊威脅了解問題，點擊解決方案幫助北極熊！';
            document.getElementById('polar-bear-feedback').className = 'feedback';
        }
        
        function applyThreat(threatId) {
            if (!polarBearGameActive) return;
            
            const threats = [
                { id: 1, name: "全球暖化", damage: 15 },
                { id: 2, name: "海冰融化", damage: 20 },
                { id: 3, name: "海洋污染", damage: 10 },
                { id: 4, name: "過度捕魚", damage: 10 }
            ];
            
            const threat = threats.find(t => t.id === threatId);
            
            iceThickness = Math.max(0, iceThickness - threat.damage);
            polarBearHealth = Math.max(0, polarBearHealth - threat.damage / 2);
            
            updatePolarBearDisplay();
            
            document.getElementById('polar-bear-feedback').textContent = `哦不！${threat.name}讓冰層融化了${threat.damage}%！`;
            document.getElementById('polar-bear-feedback').className = 'feedback incorrect';
            
            checkPolarBearGameOver();
        }
        
        function applySolution(solutionId) {
            if (!polarBearGameActive) return;
            
            const solutions = [
                { id: 1, name: "種樹", heal: 15 },
                { id: 2, name: "節約用電", heal: 10 },
                { id: 3, name: "減少塑膠", heal: 10 },
                { id: 4, name: "綠色能源", heal: 20 }
            ];
            
            const solution = solutions.find(s => s.id === solutionId);
            
            iceThickness = Math.min(100, iceThickness + solution.heal);
            polarBearHealth = Math.min(100, polarBearHealth + solution.heal / 2);
            
            updatePolarBearDisplay();
            
            document.getElementById('polar-bear-feedback').textContent = `太好了！${solution.name}幫助恢復了冰層${solution.heal}%！`;
            document.getElementById('polar-bear-feedback').className = 'feedback correct';
            
            checkPolarBearGameWin();
        }
        
        function checkPolarBearGameOver() {
            if (iceThickness <= 0 || polarBearHealth <= 0) {
                polarBearGameActive = false;
                document.getElementById('polar-bear-feedback').textContent = '遊戲結束！冰層完全融化了，北極熊失去家園了...再試一次吧！';
                document.getElementById('polar-bear-feedback').className = 'feedback incorrect';
            }
        }
        
        function checkPolarBearGameWin() {
            if (iceThickness >= 80 && polarBearHealth >= 80) {
                polarBearGameActive = false;
                document.getElementById('polar-bear-feedback').textContent = '恭喜！你成功拯救了北極熊和它的家園！';
                document.getElementById('polar-bear-feedback').className = 'feedback correct';
            }
        }
        
        function resetPolarBearGame() {
            polarBearGameActive = false;
            polarBearHealth = 100;
            iceThickness = 100;
            
            updatePolarBearDisplay();
            
            document.getElementById('polar-bear-feedback').textContent = '點擊「開始救援」按鈕開始遊戲！';
            document.getElementById('polar-bear-feedback').className = 'feedback';
        }
        
        // 頁面加載時初始化
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>